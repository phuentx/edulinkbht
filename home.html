<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>EduLink Pro</title>
    <link rel="icon" type="image/png" href="https://i.imghippo.com/files/vgr8207c.png">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://unpkg.com/ml5@latest/dist/ml5.min.js"></script>
    <script src='https://unpkg.com/tesseract.js@v2.1.0/dist/tesseract.min.js'></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=Google+Sans:wght@400;500;700&display=swap');

        :root {
            --surface: #ffffff; 
            --background: #f9fafb; 
            --primary: #0b57d0;
            --on-surface: #1f1f1f;
            --outline: #eaecf0;
            
            /* Landing Page Palette */
            --bg-body: #FFFFFF;
            --bg-secondary: #F7F7F5; 
            --text-main: #37352F;    
            --text-sub: #9B9A97;     
            --border: #E0E0E0;
            --accent: #2383E2;
            --error: #EB5757;
            --success: #27AE60;       
            --radius: 6px; 
            --star-color: #F5A623; 
        }

        body { 
            font-family: 'Inter', sans-serif; 
            background-color: var(--background);
            color: var(--on-surface);
            overflow-x: hidden; 
            margin: 0; padding: 0;
        }

        h1, h2, h3, .google-font { font-family: 'Google Sans', 'Inter', sans-serif; }

        /* No Scrollbars */
        * { scrollbar-width: none; -ms-overflow-style: none; box-sizing: border-box; }
        *::-webkit-scrollbar { width: 0px; background: transparent; display: none; }
        
        /* Prevent icon squishing globally */
        i[data-lucide], svg { flex-shrink: 0; }

        .fade-in { animation: fadeUp 0.4s cubic-bezier(0.2, 0, 0, 1) forwards; opacity: 0; transform: translateY(10px); }
        @keyframes fadeUp { to { opacity: 1; transform: translateY(0); } }

        /* --- UNIFIED PANEL STYLES --- */
        .app-panel {
            background: #ffffff;
            border-radius: 20px;
            border: 1px solid var(--outline);
            height: 100%; 
            display: flex;
            flex-direction: column;
            overflow: hidden;
            box-shadow: 0 1px 2px rgba(0,0,0,0.03); 
            transition: all 0.3s cubic-bezier(0.2, 0, 0, 1);
        }

        /* Mobile Adjustments */
        @media (max-width: 768px) {
            .app-panel {
                border-radius: 0 !important;
                border: none !important;
                box-shadow: none !important;
            }
            #workspace-layout {
                gap: 0 !important;
            }
        }

        /* --- SIDEBAR --- */
        #main-sidebar {
            width: 88px;
            flex-shrink: 0;
            padding: 24px 12px;
            transition: width 0.3s cubic-bezier(0.2, 0, 0, 1), padding 0.3s ease;
        }

        @media (min-width: 1024px) {
            #main-sidebar {
                width: 260px; 
                padding: 24px 20px;
            }
        }

        .nav-item {
            display: flex; align-items: center; gap: 14px;
            padding: 12px; 
            color: #667085;
            font-weight: 500;
            font-size: 15px;
            border-radius: 12px;
            transition: all 0.2s ease;
            cursor: pointer;
            text-decoration: none;
            margin-bottom: 4px;
            justify-content: center;
        }

        .nav-item:hover {
            color: #1f1f1f;
            background-color: #f3f4f6;
        }

        .nav-item.active {
            color: #0b57d0;
            background-color: #eff4ff;
            font-weight: 600;
        }

        @media (min-width: 1024px) {
            .nav-item {
                justify-content: flex-start;
                padding: 10px 16px; 
            }
        }
        
        .sidebar-user {
            display: flex; align-items: center; gap: 12px;
            padding: 8px;
            border-radius: 12px;
            cursor: pointer;
            transition: background-color 0.2s;
            justify-content: center;
        }
        .sidebar-user:hover { background-color: #f9fafb; }
        
        @media (min-width: 1024px) {
            .sidebar-user { justify-content: flex-start; padding: 8px 12px; }
        }
        
        .create-btn {
            display: flex; 
            align-items: center; 
            justify-content: flex-start; 
            gap: 12px;
            background: #1f1f1f;
            color: white;
            padding: 12px 20px; 
            border-radius: 12px;
            font-weight: 500;
            font-size: 14px;
            transition: all 0.2s ease;
            width: 100%;
            margin-bottom: 24px;
            box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1);
            line-height: 1; 
            min-width: 0;
            white-space: nowrap;
        }
        
        .create-btn:hover {
            background: #000;
            transform: translateY(-1px);
            box-shadow: 0 10px 15px -3px rgba(0,0,0,0.1);
        }

        /* --- POST CARD DESIGN --- */
        .post-card { 
            background: white; 
            border-bottom: 1px solid var(--outline); 
            border-radius: 0; 
            transition: background-color 0.2s ease; 
            margin-bottom: 0;
            box-shadow: none;
            overflow: visible;
        }
        .post-card:hover { 
            background-color: #f8fafe; 
            cursor: pointer; 
            transform: none;
        }
        
        .post-header {
            display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 14px;
        }

        .post-avatar-container {
            position: relative;
        }
        .post-avatar {
            width: 44px; height: 44px;
            border-radius: 50%;
            background-color: #f3f4f6;
            border: 1px solid #eaecf0;
            object-fit: cover;
        }
        
        .post-author-name {
            font-weight: 700; font-size: 15px; color: #1f1f1f;
            line-height: 1.2;
        }
        .post-author-name:hover { text-decoration: underline; color: #0b57d0; }
        
        .post-meta {
            font-size: 12px; color: #667085; margin-top: 3px; font-weight: 500;
        }

        .post-body {
            font-size: 15px; line-height: 1.6; color: #374151;
            margin-bottom: 16px;
        }
        
        .post-actions {
            display: flex; align-items: center; justify-content: space-between;
            padding-top: 14px; border-top: 1px solid #f2f4f7;
        }

        .action-btn {
            display: flex; align-items: center; gap: 6px;
            padding: 8px 12px; border-radius: 10px;
            color: #667085; font-size: 13px; font-weight: 600;
            transition: all 0.2s;
            background: transparent; border: none; cursor: pointer;
        }
        .action-btn:hover { background-color: #f9fafb; color: #1f1f1f; }
        
        /* Updated Like Icon Styles */
        .action-btn.like:hover { background-color: #fef2f2; color: #ef4444; }
        .action-btn.comment:hover { background-color: #eff6ff; color: #2563eb; }
        .action-btn.bookmark:hover { background-color: #f5f3ff; color: #7c3aed; }
        .action-btn.ai-pin { color: #0b57d0; background-color: #eff6ff; } 
        .action-btn.ai-pin:hover { background-color: #dbeafe; }

        /* --- LANDING PAGE STYLES (Merged) --- */
        #auth-view { width: 100%; min-height: 100vh; background-color: #fff; display: block; overflow-y: auto; }
        #app-view { display: none; width: 100%; height: 100vh; overflow: hidden; }
        
        .hidden { display: none !important; }

        /* Notification Container */
        #notification-container {
            position: fixed; top: 20px; right: 20px; z-index: 10000;
            display: flex; flex-direction: column; gap: 10px; pointer-events: none;
        }
        .custom-alert {
            background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(10px);
            border: 1px solid var(--border); border-left: 4px solid var(--accent);
            padding: 12px 16px; border-radius: 8px; box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            display: flex; align-items: center; gap: 12px; min-width: 300px; max-width: 400px;
            pointer-events: auto; animation: slideInRight 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
            opacity: 0; transform: translateX(100%);
        }
        .custom-alert.error { border-left-color: var(--error); }
        .custom-alert.success { border-left-color: var(--success); }
        @keyframes slideInRight { to { opacity: 1; transform: translateX(0); } }
        @keyframes fadeOutRight { to { opacity: 0; transform: translateX(20px); } }
        
        .alert-avatar { width: 32px; height: 32px; border-radius: 50%; background: #F0F0F0; object-fit: cover; }
        .alert-content { display: flex; flex-direction: column; }
        .alert-title { font-size: 13px; font-weight: 700; color: var(--text-main); }
        .alert-msg { font-size: 12px; color: var(--text-sub); margin-top: 2px; }

        /* Split Screen */
        .screen-one { height: 100vh; width: 100%; display: flex; position: relative; border-bottom: 1px solid var(--border); background: white; z-index: 10; }
        .left-panel { flex: 1.4; background-color: var(--bg-secondary); position: relative; overflow: hidden; display: flex; justify-content: center; align-items: center; border-right: 1px solid var(--border); height: 100%; }
        .left-panel::before { content: ""; position: absolute; inset: 0; background-image: radial-gradient(#d3d1cb 1px, transparent 1px); background-size: 40px 40px; opacity: 0.5; pointer-events: none; z-index: 0; }
        
        .marquee-container { display: flex; gap: 80px; height: 120vh; transform: translateY(-5%); position: relative; z-index: 5; }
        .marquee-col { display: flex; flex-direction: column; gap: 32px; width: 260px; z-index: 2; }
        .scroll-up { animation: scrollUp 80s linear infinite; }
        .scroll-down { animation: scrollDown 85s linear infinite; }
        @keyframes scrollUp { 0% { transform: translateY(0); } 100% { transform: translateY(-50%); } }
        @keyframes scrollDown { 0% { transform: translateY(-50%); } 100% { transform: translateY(0); } }
        
        .gallery-card { border-radius: var(--radius); overflow: hidden; border: 1px solid rgba(0,0,0,0.08); box-shadow: 0 4px 20px rgba(0,0,0,0.06); background: white; height: 320px; flex-shrink: 0; position: relative; }
        .gallery-card img { width: 100%; height: 100%; object-fit: cover; filter: saturate(0.9); }

        .ai-floating-bar { position: absolute; bottom: 40px; width: 85%; max-width: 500px; background: #FFFFFF; box-shadow: 0 0 0 1px rgba(0,0,0,0.08), 0 8px 30px rgba(0,0,0,0.08); border-radius: 12px; padding: 12px 12px 12px 20px; display: flex; align-items: center; justify-content: space-between; z-index: 20; border: 1px solid transparent; transition: all 0.3s ease; animation: slideUp 1s ease, aiGlowPulse 3s infinite alternate; }
        .ai-floating-bar.ai-active-response { border-color: var(--accent); box-shadow: 0 0 0 4px rgba(35, 131, 226, 0.2), 0 15px 40px rgba(35, 131, 226, 0.15); transform: translateY(-5px); }
        @keyframes aiGlowPulse { 0% { border-color: rgba(35, 131, 226, 0.3); } 100% { border-color: var(--accent); } }
        .ai-input-wrapper { display: flex; align-items: center; gap: 12px; width: 100%; }
        .sparkle-icon { color: #9D34DA; width: 20px; height: 20px; flex-shrink: 0; animation: spinSlow 10s linear infinite; }
        @keyframes spinSlow { to { transform: rotate(360deg); } }
        .real-ai-input { border: none; background: transparent; outline: none; font-size: 15px; color: var(--text-main); width: 100%; }
        .ai-send-btn { width: 32px; height: 32px; background-color: var(--text-main); border-radius: 6px; display: flex; align-items: center; justify-content: center; color: white; cursor: pointer; transition: all 0.2s; }
        .ai-send-btn:hover { background-color: var(--accent); }

        .right-panel { flex: 1; display: flex; justify-content: center; align-items: center; background: white; padding: 40px; z-index: 30; height: 100%; position: relative; }
        .brand-logo-overlay { position: absolute; top: 30px; left: 40px; z-index: 50; display: flex; align-items: center; gap: 10px; background: white; padding: 8px 14px; border-radius: 8px; cursor: pointer; }
        .brand-logo-img { width: 24px; height: 24px; object-fit: contain; }
        .brand-logo-text { font-weight: 700; font-size: 15px; color: var(--text-main); }
        
        .content-stack { width: 100%; max-width: 380px; display: flex; flex-direction: column; gap: 30px; }
        .login-card { text-align: center; animation: fadeIn 0.8s ease; width: 100%; }
        .avatar-frame { width: 90px; height: 90px; margin: 0 auto 20px; border-radius: 12px; transform: rotate(-3deg); background: white; padding: 5px; border: 1px solid rgba(0,0,0,0.08); box-shadow: 0 5px 20px rgba(0,0,0,0.08); position: relative; cursor: pointer; transition: transform 0.3s ease; }
        .avatar-frame:hover { transform: rotate(0deg) scale(1.05); z-index: 50; }
        .avatar-frame img { width: 100%; height: 100%; border-radius: 8px; object-fit: cover; }
        
        .auth-form { display: flex; flex-direction: column; gap: 12px; margin-bottom: 16px; width: 100%; }
        .form-input { width: 100%; padding: 10px 12px; border: 1px solid #E0E0E0; border-radius: 4px; font-size: 14px; color: var(--text-main); outline: none; background: #FAFAFA; }
        .form-input:focus { border-color: var(--accent); background: white; }
        
        .btn-primary { width: 100%; padding: 10px 14px; background: var(--text-main); color: white; border: none; border-radius: 4px; font-size: 14px; font-weight: 600; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 8px; }
        .btn-primary:hover { background: #000; transform: translateY(-1px); }
        .divider { display: flex; align-items: center; gap: 10px; margin: 16px 0; color: #C0C0C0; font-size: 12px; font-weight: 500; width: 100%; }
        .divider::before, .divider::after { content: ""; flex: 1; height: 1px; background: #E0E0E0; }
        .btn-google { width: 100%; padding: 10px 14px; background: white; border: 1px solid #D4D4D4; border-radius: 4px; display: flex; align-items: center; justify-content: center; gap: 10px; font-size: 14px; font-weight: 500; color: var(--text-main); cursor: pointer; }
        .btn-google:hover { background: #F7F7F5; }
        .toggle-auth { font-size: 13px; margin-top: 16px; color: var(--text-sub); }
        .toggle-link { color: var(--accent); font-weight: 600; cursor: pointer; text-decoration: none; }
        
        .community-card { background: white; border: 1px solid var(--border); border-radius: 8px; padding: 16px; box-shadow: 0 4px 15px rgba(0,0,0,0.03); animation: slideUp 1s ease 0.2s backwards; min-height: 200px; }
        .card-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 16px; border-bottom: 1px solid #F0F0F0; padding-bottom: 8px; }
        .chat-list { display: flex; flex-direction: column; gap: 12px; }
        .chat-row, .badge-row { opacity: 0; transform: translateY(10px); animation: messagePop 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards; }
        .chat-row { display: flex; gap: 10px; align-items: flex-start; }
        .chat-pfp { width: 28px; height: 28px; border-radius: 4px; background: #F7F7F5; border: 1px solid var(--border); flex-shrink: 0; }
        .chat-bubble { background: #F7F7F5; padding: 8px 12px; border-radius: 6px; font-size: 13px; color: var(--text-main); line-height: 1.4; max-width: 240px; }
        .user-name { font-weight: 600; font-size: 11px; color: var(--text-main); display: block; margin-bottom: 2px; }
        @keyframes messagePop { to { opacity: 1; transform: translateY(0); } }

        .screen-two { width: 100%; min-height: 100vh; background-color: white; background-image: linear-gradient(#F0F0F0 1px, transparent 1px), linear-gradient(90deg, #F0F0F0 1px, transparent 1px); background-size: 40px 40px; display: flex; flex-direction: column; align-items: center; position: relative; padding: 80px 20px 40px; }
        .community-headline { font-size: 40px; font-weight: 700; letter-spacing: -1px; margin-bottom: 16px; text-align: center; color: var(--text-main); }
        .invitation-highlight-wrapper { display: flex; justify-content: center; margin-bottom: 10px; position: relative; background: radial-gradient(closest-side, rgba(35, 131, 226, 0.08) 0%, rgba(255,255,255,0) 100%); padding: 30px; border-radius: 50%; animation: pulseGlow 4s ease-in-out infinite; }
        @keyframes pulseGlow { 0%, 100% { opacity: 0.6; } 50% { opacity: 1; } }
        .avatar-pile { display: flex; justify-content: center; padding-left: 10px; }
        .community-avatar-wrapper { position: relative; margin-left: -15px; transition: transform 0.2s ease; z-index: 1; }
        .community-avatar-wrapper:hover { transform: translateY(-5px); z-index: 20; }
        .crowd-avatar-circle { width: 50px; height: 50px; border-radius: 50%; background: #fff; border: 3px solid #fff; box-shadow: 0 2px 8px rgba(0,0,0,0.08); display: block; }
        .central-image-container { width: 100%; position: relative; z-index: 5; margin-top: -10px; margin-bottom: 40px; }
        .central-work-img { width: 100%; height: auto; display: block; mix-blend-mode: multiply; opacity: 0.95; }

        .team-timeline-section { width: 100%; max-width: 1200px; display: flex; flex-direction: column; align-items: center; margin-bottom: 80px; z-index: 10; position: relative; }
        .team-headline { font-size: 32px; font-weight: 700; color: var(--text-main); margin-bottom: 70px; letter-spacing: -0.5px; }
        .timeline-container { display: flex; justify-content: center; gap: 50px; position: relative; width: 100%; padding: 30px 0; }
        .timeline-container::before { content: ""; position: absolute; top: 50%; left: 5%; right: 5%; height: 2px; background: #E0E0E0; z-index: 0; border-radius: 2px; }
        .team-node { position: relative; z-index: 2; display: flex; flex-direction: column; align-items: center; width: 220px; transition: transform 0.3s; }
        .team-card-inner { background: #FFFFFF; border: 1px solid var(--border); border-radius: 16px; padding: 30px 15px; width: 100%; text-align: center; box-shadow: 0 4px 12px rgba(0,0,0,0.03); transition: all 0.3s ease; position: relative; }
        .team-node:hover { transform: translateY(-10px); }
        .team-avatar { width: 90px; height: 90px; border-radius: 50%; object-fit: cover; margin-bottom: 16px; border: 3px solid white; box-shadow: 0 2px 10px rgba(0,0,0,0.06); background: #F7F7F5; }
        .team-quote-bubble { position: absolute; top: 110%; left: 50%; transform: translateX(-50%) translateY(-10px); width: 220px; background: #FFFFFF; border: 1px solid var(--accent); color: var(--accent); padding: 12px 16px; border-radius: 8px; font-size: 13px; font-weight: 500; line-height: 1.4; box-shadow: 0 4px 15px rgba(35, 131, 226, 0.15); opacity: 0; visibility: hidden; transition: all 0.3s ease; pointer-events: none; z-index: 10; }
        .team-node:hover .team-quote-bubble { opacity: 1; visibility: visible; transform: translateX(-50%) translateY(5px); }

        .overlay-backdrop { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); backdrop-filter: blur(8px); display: none; justify-content: center; align-items: center; z-index: 9999; opacity: 0; transition: opacity 0.4s ease; }
        .overlay-backdrop.active { display: flex; opacity: 1; }
        .overlay-backdrop.active .overlay-modal { transform: translateY(0); }
        .overlay-modal { background: #FFFFFF; width: 90%; max-width: 420px; border-radius: 16px; padding: 32px 24px; box-shadow: 0 20px 50px rgba(0,0,0,0.2); text-align: center; transform: translateY(20px); transition: transform 0.4s ease; }
        .overlay-title { font-size: 20px; font-weight: 800; color: var(--text-main); margin-bottom: 8px; }
        .overlay-desc { font-size: 14px; color: var(--text-sub); line-height: 1.5; margin-bottom: 24px; }
        .btn-group { display: flex; gap: 12px; margin-top: 10px; }
        .btn-confirm { background: var(--accent); color: white; flex: 1; padding: 12px; border-radius: 8px; border: none; font-weight: 600; cursor: pointer; }
        .btn-reject { background: #F0F0F0; color: var(--text-sub); flex: 1; padding: 12px; border-radius: 8px; border: none; font-weight: 600; cursor: pointer; }

        @media (max-width: 900px) {
            .left-panel { display: none; }
            .screen-one { height: auto; min-height: 100vh; }
            .community-headline { font-size: 32px; }
            .timeline-container { flex-direction: column; gap: 30px; align-items: center; }
            .timeline-container::before { width: 2px; height: 80%; left: 50%; top: 10%; } 
        }
        @keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes fadeIn { to { opacity: 1; } }
        .spinner { display: none; width: 18px; height: 18px; border: 2px solid #ccc; border-top-color: #333; border-radius: 50%; animation: spin 0.8s linear infinite; }
        @keyframes spin { to { transform: rotate(360deg); } }

    </style>
<script type="importmap">
{
  "imports": {
    "react": "https://esm.sh/react@^19.2.3",
    "react-dom/": "https://esm.sh/react-dom@^19.2.3/",
    "react/": "https://esm.sh/react@^19.2.3/",
    "lucide-react": "https://esm.sh/lucide-react@^0.560.0",
    "marked": "https://esm.sh/marked@^17.0.1"
  }
}
</script>
</head>

<body class="h-screen overflow-hidden">

    <!-- AUTH / LANDING VIEW -->
    <div id="auth-view">
        <div id="notification-container"></div>

        <div class="overlay-backdrop" id="welcomeOverlay">
            <div class="overlay-modal">
                <div class="overlay-image-container relative w-full h-40 mb-6 bg-[#F7F7F5] rounded-xl overflow-hidden">
                    <img src="https://i.imghippo.com/files/wUb7431UjA.png" class="w-full h-full object-cover">
                </div>
                <h2 class="overlay-title">Welcome to EduLink!</h2>
                <p class="overlay-desc">Connect, collaborate, and grow with our community. We're excited to have you join our journey.</p>
                <button class="btn-primary" id="closeOverlayBtn">Join Us</button>
            </div>
        </div>

        <div class="overlay-backdrop" id="termsOverlay">
            <div class="overlay-modal">
                <h2 class="overlay-title">Terms & Privacy</h2>
                <p class="overlay-desc">By creating an account, you agree to our Policy. Please confirm to proceed.</p>
                <div class="btn-group">
                    <button class="btn-reject" id="termsReject">Cancel</button>
                    <button class="btn-confirm" id="termsConfirm">Agree & Continue</button>
                </div>
            </div>
        </div>

        <div class="screen-one">
            <div class="left-panel">
                <div class="marquee-container">
                    <div class="marquee-col scroll-up">
                        <div class="gallery-card"><img src="https://i.imghippo.com/files/mKXQ6766VHE.jpeg"></div>
                        <div class="gallery-card"><img src="https://i.imghippo.com/files/MSeU9720hj.jpeg"></div>
                        <div class="gallery-card"><img src="https://i.imghippo.com/files/BAm5876iL.jpeg"></div>
                        <div class="gallery-card"><img src="https://i.imghippo.com/files/zUQv3054UtU.jpeg"></div>
                    </div>
                    <div class="marquee-col scroll-down">
                        <div class="gallery-card"><img src="https://i.imghippo.com/files/WeTT3339kIA.jpeg"></div>
                        <div class="gallery-card"><img src="https://i.imghippo.com/files/MVDl3017QY.jpeg"></div>
                        <div class="gallery-card"><img src="https://i.imghippo.com/files/NaWq7558Gno.jpeg"></div>
                        <div class="gallery-card"><img src="https://i.imghippo.com/files/BAm5876iL.jpeg"></div>
                    </div>
                </div>
                <div class="ai-floating-bar">
                    <div class="ai-input-wrapper">
                        <svg class="sparkle-icon" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2L14.39 9.26L22 12L14.39 14.74L12 22L9.61 14.74L2 12L9.61 9.26L12 2Z" /></svg>
                        <input type="text" class="real-ai-input" placeholder="Ask EduLink AI..." />
                    </div>
                    <div class="ai-send-btn"><i data-lucide="arrow-up" class="w-4 h-4"></i></div>
                </div>
            </div>

            <div class="right-panel">
                <div class="brand-logo-overlay">
                    <img src="https://i.imghippo.com/files/vgr8207c.png" class="brand-logo-img">
                    <span class="brand-logo-text">EduLink</span>
                </div>

                <div class="content-stack">
                    <div class="login-card">
                        <div class="avatar-frame">
                            <img id="main-avatar-img" src="https://api.dicebear.com/9.x/lorelei/svg?seed=Chase&backgroundColor=transparent&flip=true">
                        </div>
                        <div class="title-group">
                            <h1 id="auth-title">Welcome Back</h1>
                            <div class="subtitle-main" id="auth-subtitle">Access your workspace and AI tools.</div>
                        </div>

                        <div class="auth-form">
                            <input type="email" id="email-input" class="form-input" placeholder="Email address">
                            <input type="password" id="password-input" class="form-input" placeholder="Password">
                            <div id="signup-fields" class="hidden">
                                <div class="file-input-wrapper relative border border-dashed border-gray-300 rounded p-3 text-center cursor-pointer hover:bg-gray-50">
                                    <span class="file-label-text text-xs text-gray-500">Upload Profile Picture</span>
                                    <input type="file" id="profile-pic-input" accept="image/*" class="absolute inset-0 opacity-0 cursor-pointer">
                                </div>
                            </div>
                            <button id="email-auth-btn" class="btn-primary">Sign In</button>
                        </div>

                        <div class="divider">OR</div>

                        <button id="google-btn" class="btn-google">
                            <svg width="18" height="18" viewBox="0 0 18 18"><path d="M17.64 9.2c0-.637-.057-1.251-.164-1.84H9v3.481h4.844a4.14 4.14 0 0 1-1.796 2.716v2.259h2.908c1.702-1.567 2.684-3.875 2.684-6.615z" fill="#4285F4"></path><path d="M9 18c2.43 0 4.467-.806 5.956-2.18l-2.908-2.259c-.806.54-1.837.86-3.048.86-2.344 0-4.328-1.584-5.036-3.715H.957v2.332A8.997 8.997 0 0 0 9 18z" fill="#34A853"></path><path d="M3.964 10.71A5.41 5.41 0 0 1 3.682 9c0-.593.102-1.17.282-1.71V4.958H.957A8.996 8.996 0 0 0 0 9c0 1.452.348 2.827.957 4.042l3.007-2.332z" fill="#FBBC05"></path><path d="M9 3.58c1.321 0 2.508.454 3.44 1.345l2.582-2.58C13.463.891 11.426 0 9 0A8.997 8.997 0 0 0 .957 4.958L3.964 7.29C4.672 5.163 6.656 3.58 9 3.58z" fill="#EA4335"></path></svg>
                            <span id="btn-text">Continue with Google</span>
                        </button>

                        <div class="toggle-auth">
                            <span id="toggle-text">Don't have an account?</span>
                            <span id="toggle-link" class="toggle-link">Sign up</span>
                        </div>
                    </div>

                    <div class="community-card">
                        <div class="card-header">
                            <span class="header-title flex items-center gap-1"><i data-lucide="activity" class="w-3 h-3"></i> Updates</span>
                            <span style="font-size: 11px; color: #32D74B; font-weight: 600;">● Online</span>
                        </div>
                        <div class="chat-list" id="chat-list-container"></div>
                    </div>
                </div>
            </div>
        </div>

        <div class="screen-two">
            <div class="community-group-container reveal-on-scroll">
                <h2 class="community-headline">Join our small community</h2>
                <div class="invitation-highlight-wrapper">
                    <div class="avatar-pile">
                        <div class="community-avatar-wrapper"><img class="crowd-avatar-circle" src="https://api.dicebear.com/9.x/lorelei/svg?seed=Annie&backgroundColor=f0f0f0"></div>
                        <div class="community-avatar-wrapper"><img class="crowd-avatar-circle" src="https://api.dicebear.com/9.x/lorelei/svg?seed=Bob&backgroundColor=e6e6fa"></div>
                        <div class="community-avatar-wrapper"><img class="crowd-avatar-circle" src="https://api.dicebear.com/9.x/lorelei/svg?seed=Cathy&backgroundColor=ffefd5"></div>
                    </div>
                </div>
                <div class="central-image-container reveal-on-scroll">
                    <img src="https://i.imghippo.com/files/ij1473meM.png" class="central-work-img">
                </div>
            </div>

            <div class="team-timeline-section reveal-on-scroll">
                <div class="team-headline">Meet the Team</div>
                <div class="timeline-container">
                    <div class="team-node">
                        <div class="team-card-inner">
                            <img src="https://api.dicebear.com/9.x/lorelei/svg?seed=Joshua" class="team-avatar">
                            <div class="team-name">Jigdral</div><div class="team-role">Researcher</div>
                        </div>
                        <div class="team-quote-bubble">"Education is the only thing that can help you get out of struggles"</div>
                    </div>
                    <div class="team-node">
                        <div class="team-card-inner">
                            <img src="https://api.dicebear.com/9.x/lorelei/svg?seed=Sarah" class="team-avatar">
                            <div class="team-name">Ngawang</div><div class="team-role">Founder</div>
                        </div>
                        <div class="team-quote-bubble">"Future of education is in your hand"</div>
                    </div>
                    <div class="team-node">
                        <div class="team-card-inner">
                            <img src="https://api.dicebear.com/9.x/lorelei/svg?seed=Sadie" class="team-avatar">
                            <div class="team-name">Sonam</div><div class="team-role">Co-Founder</div>
                        </div>
                        <div class="team-quote-bubble">"All it takes is one person"</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- MAIN APP VIEW (Hidden until login) -->
    <div id="app-view" class="h-screen flex overflow-hidden p-0 md:p-3 gap-4 bg-[#f9fafb]">
        <!-- Post Options Global Menu -->
        <div id="global-post-menu" class="post-options-menu"></div>

        <!-- Post View Overlay -->
        <div id="post-view-overlay" class="fixed inset-0 z-[60] hidden flex justify-center items-end md:items-center">
            <div class="absolute inset-0 bg-black/40 backdrop-blur-sm transition-opacity" onclick="closePostView()"></div>
            <div class="bg-white w-full md:w-[1000px] h-[95vh] md:h-[85vh] md:rounded-2xl rounded-t-2xl shadow-2xl relative flex flex-col md:flex-row transform transition-transform duration-300 scale-100 opacity-100 overflow-hidden scale-in">
                 <div class="w-full md:w-[60%] flex flex-col h-full bg-white md:border-r border-gray-100 relative">
                     <div class="h-16 border-b border-gray-100 flex items-center justify-between px-6 shrink-0 bg-white z-10 sticky top-0">
                        <button onclick="closePostView()" class="icon-btn hover:bg-gray-100 md:hidden"><i data-lucide="chevron-down" class="w-6 h-6"></i></button>
                        <span class="font-bold text-lg text-[#1f1f1f] hidden md:block">Post</span>
                        <span class="font-bold text-lg text-[#1f1f1f] md:hidden">Details</span>
                        <button class="icon-btn hover:bg-gray-100"><i data-lucide="more-horizontal" class="w-5 h-5"></i></button>
                     </div>
                     <div id="post-view-scroll" class="flex-1 overflow-y-auto p-0 scroll-smooth">
                        <div id="injected-post" class="p-6 md:p-8"></div>
                        <div id="mobile-comments-section" class="md:hidden border-t border-gray-100">
                            <div class="p-4 bg-gray-50/50">
                                <h4 class="text-sm font-bold text-gray-800 mb-4">Comments</h4>
                                <div id="comments-list-mobile"></div>
                            </div>
                        </div>
                     </div>
                     <div class="md:hidden border-t border-gray-100 p-3 bg-white shrink-0 sticky bottom-0 z-20">
                         <div class="flex gap-3 items-center">
                            <img src="https://api.dicebear.com/9.x/notionists/svg?seed=JD" class="w-8 h-8 rounded-full bg-gray-100 border border-gray-200">
                            <div class="flex-1 bg-gray-100 rounded-full px-4 py-2 text-sm text-gray-500">Add a comment...</div>
                            <button class="text-[#0b57d0] font-bold text-sm">Post</button>
                         </div>
                     </div>
                 </div>
                 <div class="hidden md:flex w-[40%] flex-col h-full bg-[#fff]">
                     <div class="h-16 border-b border-gray-100 flex items-center justify-between px-4 shrink-0 bg-white">
                         <span class="font-bold text-[#1f1f1f]">Comments</span>
                         <button onclick="closePostView()" class="icon-btn hover:bg-gray-100"><i data-lucide="x" class="w-5 h-5"></i></button>
                     </div>
                     <div id="comments-list-desktop" class="flex-1 overflow-y-auto p-0 bg-white"></div>
                     <div class="p-4 border-t border-gray-100 bg-white shrink-0">
                        <div class="bg-gray-50 rounded-2xl p-3 border border-gray-200 focus-within:ring-2 focus-within:ring-blue-100 focus-within:border-blue-300 transition-all flex gap-3">
                            <img id="comment-input-avatar" src="" class="w-8 h-8 rounded-full bg-gray-100 border border-gray-200 shrink-0 mt-1">
                            <div class="flex-1">
                                <textarea id="comment-input-desktop" placeholder="Add a comment..." class="w-full bg-transparent outline-none text-[14px] text-gray-800 placeholder-gray-500 resize-none min-h-[40px] py-1" oninput="this.style.height='auto';this.style.height=this.scrollHeight+'px'"></textarea>
                                <div class="flex justify-between items-center mt-2 pt-2 border-t border-gray-200/60">
                                    <div class="flex gap-1">
                                        <button class="p-2 rounded-full hover:bg-gray-200 text-gray-500 transition-colors"><i data-lucide="smile" class="w-4 h-4"></i></button>
                                    </div>
                                    <button onclick="submitCommentDesktop()" class="bg-[#0b57d0] text-white px-5 py-1.5 rounded-full text-[13px] font-bold hover:bg-blue-700 transition-all shadow-sm hover:shadow active:scale-95">Post</button>
                                </div>
                            </div>
                        </div>
                     </div>
                 </div>
            </div>
        </div>

        <div id="lightbox" class="fixed inset-0 bg-black/95 z-[9999] flex justify-center items-center opacity-0 pointer-events-none transition-opacity duration-300" onclick="closeLightbox()">
            <button class="absolute top-8 right-8 text-white/70 hover:text-white bg-white/10 rounded-full p-3 hover:bg-white/20"><i data-lucide="x" class="w-8 h-8"></i></button>
            <div id="lightbox-wrapper" class="w-full h-full flex justify-center items-center p-6"></div>
        </div>

        <div id="toast" class="toast">
            <i id="toast-icon" data-lucide="check-circle-2" class="w-5 h-5 text-[#c4eed0]"></i><span id="toast-msg">Action Completed</span>
        </div>

        <!-- CREATE SELECTION OVERLAY -->
        <div id="create-menu-overlay" class="fixed inset-0 z-50 flex items-center justify-center bg-[#000]/40 backdrop-blur-sm opacity-0 pointer-events-none transition-opacity duration-200" onclick="closeCreateMenu()">
            <div id="create-menu-modal" class="bg-white w-[90%] max-w-[500px] rounded-[24px] shadow-2xl p-6 relative transform scale-95 transition-transform duration-200" onclick="event.stopPropagation()">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-xl font-bold text-[#1f1f1f] google-font">Create New</h2>
                    <button onclick="closeCreateMenu()" class="icon-btn hover:bg-[#f0f4f9]"><i data-lucide="x" class="w-5 h-5"></i></button>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div class="create-option-card" onclick="openCompose()">
                        <div class="create-icon-bg"><i data-lucide="pen-tool" class="w-6 h-6"></i></div>
                        <span class="font-bold text-[#1f1f1f]">Post</span>
                    </div>
                    <div class="create-option-card" onclick="openEventComposer()">
                        <div class="create-icon-bg"><i data-lucide="calendar-plus" class="w-6 h-6"></i></div>
                        <span class="font-bold text-[#1f1f1f]">Event</span>
                    </div>
                    <div class="create-option-card" onclick="openMentorship()">
                        <div class="create-icon-bg"><i data-lucide="graduation-cap" class="w-6 h-6"></i></div>
                        <span class="font-bold text-[#1f1f1f]">Mentorship</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- EDIT PROFILE OVERLAY -->
        <div id="edit-profile-overlay" class="fixed inset-0 z-50 flex items-center justify-center bg-[#000]/40 backdrop-blur-sm opacity-0 pointer-events-none transition-opacity duration-200" onclick="closeEditProfile()">
            <div id="edit-profile-modal" class="bg-white w-[90%] max-w-[400px] rounded-[24px] shadow-2xl p-6 relative transform scale-95 transition-transform duration-200" onclick="event.stopPropagation()">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-xl font-bold google-font">Edit Profile</h2>
                    <button onclick="closeEditProfile()" class="icon-btn"><i data-lucide="x" class="w-5 h-5"></i></button>
                </div>
                <div class="flex flex-col gap-4">
                    <div class="flex flex-col items-center mb-2">
                        <div class="relative group cursor-pointer" onclick="document.getElementById('edit-avatar-input').click()">
                            <img id="edit-avatar-preview" src="" class="w-20 h-20 rounded-full border-2 border-gray-100 object-cover">
                            <div class="absolute inset-0 bg-black/40 rounded-full flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity">
                                <i data-lucide="camera" class="text-white w-6 h-6"></i>
                            </div>
                        </div>
                        <input type="file" id="edit-avatar-input" class="hidden" accept="image/*" onchange="handleEditAvatarSelect(event)">
                        <span class="text-xs text-gray-500 mt-2">Tap to change</span>
                    </div>
                    <div>
                        <label class="text-xs font-bold text-gray-500 uppercase">Display Name</label>
                        <input type="text" id="edit-name" class="w-full border-b border-gray-200 py-2 outline-none focus:border-blue-500 font-medium text-gray-900">
                    </div>
                    <div>
                        <label class="text-xs font-bold text-gray-500 uppercase">Bio</label>
                        <textarea id="edit-bio" class="w-full border-b border-gray-200 py-2 outline-none focus:border-blue-500 text-sm text-gray-700 resize-none" rows="2"></textarea>
                    </div>
                    <button onclick="saveProfileChanges()" class="bg-[#0b57d0] text-white py-3 rounded-xl font-bold mt-2 hover:bg-blue-700">Save Changes</button>
                </div>
            </div>
        </div>

        <!-- MENTORSHIP MODAL -->
        <div id="mentorship-overlay" class="fixed inset-0 z-[55] flex items-center justify-center bg-[#000]/40 backdrop-blur-sm opacity-0 pointer-events-none transition-opacity duration-200">
            <div id="mentorship-modal-box" class="bg-white w-[90%] max-w-[400px] rounded-[24px] shadow-2xl p-8 relative transform scale-95 transition-transform duration-200 flex flex-col items-center text-center">
                <button onclick="closeMentorship()" class="absolute top-4 right-4 icon-btn hover:bg-[#f0f4f9]"><i data-lucide="x" class="w-5 h-5"></i></button>
                <img src="https://api.dicebear.com/9.x/lorelei/svg?seed=Construction" class="w-24 h-24 mb-4">
                <h3 class="text-xl font-bold text-[#1f1f1f] mb-2 google-font">Under Construction!</h3>
                <p class="text-sm text-[#667085] leading-relaxed">The Mentorship module is currently being built with ❤️. Check back soon for exciting updates!</p>
                <button onclick="closeMentorship()" class="mt-6 bg-[#0b57d0] text-white px-6 py-2.5 rounded-full font-bold text-sm hover:bg-[#0b57d0]/90 transition-all">Got it</button>
            </div>
        </div>

        <!-- EVENT MODAL -->
        <input type="file" id="event-cover-input" class="hidden" accept="image/*" onchange="handleEventCoverSelect(event)">
        <div id="event-overlay" class="fixed inset-0 z-[55] flex items-center justify-center bg-[#000]/40 backdrop-blur-sm opacity-0 pointer-events-none transition-opacity duration-200">
            <div id="event-modal-box" class="bg-white w-[95%] max-w-[550px] rounded-[16px] shadow-2xl relative transform scale-95 transition-transform duration-200 flex flex-col overflow-hidden p-0">
                 <div id="event-cover-preview-container" class="w-full h-40 bg-gray-100 hidden relative group">
                    <img id="event-cover-preview" class="w-full h-full object-cover">
                    <button onclick="removeEventCover()" class="absolute top-2 right-2 bg-black/50 text-white p-1 rounded-full opacity-0 group-hover:opacity-100 transition-opacity hover:bg-black/70 z-20">
                        <i data-lucide="x" class="w-4 h-4"></i>
                    </button>
                     <button onclick="document.getElementById('event-cover-input').click()" class="absolute bottom-2 right-2 bg-white/80 text-gray-700 text-xs font-bold px-2 py-1 rounded opacity-0 group-hover:opacity-100 transition-opacity hover:bg-white z-20">
                        Change
                    </button>
                </div>
                <button onclick="closeEventComposer()" class="absolute top-4 right-4 icon-btn hover:bg-[#f0f4f9] z-10 bg-white/50 backdrop-blur-sm"><i data-lucide="x" class="w-5 h-5"></i></button>
                <div class="p-8 pt-6">
                    <div id="add-cover-btn" class="mb-6 opacity-60 hover:opacity-100 transition-opacity cursor-pointer flex items-center gap-2 text-sm text-[#667085]" onclick="document.getElementById('event-cover-input').click()">
                        <i data-lucide="image" class="w-4 h-4"></i> Add cover
                    </div>
                    <input type="text" id="event-title" placeholder="Untitled Event" class="text-3xl font-bold text-[#1f1f1f] placeholder-[#d1d5db] border-none outline-none bg-transparent w-full mb-6 google-font">
                    <div class="flex flex-col gap-1 mb-6">
                        <div class="notion-input-row">
                            <div class="notion-label"><i data-lucide="clock" class="w-4 h-4"></i> Date</div>
                            <input type="date" id="event-date" class="notion-input">
                        </div>
                        <div class="notion-input-row">
                            <div class="notion-label"><i data-lucide="watch" class="w-4 h-4"></i> Time</div>
                            <input type="time" id="event-time" class="notion-input">
                        </div>
                        <div class="notion-input-row">
                            <div class="notion-label"><i data-lucide="map-pin" class="w-4 h-4"></i> Location</div>
                            <input type="text" id="event-location" placeholder="Add location..." class="notion-input">
                        </div>
                    </div>
                    <textarea id="event-desc" placeholder="Add description..." class="w-full min-h-[100px] resize-none border-none outline-none text-[#374151] text-[15px] leading-relaxed bg-transparent"></textarea>
                    <div class="flex justify-end mt-6 pt-4 border-t border-gray-100">
                        <button onclick="publishEvent()" class="bg-[#0b57d0] text-white px-6 py-2 rounded-lg font-bold text-sm hover:bg-[#0b57d0]/90 transition-all shadow-sm">Create Event</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- POST COMPOSE OVERLAY -->
        <div id="compose-overlay" class="fixed inset-0 z-[55] flex items-center justify-center bg-[#000]/40 backdrop-blur-sm opacity-0 pointer-events-none transition-opacity duration-200" onclick="closeCompose()">
            <div id="compose-modal" class="bg-white w-[95%] max-w-[620px] rounded-[24px] shadow-2xl p-6 relative transform scale-95 transition-transform duration-200 flex flex-col" onclick="event.stopPropagation()">
                <div class="compose-header">
                    <span class="compose-title" id="compose-title-text">Create Post</span>
                    <button onclick="closeCompose()" class="icon-btn hover:bg-[#f0f4f9] w-8 h-8"><i data-lucide="x" class="w-5 h-5"></i></button>
                </div>
                
                <div class="flex gap-3 mb-4 items-center">
                    <img id="compose-avatar" src="" class="w-10 h-10 rounded-full border border-gray-100 bg-gray-50 object-cover">
                    <div>
                        <div id="compose-name" class="text-[15px] font-bold text-[#1f1f1f]">User</div>
                        <div class="relative mt-1" onclick="event.stopPropagation()">
                            <button onclick="togglePrivacyMenu()" class="flex items-center gap-1.5 text-xs bg-gray-100 rounded-md py-1.5 px-3 text-gray-700 font-medium hover:bg-gray-200 transition-colors">
                                <i id="privacy-icon-display" data-lucide="globe" class="w-3.5 h-3.5"></i>
                                <span id="privacy-text-display">Public</span>
                                <i data-lucide="chevron-down" class="w-3 h-3 text-gray-400"></i>
                            </button>
                            <input type="hidden" id="post-privacy" value="public">
                            <div id="privacy-menu" class="absolute top-full left-0 mt-1 w-48 bg-white border border-gray-100 rounded-xl shadow-xl hidden z-50 p-1 transform origin-top-left transition-all">
                                <div onclick="selectPrivacy('public')" class="flex items-center gap-3 px-3 py-2.5 hover:bg-gray-50 rounded-lg cursor-pointer text-sm text-gray-700 transition-colors">
                                    <div class="w-8 h-8 rounded-full bg-blue-50 flex items-center justify-center text-blue-600"><i data-lucide="globe" class="w-4 h-4"></i></div>
                                    <div class="flex flex-col"><span class="font-semibold text-xs">Public</span><span class="text-[10px] text-gray-400">Anyone can see</span></div>
                                </div>
                                <div onclick="selectPrivacy('private')" class="flex items-center gap-3 px-3 py-2.5 hover:bg-gray-50 rounded-lg cursor-pointer text-sm text-gray-700 transition-colors">
                                    <div class="w-8 h-8 rounded-full bg-purple-50 flex items-center justify-center text-purple-600"><i data-lucide="lock" class="w-4 h-4"></i></div>
                                    <div class="flex flex-col"><span class="font-semibold text-xs">Private</span><span class="text-[10px] text-gray-400">Only you</span></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <textarea id="compose-text" placeholder="What do you want to share today?" class="compose-textarea"></textarea>
                
                <div id="media-preview-container" class="hidden media-preview-wrapper group">
                    <img id="media-preview-img" src="" class="hidden media-preview-content">
                    <video id="media-preview-video" src="" class="hidden media-preview-content" controls></video>
                    <button onclick="removeMedia()" class="absolute top-2 right-2 bg-black/60 text-white rounded-full p-1.5 hover:bg-black/80 transition-colors shadow-sm"><i data-lucide="x" class="w-4 h-4"></i></button>
                </div>
                
                <div class="compose-tools">
                    <div class="tool-group">
                        <button onclick="document.getElementById('media-input').click()" class="tool-btn" title="Add Media"><i data-lucide="image" class="w-5 h-5"></i></button>
                        <button onclick="insertCodeBlock()" class="tool-btn" title="Add Code"><i data-lucide="code-2" class="w-5 h-5"></i></button>
                        <button class="tool-btn" title="More"><i data-lucide="more-horizontal" class="w-5 h-5"></i></button>
                    </div>
                    <button id="btn-publish" onclick="publishPost()" class="bg-[#0b57d0] text-white px-6 py-2 rounded-full font-bold text-[15px] hover:bg-[#0b57d0]/90 transition-all shadow-sm hover:shadow-md disabled:opacity-50 disabled:cursor-not-allowed">Post</button>
                </div>
            </div>
        </div>

        <!-- NOTEBOOK -->
        <div id="notebook-backdrop" class="backdrop" onclick="closeNotebook()"></div>
        <div id="notebook-sheet" class="notebook-overlay overflow-hidden">
            <div class="h-20 border-b border-[#f0f0f0] flex items-center justify-between px-8 shrink-0 bg-white">
                <div class="flex items-center gap-4">
                    <div class="w-10 h-10 rounded-full bg-[#eff4ff] flex items-center justify-center text-[#0b57d0]"><i data-lucide="notebook-pen" class="w-5 h-5"></i></div>
                    <span class="google-font font-medium text-[22px] text-[#1f1f1f]">Smart Note</span>
                </div>
                <div class="flex items-center gap-3">
                    <button id="btn-use-ai" onclick="generateAiNotes()" class="hidden md:flex px-5 py-2.5 rounded-full text-sm font-bold text-[#0b57d0] bg-[#f9fafb] hover:bg-[#eff4ff] gap-2 items-center transition-colors"><i data-lucide="sparkles" class="w-4 h-4"></i> Generate Summary</button>
                    <button onclick="saveNote()" class="px-6 py-2.5 rounded-full text-sm font-bold bg-[#0b57d0] text-white hover:bg-[#0b57d0]/90 ml-2 shadow-sm">Save Note</button>
                    <button onclick="closeNotebook()" class="icon-btn"><i data-lucide="x" class="w-6 h-6"></i></button>
                </div>
            </div>
            <div class="flex-1 flex flex-col md:flex-row h-full overflow-hidden">
                <div class="hidden md:block w-[35%] bg-[#f9fafb] p-8 border-r border-[#eaecf0] overflow-y-auto">
                    <div class="mb-4 text-xs font-bold text-[#667085] uppercase tracking-wider">Reference Content</div>
                    <div id="notebook-source-content" class="bg-white p-6 rounded-[20px] shadow-sm border border-[#eaecf0] text-[14px] text-[#1f1f1f] leading-relaxed"></div>
                </div>
                <div class="w-full md:w-[65%] p-8 md:p-10 flex flex-col bg-white">
                    <input id="note-title" type="text" placeholder="Untitled Note" class="text-3xl font-medium text-[#1f1f1f] outline-none w-full mb-6 google-font placeholder-[#b0b0b0]">
                    <textarea id="note-body" placeholder="Start typing..." class="flex-1 w-full resize-none outline-none text-[17px] text-[#444746] leading-8"></textarea>
                </div>
            </div>
        </div>

        <!-- MAIN SIDEBAR -->
        <aside id="main-sidebar" class="hidden md:flex app-panel">
            <div class="h-12 flex items-center gap-3 mb-6 px-2">
                <img src="https://i.imghippo.com/files/fRGt5603uII.png" class="w-8 h-8 object-contain">
                <h1 class="text-[20px] font-bold text-[#1f1f1f] hidden lg:block tracking-tight">EduLink</h1>
            </div>
            
            <button onclick="openCreateMenu()" class="create-btn hidden lg:flex">
                <i data-lucide="plus" class="w-5 h-5"></i><span>Create</span>
            </button>

            <nav class="flex-1 space-y-1">
                <a href="#" onclick="switchView('feed'); return false;" id="nav-feed" class="nav-item active"><i data-lucide="home" class="w-5 h-5"></i> <span class="hidden lg:block">Home</span></a>
                <a href="#" onclick="switchView('network'); return false;" id="nav-network" class="nav-item"><i data-lucide="users" class="w-5 h-5"></i> <span class="hidden lg:block">Network</span></a>
                <a href="#" onclick="switchView('chat'); return false;" id="nav-chat" class="nav-item"><i data-lucide="message-circle" class="w-5 h-5"></i> <span class="hidden lg:block">Chat</span></a>
                <a href="#" onclick="showProfile(currentUser.id); return false;" id="nav-profile" class="nav-item"><i data-lucide="user" class="w-5 h-5"></i> <span class="hidden lg:block">Profile</span></a>
                
                <div class="pt-6 pb-2 px-3 hidden lg:block">
                    <span class="text-xs font-bold text-[#98a2b3] uppercase tracking-wider">Library</span>
                </div>
                <a href="#" onclick="switchView('saved'); return false;" id="nav-saved" class="nav-item"><i data-lucide="bookmark" class="w-5 h-5"></i> <span class="hidden lg:block">Saved</span></a>
                <a href="#" class="nav-item"><i data-lucide="file-text" class="w-5 h-5"></i> <span class="hidden lg:block">Notes</span></a>
            </nav>
            
            <div class="mt-auto pt-4 border-t border-gray-100 flex flex-col gap-2">
                <div class="sidebar-user group" onclick="showProfile(currentUser.id)">
                    <img id="sidebar-avatar" src="" class="w-9 h-9 rounded-full bg-gray-100 border border-gray-200 shrink-0 object-cover">
                    <div class="hidden lg:block">
                        <div id="sidebar-name" class="text-sm font-bold text-[#1f1f1f] group-hover:text-blue-700 transition-colors truncate w-[140px]">User</div>
                        <div class="text-xs text-[#667085]">View Profile</div>
                    </div>
                </div>
                <button onclick="handleLogout()" class="nav-item text-red-500 hover:bg-red-50 w-full justify-start"><i data-lucide="log-out" class="w-5 h-5"></i><span class="hidden lg:block">Log Out</span></button>
            </div>
        </aside>

        <div id="workspace-layout" class="flex-1 flex min-w-0 gap-4 relative overflow-hidden transition-all duration-300">
            <main id="main-panel" class="flex-1 app-panel min-w-0 relative">
                 <header class="h-16 md:h-20 flex items-center justify-between px-4 md:px-6 shrink-0 z-20 sticky top-0 bg-white/95 md:bg-white/90 backdrop-blur-md border-b border-[#f0f0f0]">
                    <div class="md:hidden flex items-center gap-3">
                         <img src="https://i.imghippo.com/files/fRGt5603uII.png" class="w-8 h-8 object-contain">
                         <h1 class="text-lg font-bold text-[#1f1f1f] tracking-tight">EduLink</h1>
                    </div>
                    <div class="flex-1 max-w-[600px] relative group hidden md:block">
                        <i data-lucide="search" class="absolute left-5 top-3.5 w-5 h-5 text-[#667085] group-focus-within:text-[#0b57d0] transition-colors"></i>
                        <input type="text" placeholder="Search EduLink" id="global-search" onkeyup="handleSearch(this.value)" class="w-full bg-[#f3f4f6] rounded-full py-3.5 pl-14 pr-6 outline-none focus:bg-[#ffffff] focus:shadow-sm focus:ring-1 focus:ring-gray-200 transition-all text-[#1f1f1f] text-[15px]">
                    </div>
                    <div class="flex items-center gap-3 pl-4">
                        <button class="icon-btn relative" onclick="toggleNotifications()">
                            <i data-lucide="bell" class="w-6 h-6"></i>
                            <span id="notif-badge" class="absolute top-2 right-2 w-2.5 h-2.5 bg-red-500 rounded-full border-2 border-white hidden"></span>
                        </button>
                        <img id="header-avatar" src="" class="w-9 h-9 rounded-full bg-gray-100 border border-gray-200 cursor-pointer hover:ring-2 ring-offset-1 ring-blue-500 transition-all hidden md:block" onclick="showProfile(currentUser.id)">
                    </div>
                </header>

                <!-- FEED VIEW -->
                <div id="view-feed" class="flex-1 h-full overflow-y-auto no-scrollbar p-0 bg-white">
                    <div id="feed-container"></div>
                    <div class="flex flex-col items-center justify-center py-10 opacity-60">
                        <img src="https://api.dicebear.com/9.x/lorelei/svg?seed=Chase" class="w-24 h-24 mb-4 opacity-80 grayscale hover:grayscale-0 transition-all duration-500">
                        <h3 class="text-lg font-bold text-gray-400 google-font">Grow and Share</h3>
                        <p class="text-sm text-gray-400 text-center max-w-xs mt-1">Your network starts here. Share your first idea!</p>
                    </div>
                </div>

                <!-- SAVED VIEW -->
                <div id="view-saved" class="flex-1 h-full overflow-y-auto no-scrollbar p-0 md:p-6 hidden bg-[#f9fafb] md:bg-[#fff]">
                    <h2 class="text-2xl font-bold mb-6 px-4 md:px-0">Saved Posts</h2>
                    <div id="saved-container" class="space-y-4"></div>
                </div>

                <!-- PROFILE VIEW -->
                <div id="view-profile" class="flex-1 h-full overflow-y-auto no-scrollbar hidden bg-white"></div>

                <!-- NOTIFICATIONS VIEW (Moved from Overlay) -->
                <div id="view-notifications" class="flex-1 h-full overflow-y-auto no-scrollbar p-0 md:p-6 hidden bg-[#f9fafb] md:bg-[#fff]">
                    <h2 class="text-2xl font-bold mb-6 px-4 md:px-0">Notifications</h2>
                    <div class="tab-group mb-6 mx-4 md:mx-0">
                        <button onclick="switchNotifTab('friends')" id="ntab-friends" class="tab-btn active">Friends</button>
                        <button onclick="switchNotifTab('others')" id="ntab-others" class="tab-btn">Others</button>
                        <button onclick="switchNotifTab('official')" id="ntab-official" class="tab-btn">Official</button>
                    </div>
                    <div id="notification-list" class="space-y-2 px-4 md:px-0 w-full"></div>
                </div>

                <!-- CHAT VIEW -->
                <div id="view-chat" class="flex-1 h-full hidden flex flex-col bg-white">
                    <div class="flex h-full">
                        <div class="w-1/4 min-w-[260px] border-r border-gray-100 flex flex-col bg-[#fbfbfa]">
                            <div class="p-4 border-b border-gray-100 font-medium text-xs text-gray-500 uppercase tracking-wide">Direct Messages</div>
                            <div id="chat-list" class="flex-1 overflow-y-auto pt-2"></div>
                        </div>
                        <div class="flex-1 flex flex-col relative bg-white">
                            <div id="chat-header" class="h-16 border-b border-gray-100 bg-white flex items-center justify-between px-6 font-semibold text-gray-800 text-[15px]">
                                Select a friend to chat
                            </div>
                            <div id="chat-messages" class="flex-1 overflow-y-auto p-6 flex flex-col"></div>
                            <div id="chat-input-area" class="p-4 bg-white hidden">
                                <form onsubmit="sendChatMessage(event)" class="flex gap-3 items-center border border-gray-200 rounded-xl p-2 px-3 focus-within:ring-2 focus-within:ring-blue-100 focus-within:border-blue-300 transition-all">
                                    <input id="message-input" type="text" placeholder="Type a message..." class="flex-1 bg-transparent outline-none text-sm text-gray-800 placeholder-gray-400">
                                    <button type="submit" class="text-blue-600 hover:bg-blue-50 p-2 rounded-lg transition-colors"><i data-lucide="send" class="w-4 h-4"></i></button>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- EVENTS VIEW -->
                <div id="view-events" class="flex-1 h-full overflow-y-auto p-0 md:p-6 hidden bg-[#f9fafb] md:bg-[#fff]">
                    <div class="flex items-center justify-between mb-6 px-4 md:px-0">
                        <h2 class="text-2xl font-bold text-[#1f1f1f]">Upcoming Events</h2>
                        <button onclick="openEventComposer()" class="bg-[#0b57d0] text-white px-4 py-2 rounded-lg text-sm font-bold flex items-center gap-2"><i data-lucide="plus" class="w-4 h-4"></i> New Event</button>
                    </div>
                    <div id="events-list" class="grid grid-cols-1 gap-4 px-4 md:px-0">
                        <div class="bg-white border border-[#eaecf0] rounded-xl overflow-hidden hover:border-[#c2e7ff] hover:shadow-sm transition-all cursor-pointer">
                             <div class="h-32 bg-gradient-to-r from-blue-100 to-indigo-100 flex items-center justify-center text-indigo-300">
                                <i data-lucide="image" class="w-10 h-10"></i>
                             </div>
                             <div class="p-5">
                                 <h3 class="text-lg font-bold text-[#1f1f1f] mb-2">System Design Workshop</h3>
                                 <div class="space-y-2 text-sm text-[#4b5563]">
                                     <div class="flex items-center gap-2"><i data-lucide="calendar" class="w-4 h-4 text-[#9ca3af]"></i> Oct 24, 2023</div>
                                     <div class="flex items-center gap-2"><i data-lucide="watch" class="w-4 h-4 text-[#9ca3af]"></i> 14:00 PM</div>
                                     <div class="flex items-center gap-2"><i data-lucide="map-pin" class="w-4 h-4 text-[#9ca3af]"></i> Room 302, Tech Block</div>
                                 </div>
                                 <div class="mt-4 pt-4 border-t border-gray-100 flex items-center gap-2">
                                    <img src="https://api.dicebear.com/9.x/notionists/svg?seed=JD" class="w-6 h-6 rounded-full border border-gray-200">
                                    <span class="text-xs text-gray-500">Hosted by Jane Doe</span>
                                 </div>
                             </div>
                        </div>
                    </div>
                </div>
                 <!-- SEARCH RESULTS VIEW -->
                <div id="view-search-results" class="flex-1 h-full overflow-y-auto no-scrollbar p-0 md:p-6 hidden bg-[#f9fafb] md:bg-[#fff]"></div>

            </main>

            <!-- AI PANEL (Newton) -->
            <aside id="ai-panel" class="ai-panel hidden xl:flex app-panel mb-16 md:mb-0">
                 <div class="h-16 md:h-20 shrink-0 border-b border-[#f0f0f0] flex items-center justify-between px-6 bg-white/95 backdrop-blur z-20">
                    <div class="flex items-center gap-3">
                        <img id="ai-header-logo" src="https://i.imghippo.com/files/XEEq5247S.png" class="w-9 h-9 object-contain">
                        <span id="ai-header-name" class="text-[19px] font-medium text-[#1f1f1f] google-font">Newton</span>
                    </div>
                    <div class="flex items-center gap-2">
                        <button onclick="resetChat()" class="icon-btn bg-[#f9fafb] hover:bg-[#eaecf0] border border-[#eaecf0]" title="New Chat">
                            <i data-lucide="plus" class="w-5 h-5 text-[#667085]"></i>
                        </button>
                        <div class="relative">
                            <button onclick="toggleModelMenu()" class="icon-btn bg-[#f9fafb] hover:bg-[#eaecf0] border border-[#eaecf0]" title="More Options">
                                <i data-lucide="more-vertical" class="w-5 h-5 text-[#667085]"></i>
                            </button>
                            <div id="model-menu" class="model-menu">
                                <div class="px-2 py-2 text-xs font-bold text-[#667085] uppercase tracking-wider">Select Model</div>
                                <div onclick="switchModel('standard')" class="menu-item active-item" id="model-btn-standard">
                                    <img src="https://i.imghippo.com/files/XEEq5247S.png" class="w-5 h-5 object-contain"> Newton
                                </div>
                                <div onclick="switchModel('friendly')" class="menu-item" id="model-btn-friendly">
                                    <img src="https://api.dicebear.com/9.x/lorelei/svg?seed=Chase" class="w-5 h-5 rounded-full bg-indigo-50"> Tutor Chase
                                </div>
                                <div onclick="switchModel('logical')" class="menu-item" id="model-btn-logical">
                                    <img src="https://api.dicebear.com/9.x/lorelei/svg?seed=Adrian" class="w-5 h-5 rounded-full bg-teal-50"> Tutor Adrian
                                </div>
                                <div onclick="switchModel('arun')" class="menu-item" id="model-btn-arun">
                                    <img src="https://api.dicebear.com/9.x/lorelei/svg?seed=Destiny" class="w-5 h-5 rounded-full bg-orange-50"> Arun
                                </div>
                            </div>
                        </div>
                        <button onclick="toggleNewtonExpand()" class="hidden md:flex icon-btn bg-[#f9fafb] hover:bg-[#eaecf0] border border-[#eaecf0]" title="Swap & Expand View">
                            <i id="expand-icon" data-lucide="maximize-2" class="w-5 h-5 text-[#667085]"></i>
                        </button>
                    </div>
                </div>
                <div class="flex-1 overflow-hidden relative bg-white flex flex-col">
                    <div id="ai-context-chip" class="hidden mx-6 mt-4 bg-[#eff4ff] border border-[#c2e7ff] rounded-2xl p-3 flex items-center justify-between animate-fade-in slide-in-right">
                        <div class="flex items-center gap-3 overflow-hidden">
                            <div class="w-8 h-8 rounded-full bg-white flex items-center justify-center shrink-0 border border-[#c2e7ff] shadow-sm"><i data-lucide="paperclip" class="w-4 h-4 text-[#0b57d0]"></i></div>
                            <div class="flex flex-col min-w-0"><span class="text-[10px] text-[#444746] font-bold uppercase tracking-wider">Active Context</span><span class="text-[13px] text-[#1f1f1f] truncate font-bold" id="ai-context-text">Post Data</span></div>
                        </div>
                        <button onclick="clearContext()" class="icon-btn w-8 h-8"><i data-lucide="x" class="w-4 h-4"></i></button>
                    </div>
                    <div class="flex-1 overflow-y-auto p-6" id="chat-history">
                        <div class="chat-wrapper flex flex-col w-full mb-6 fade-in">
                            <div class="flex items-center gap-2 mb-2"><img src="https://i.imghippo.com/files/XEEq5247S.png" class="w-6 h-6 object-contain"></div>
                            <div class="chat-msg-ai"><p>Hello! I'm Newton, your personal AI tutor. I'm here to help you learn, solve problems, and explore new ideas together. What are you working on today?</p></div>
                        </div>
                    </div>
                    
                    <div class="p-6 bg-white relative">
                         <div id="plus-menu" class="plus-menu">
                            <div class="menu-item" onclick="document.getElementById('media-input').click(); togglePlusMenu()">
                                <i data-lucide="image"></i> Upload Media
                            </div>
                            <div class="menu-item" onclick="insertCodeSnippetAI(); togglePlusMenu()">
                                <i data-lucide="code-2"></i> Code Snippet
                            </div>
                        </div>

                        <div id="search-container" class="gemini-input-wrapper relative z-20 flex flex-col group">
                            <textarea id="ai-input" rows="1" placeholder="Ask anything..." 
                                class="w-full bg-transparent text-[#1f1f1f] p-4 pl-6 pr-6 outline-none resize-none max-h-48 overflow-y-auto text-[16px] rounded-t-[28px] placeholder-[#98a2b3] border-none focus:ring-0" 
                                oninput="handleInput(this)" 
                                onkeydown="if(event.key === 'Enter' && !event.shiftKey) { event.preventDefault(); sendMessageAction(); }"></textarea>
                            
                            <div class="flex items-center justify-between px-3 pb-2 pt-0">
                                <div class="flex items-center gap-1">
                                    <button onclick="togglePlusMenu()" class="icon-btn w-9 h-9 hover:bg-[#e0e2e5]" title="Add Features"><i id="plus-icon" data-lucide="plus-circle" class="w-5 h-5 text-[#667085]"></i></button>
                                    <button id="web-search-btn" onclick="toggleWebSearch()" class="hidden md:flex icon-btn w-9 h-9 hover:bg-[#e0e2e5]" title="Search the Web"><i data-lucide="globe" class="w-5 h-5 text-[#667085]"></i></button>
                                    <button id="menu-idea-validator" onclick="toggleIdeaMode()" class="hidden md:flex icon-btn w-9 h-9 hover:bg-[#e0e2e5]" title="Idea Validator"><i data-lucide="lightbulb" class="w-5 h-5 text-[#667085]"></i></button>
                                </div>
                                <div class="flex items-center gap-2">
                                    <button id="ai-send-btn" onclick="sendMessageAction()" class="bg-[#1e1e1e] text-white w-10 h-10 rounded-full flex items-center justify-center hover:bg-[#333] hover:scale-105 transition-all shadow-sm">
                                        <i data-lucide="arrow-up" class="w-5 h-5"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <div class="text-center mt-3 flex items-center justify-center gap-2"><span class="text-[10px] font-medium text-[#98a2b3] opacity-60">Newton may display inaccurate info, so double-check its responses.</span></div>
                    </div>
                </div>
            </aside>
        </div>

        <!-- Bottom Nav for Mobile -->
        <nav id="mobile-bottom-nav" class="md:hidden fixed bottom-0 left-0 w-full bg-white border-t border-[#eaecf0] h-[64px] flex items-center justify-around z-50 pb-[env(safe-area-inset-bottom)] px-2 shadow-lg">
            <div class="mobile-nav-item active" onclick="switchView('feed')">
                <i data-lucide="home"></i>
                <span class="text-[10px] font-medium">Home</span>
            </div>
            <div class="mobile-nav-item" onclick="switchView('network')">
                <i data-lucide="users"></i>
                <span class="text-[10px] font-medium">Network</span>
            </div>
            <div class="mobile-nav-item" onclick="openCreateMenu()">
                <div class="w-10 h-10 bg-[#1f1f1f] rounded-full flex items-center justify-center text-white shadow-md mb-1">
                    <i data-lucide="plus" style="width:20px;height:20px"></i>
                </div>
            </div>
            <div class="mobile-nav-item" onclick="switchView('ai')">
                <i data-lucide="sparkles"></i>
                <span class="text-[10px] font-medium">Newton</span>
            </div>
            <div class="mobile-nav-item" onclick="showProfile(currentUser.id)">
                <img id="mobile-avatar" src="" class="w-6 h-6 rounded-full border border-gray-200">
                <span class="text-[10px] font-medium">Profile</span>
            </div>
        </nav>
    </div>

    <input type="file" id="media-input" class="hidden" accept="image/*,video/*" onchange="handleFileSelect(event)">

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
        import { 
            getAuth, 
            GoogleAuthProvider, 
            signInWithPopup, 
            onAuthStateChanged,
            createUserWithEmailAndPassword,
            signInWithEmailAndPassword,
            updateProfile,
            signOut
        } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";
        import { 
            getStorage, 
            ref, 
            uploadBytes, 
            getDownloadURL 
        } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-storage.js";

        // --- FIREBASE CONFIG ---
        const firebaseConfig = {
            apiKey: "AIzaSyAJH79UQl0rc96Qug0DKLevO4ZI_sn8Kno",
            authDomain: "edulinki.firebaseapp.com",
            projectId: "edulinki",
            storageBucket: "edulinki.firebasestorage.app",
            messagingSenderId: "248886466474",
            appId: "1:248886466474:web:160043201a6b28bafbbdd3",
            measurementId: "G-MQBH12VL7N"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const storage = getStorage(app);
        const provider = new GoogleAuthProvider();

        // --- AUTH UI ELEMENTS ---
        const googleBtn = document.getElementById('google-btn');
        const emailBtn = document.getElementById('email-auth-btn');
        const toggleLink = document.getElementById('toggle-link');
        const toggleText = document.getElementById('toggle-text');
        
        const titleEl = document.getElementById('auth-title');
        const subtitleEl = document.getElementById('auth-subtitle');
        const signupFields = document.getElementById('signup-fields');
        const emailInput = document.getElementById('email-input');
        const passInput = document.getElementById('password-input');
        const fileInput = document.getElementById('profile-pic-input');

        // Terms Overlay Elements
        const termsOverlay = document.getElementById('termsOverlay');
        const termsConfirm = document.getElementById('termsConfirm');
        const termsReject = document.getElementById('termsReject');

        // State
        let isSignUp = false;
        let pendingAction = null; 
        let pendingSignUpData = null; 

        // --- GLOBAL APP STATE ---
        const OFFICIAL_EMAIL = "edulinkbht@gmail.com";
        window.currentUser = {
            id: "user_guest",
            name: "Guest",
            email: "",
            avatar: "https://api.dicebear.com/9.x/notionists/svg?seed=Guest",
            bio: "Welcome to EduLink!",
            following: [],
            followers: [],
            friends: []
        };

        // --- AUTH LISTENER ---
        onAuthStateChanged(auth, (user) => {
            const authView = document.getElementById('auth-view');
            const appView = document.getElementById('app-view');

            if (user) {
                // User is signed in
                window.currentUser = {
                    id: user.uid,
                    name: user.displayName || user.email.split('@')[0],
                    email: user.email,
                    avatar: user.photoURL || `https://api.dicebear.com/9.x/initials/svg?seed=${user.displayName || 'User'}`,
                    bio: "New to EduLink!",
                    following: ["user_official"],
                    followers: [],
                    friends: []
                };
                
                // Add to global users array if not present (simple local mock update)
                const existing = users.find(u => u.id === user.uid);
                if (!existing) {
                    users.push(window.currentUser);
                } else {
                    // Update existing mock
                    existing.name = window.currentUser.name;
                    existing.avatar = window.currentUser.avatar;
                }

                showNotification("Welcome back, " + window.currentUser.name, "success", window.currentUser.avatar);
                
                authView.classList.add('hidden');
                appView.style.display = 'flex'; // Restore flex display
                
                initApp(); // Initialize Main App logic
                updateUserInterface(); // Update UI with user data
                
                // If requested, immediately show profile
                showProfile(window.currentUser.id);

            } else {
                // User is signed out
                authView.classList.remove('hidden');
                appView.style.display = 'none';
            }
        });

        // --- AUTH HANDLERS ---
        toggleLink.addEventListener('click', () => {
            isSignUp = !isSignUp;
            if (isSignUp) {
                titleEl.textContent = "Create Account";
                subtitleEl.textContent = "Join the community today.";
                signupFields.classList.remove('hidden');
                emailBtn.textContent = "Sign Up";
                toggleText.textContent = "Already have an account?";
                toggleLink.textContent = "Sign in";
            } else {
                titleEl.textContent = "Welcome Back";
                subtitleEl.textContent = "Access your workspace and AI tools.";
                signupFields.classList.add('hidden');
                emailBtn.textContent = "Sign In";
                toggleText.textContent = "Don't have an account?";
                toggleLink.textContent = "Sign up";
            }
        });

        emailBtn.addEventListener('click', async () => {
            const email = emailInput.value;
            const password = passInput.value;

            if (!email || !password) {
                showNotification("Please fill in email and password.", "error");
                return;
            }

            if (isSignUp) {
                if (password.length < 6) {
                    showNotification("Password must be at least 6 characters.", "error");
                    return;
                }
                pendingAction = 'signup';
                pendingSignUpData = { email, password, file: fileInput.files[0] };
                termsOverlay.classList.add('active');
            } else {
                emailBtn.textContent = "Signing In...";
                emailBtn.disabled = true;
                try {
                    await signInWithEmailAndPassword(auth, email, password);
                } catch (error) {
                    handleAuthError(error);
                    emailBtn.textContent = "Sign In";
                    emailBtn.disabled = false;
                }
            }
        });

        googleBtn.addEventListener('click', () => {
            pendingAction = 'google';
            termsOverlay.classList.add('active');
        });

        termsReject.addEventListener('click', () => {
            termsOverlay.classList.remove('active');
            if (pendingAction === 'signup') {
                document.getElementById('main-avatar-img').src = "https://api.dicebear.com/9.x/lorelei/svg?seed=Chase&backgroundColor=transparent&flip=true";
                fileInput.value = ""; 
            }
            pendingAction = null;
            pendingSignUpData = null;
        });

        termsConfirm.addEventListener('click', async () => {
            const originalText = termsConfirm.innerText;
            termsConfirm.innerText = "Processing...";
            termsConfirm.style.pointerEvents = "none";
            
            try {
                if (pendingAction === 'google') {
                    await signInWithPopup(auth, provider);
                } else if (pendingAction === 'signup') {
                    await performSignUp(pendingSignUpData);
                }
            } catch (error) {
                console.error(error);
                handleAuthError(error);
                termsConfirm.innerText = originalText;
                termsConfirm.style.pointerEvents = "auto";
                termsOverlay.classList.remove('active');
            }
        });

        async function performSignUp(data) {
            const userCredential = await createUserWithEmailAndPassword(auth, data.email, data.password);
            const user = userCredential.user;
            let photoURL = "https://api.dicebear.com/9.x/initials/svg?seed=" + user.uid;

            if (data.file) {
                try {
                    const storageRef = ref(storage, `profile_images/${user.uid}`);
                    await uploadBytes(storageRef, data.file);
                    photoURL = await getDownloadURL(storageRef);
                } catch (uploadError) {
                    console.error("Image upload failed", uploadError);
                }
            }

            await updateProfile(user, {
                displayName: data.email.split('@')[0], 
                photoURL: photoURL
            });
            
            // Reload page to refresh state cleanly or just let auth listener handle it
            // Auth listener will catch the state change
        }

        function handleAuthError(error) {
            let msg = error.message;
            if(msg.includes("auth/email-already-in-use")) msg = "Email already in use.";
            if(msg.includes("auth/weak-password")) msg = "Password should be at least 6 characters.";
            if(msg.includes("auth/invalid-credential")) msg = "Invalid email or password.";
            showNotification(msg, "error");
        }

        // --- NOTIFICATION SYSTEM ---
        function showNotification(message, type = "info", avatarUrl = null) {
            const container = document.getElementById('notification-container');
            const alertBox = document.createElement('div');
            alertBox.className = `custom-alert ${type}`;
            let finalAvatar = avatarUrl;
            if (!finalAvatar) {
                if (type === 'error') finalAvatar = "https://api.dicebear.com/9.x/shapes/svg?seed=Error";
                else if (type === 'success') finalAvatar = "https://api.dicebear.com/9.x/shapes/svg?seed=Success";
                else finalAvatar = "https://api.dicebear.com/9.x/micah/svg?seed=Maso";
            }
            alertBox.innerHTML = `<img src="${finalAvatar}" class="alert-avatar"><div class="alert-content"><div class="alert-title">${type === 'error' ? 'Something went wrong' : 'Notification'}</div><div class="alert-msg">${message}</div></div>`;
            container.appendChild(alertBox);
            setTimeout(() => {
                alertBox.style.animation = "fadeOutRight 0.4s forwards";
                setTimeout(() => alertBox.remove(), 400);
            }, 5000);
        }

        // --- LANDING PAGE VISUALS ---
        const observerOptions = { threshold: 0.15 };
        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => { if (entry.isIntersecting) entry.target.classList.add('visible'); });
        }, observerOptions);
        document.querySelectorAll('.reveal-on-scroll').forEach(el => observer.observe(el));

        // Welcome Overlay
        const welcomeOverlay = document.getElementById('welcomeOverlay');
        const closeWelcomeBtn = document.getElementById('closeOverlayBtn');
        if (!localStorage.getItem('eduLinkWelcomeSeen')) {
            setTimeout(() => welcomeOverlay.classList.add('active'), 500);
        }
        closeWelcomeBtn.addEventListener('click', () => {
            welcomeOverlay.style.opacity = '0';
            setTimeout(() => { welcomeOverlay.classList.remove('active'); welcomeOverlay.style.display = 'none'; }, 400); 
            localStorage.setItem('eduLinkWelcomeSeen', 'true');
        });

        // --- MAIN APP EXPORTS FOR GLOBAL SCOPE ---
        // Expose functions needed by HTML attributes (onclick)
        window.handleLogout = async () => {
            try {
                await signOut(auth);
                showNotification("Logged out successfully", "success");
            } catch (error) {
                showNotification("Error logging out", "error");
            }
        };

        // --- MOCK DATA & APP LOGIC ---
        // (Moved users, posts, notifications definitions inside module to avoid duplication, or keep global if needed)
        // Since original logic relies on global vars, we'll attach to window for now or rely on the script block below.
        
        // RE-INITIALIZE DATA FOR APP LOGIC
        window.users = [
            window.currentUser,
            { id: "user_official", name: "EduLink Official", email: "edulinkbht@gmail.com", avatar: "https://i.imghippo.com/files/fRGt5603uII.png", bio: "Official Account.", isOfficial: true, following: [], followers: ["user_guest"], friends: [] },
            { id: "user_2", name: "Alex Chen", email: "alex@example.com", avatar: "https://api.dicebear.com/9.x/notionists/svg?seed=Alex", bio: "Software Engineer.", following: ["user_guest"], followers: ["user_guest"], friends: ["user_guest"] }
        ];

        window.posts = [
            { id: "post_1", authorId: "user_official", content: "Welcome to EduLink Pro! 🚀 #EduLink", media: null, timestamp: Date.now(), likes: ["user_2"], comments: [], privacy: "public" },
            { id: "post_2", authorId: "user_2", content: "Just refactored my entire backend. 💻", media: null, timestamp: Date.now() - 5000000, likes: [], comments: [], privacy: "public" }
        ];

        window.savedPosts = [];
        window.notifications = [];
        window.chats = { "user_2": [{ senderId: "user_2", text: "Welcome to the platform!", timestamp: Date.now() }] };
        
        // --- Expose Global Functions for HTML Handlers ---
        window.switchView = function(viewName) {
            const views = ['feed', 'events', 'saved', 'profile', 'chat', 'search-results', 'notifications'];
            views.forEach(v => { const el = document.getElementById(`view-${v}`); if(el) el.classList.add('hidden'); });
            
            // Mobile Logic
            const aiPanel = document.getElementById('ai-panel');
            const mainPanel = document.getElementById('main-panel');
            
            if (window.innerWidth < 768) {
                if (viewName === 'ai') { mainPanel.classList.add('hidden'); aiPanel.classList.remove('hidden'); aiPanel.classList.add('flex'); } 
                else { mainPanel.classList.remove('hidden'); aiPanel.classList.add('hidden'); aiPanel.classList.remove('flex'); }
            }
            if(viewName !== 'ai' && viewName !== 'network') document.getElementById(`view-${viewName}`).classList.remove('hidden');
            
            document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
            document.querySelectorAll('.mobile-nav-item').forEach(el => el.classList.remove('active'));

            if(viewName === 'feed') document.getElementById('nav-feed').classList.add('active');
            else if(viewName === 'chat') document.getElementById('nav-chat').classList.add('active');
            else if(viewName === 'saved') { document.getElementById('nav-saved').classList.add('active'); renderSaved(); }
            
            if(viewName === 'feed') renderFeed();
            lucide.createIcons();
        };

        window.createPostElement = function(post) {
            const author = window.users.find(u => u.id === post.authorId) || window.users[0];
            const isLiked = post.likes.includes(window.currentUser.id);
            const isSaved = window.savedPosts.includes(post.id);
            const dateStr = new Date(post.timestamp).toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});

            const div = document.createElement('article');
            div.className = "post-card group overflow-hidden fade-in";
            div.onclick = () => openPostView(post.id);
            
            let mediaHTML = "";
            if (post.media) {
                const isVideo = post.media.startsWith('data:video');
                mediaHTML = isVideo 
                ? `<div class="mt-3 rounded-xl overflow-hidden"><video src="${post.media}" class="w-full max-h-[400px]" controls onclick="event.stopPropagation()"></video></div>`
                : `<div class="mt-3 rounded-xl overflow-hidden cursor-pointer" onclick="event.stopPropagation(); openLightbox('${post.media}')"><img src="${post.media}" class="w-full max-h-[400px] object-cover bg-gray-50"></div>`;
            }

            let tagsHTML = marked.parse(post.content.replace(/#(\w+)/g, '<span class="hashtag">#$1</span>'));
            let privacyIcon = post.privacy === 'private' ? '<i data-lucide="lock" class="w-3 h-3 ml-1 text-gray-400"></i>' : '<i data-lucide="globe" class="w-3 h-3 ml-1 text-gray-400"></i>';
            let officialBadge = author.isOfficial ? `<i data-lucide="badge-check" class="w-4 h-4 text-blue-600 fill-blue-100"></i>` : '';

            div.innerHTML = `
                <div class="p-4 md:p-5">
                    <div class="post-header">
                        <div class="flex gap-3">
                            <div class="post-avatar-container"><img src="${author.avatar}" class="post-avatar"></div>
                            <div>
                                <div class="flex items-center gap-1"><span class="post-author-name" onclick="event.stopPropagation(); showProfile('${author.id}')">${author.name}</span>${officialBadge}</div>
                                <div class="post-meta flex items-center">${dateStr} • ${privacyIcon}</div>
                            </div>
                        </div>
                        <button class="icon-btn w-8 h-8 -mr-2" onclick="showPostOptions(event, '${post.id}', '${author.name}')"><i data-lucide="more-horizontal" class="w-5 h-5"></i></button>
                    </div>
                    <div class="post-content"><div class="post-body" data-raw-text="${post.content.replace(/"/g, '&quot;')}">${tagsHTML}</div>${mediaHTML}</div>
                    <div class="post-actions">
                        <div class="flex items-center gap-1">
                             <button class="action-btn like" onclick="event.stopPropagation(); toggleLike('${post.id}')">
                                <i data-lucide="heart" class="w-5 h-5 ${isLiked ? 'fill-red-500 text-red-500' : ''}"></i> 
                                <span class="text-xs font-medium">${post.likes.length || ''}</span>
                             </button>
                             <button class="action-btn comment" onclick="event.stopPropagation(); openPostView('${post.id}')"><i data-lucide="message-square" class="w-5 h-5"></i> <span class="text-xs font-medium">${post.comments.length || ''}</span></button>
                        </div>
                         <div class="flex items-center gap-1">
                             <button class="action-btn bookmark" onclick="event.stopPropagation(); toggleSave('${post.id}')"><i data-lucide="bookmark" class="w-5 h-5 ${isSaved ? 'fill-current text-purple-600' : ''}"></i></button>
                             <button class="action-btn ai-pin" onclick="event.stopPropagation(); pinPost('${post.id}', '${author.name}')" title="Analyze with Newton"><i data-lucide="sparkles" class="w-5 h-5"></i></button>
                         </div>
                    </div>
                </div>
            `;
            return div;
        };

        window.renderFeed = function(filterTerm = "") {
            const container = document.getElementById('feed-container');
            if(!container) return;
            container.innerHTML = "";
            let displayPosts = window.posts.filter(p => {
                if (p.authorId === window.currentUser.id) return true;
                if (p.privacy === 'private') return false;
                return true;
            }).sort((a,b) => b.timestamp - a.timestamp);
            displayPosts.forEach(post => container.appendChild(window.createPostElement(post)));
            lucide.createIcons();
        };

        window.toggleLike = function(postId) {
            const post = window.posts.find(p => p.id === postId);
            if(post.likes.includes(window.currentUser.id)) {
                post.likes = post.likes.filter(id => id !== window.currentUser.id);
            } else {
                post.likes.push(window.currentUser.id);
            }
            window.renderFeed(); 
        };

        window.initApp = function() {
            // Re-bind other global functions needed for the app if they were overwritten
            // This is a simplified merge; normally better to use modules for everything.
            window.renderFeed();
            // ... re-run other inits
            lucide.createIcons();
        };

        window.updateUserInterface = function() {
            if (!window.currentUser) return;
            const els = {
                'sidebar-name': 'innerText',
                'compose-name': 'innerText',
                'edit-name': 'value',
                'edit-bio': 'value'
            };
            for (const [id, prop] of Object.entries(els)) {
                const el = document.getElementById(id);
                if (el) el[prop] = window.currentUser[id.includes('name') ? 'name' : 'bio'];
            }
            const imgs = ['sidebar-avatar', 'mobile-avatar', 'header-avatar', 'compose-avatar', 'comment-input-avatar', 'edit-avatar-preview'];
            imgs.forEach(id => {
                const el = document.getElementById(id);
                if (el) el.src = window.currentUser.avatar;
            });
        };

    </script>
</body>
</html>
