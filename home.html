<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>EduLink</title>
<link rel="icon" type="image/png" href="https://i.imghippo.com/files/vgr8207c.png">
<!-- Dependencies -->
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://unpkg.com/lucide@latest"></script>
<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
<script src="https://unpkg.com/ml5@latest/dist/ml5.min.js"></script>
<script src='https://unpkg.com/tesseract.js@v2.1.0/dist/tesseract.min.js'></script>
<style>
@import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Google+Sans:wght@400;500;700&display=swap');

:root {
--surface: #ffffff;
--background: #fafafa; /* Instagram light grey for desktop bg */
--on-surface: #262626; /* Instagram almost black */
--text-secondary: #8e8e8e;
--outline: #dbdbdb;
--hover-bg: #fafafa;
--primary: #0095f6; /* Instagram Blue */
}

body {
font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
background-color: var(--background);
color: var(--on-surface);
overflow: hidden;
}

h1, h2, h3, .google-font { font-family: 'Google Sans', -apple-system, sans-serif; }

/* No Scrollbars */
* { scrollbar-width: none; -ms-overflow-style: none; }
*::-webkit-scrollbar { width: 0px; background: transparent; display: none; }

/* Prevent icon squishing globally */
i[data-lucide], svg { flex-shrink: 0; stroke-width: 1.75px; }

.fade-in { animation: fadeUp 0.3s ease-out forwards; opacity: 0; transform: translateY(5px); }
@keyframes fadeUp { to { opacity: 1; transform: translateY(0); } }

/* --- UNIFIED PANEL STYLES --- */
.app-panel {
background: var(--surface);
border-right: 1px solid var(--outline);
height: 100%;
display: flex;
flex-direction: column;
overflow: hidden;
}

/* Mobile Adjustments */
@media (max-width: 768px) {
.app-panel {
border: none !important;
}
body {
background-color: #fff;
padding: 0 !important;
}
#workspace-layout {
gap: 0 !important;
}
}

/* --- SIDEBAR --- */
#main-sidebar {
width: 72px; /* Slimmer sidebar like Insta web */
flex-shrink: 0;
padding: 24px 12px;
transition: width 0.3s cubic-bezier(0.2, 0, 0, 1), padding 0.3s ease;
z-index: 50;
}

@media (min-width: 1280px) {
#main-sidebar {
width: 245px;
padding: 32px 24px;
border-right: 1px solid var(--outline);
}
}

.nav-item {
display: flex; align-items: center; gap: 16px;
padding: 12px;
color: #000;
font-weight: 400;
font-size: 16px;
border-radius: 8px;
transition: all 0.1s ease;
cursor: pointer;
text-decoration: none;
margin-bottom: 4px;
justify-content: center;
position: relative;
}

.nav-item:hover {
background-color: #fafafa;
}

.nav-item svg {
    transition: transform 0.2s;
}

.nav-item:hover svg {
    transform: scale(1.05);
}

/* Updated Active State: Bold and Filled-ish look */
.nav-item.active {
color: #000000;
font-weight: 700;
}

.nav-item.active svg {
    stroke-width: 2.5px;
}

/* Notification Dot Logic */
.nav-dot {
position: absolute;
top: 10px;
right: 18px; 
width: 8px;
height: 8px;
background-color: #ff3040;
border-radius: 50%;
border: 1px solid var(--surface);
display: none;
z-index: 10;
}

@media (min-width: 1280px) {
.nav-item {
justify-content: flex-start;
padding: 12px;
margin-bottom: 8px;
}
.nav-dot {
top: 14px;
left: 26px; /* Position near the icon on desktop */
right: auto;
}
}

.create-btn {
display: flex;
align-items: center;
justify-content: flex-start;
gap: 12px;
background: transparent;
color: #000;
padding: 12px;
border-radius: 8px;
font-weight: 400;
font-size: 16px;
transition: all 0.2s ease;
width: 100%;
margin-bottom: 8px;
box-shadow: none;
line-height: 1;
border: 1px solid transparent;
}

.create-btn:hover {
background: #fafafa;
transform: none;
box-shadow: none;
}

/* --- POST CARD DESIGN (Insta Style) --- */
.post-card {
background: var(--surface);
border-bottom: 1px solid var(--outline);
border-radius: 0;
margin-bottom: 0;
box-shadow: none;
overflow: visible;
padding-bottom: 16px;
}

@media (min-width: 768px) {
.post-card {
    border: 1px solid var(--outline);
    border-radius: 8px;
    margin-bottom: 24px;
    padding-bottom: 0;
}
}

.post-header {
display: flex; justify-content: space-between; align-items: center;
padding: 14px;
}

.post-avatar-container {
position: relative;
padding: 2px;
border-radius: 50%;
}
/* Story ring simulation if needed later */
/* .post-avatar-container.has-story { background: linear-gradient(45deg, #f09433, #e6683c, #dc2743, #cc2366, #bc1888); } */

.post-avatar {
width: 32px; height: 32px;
border-radius: 50%;
background-color: var(--hover-bg);
border: 1px solid rgba(0,0,0,0.1);
object-fit: cover;
display: block;
}

.post-author-name {
font-weight: 600; font-size: 14px; color: #262626;
line-height: 1.2;
margin-left: 10px;
cursor: pointer;
}
.post-author-name:hover { opacity: 0.7; text-decoration: none; color: inherit; }

.post-actions {
display: flex; align-items: center; justify-content: space-between;
padding: 12px 14px 0 14px;
}

.action-btn {
display: flex; align-items: center; justify-content: center;
padding: 8px;
color: #000;
transition: transform 0.1s;
background: transparent; border: none; cursor: pointer;
margin-right: 2px;
}
.action-btn:active { transform: scale(0.9); }
.action-btn:hover { background: transparent; opacity: 0.6; }
.action-btn.like svg.filled { fill: #ed4956; stroke: #ed4956; }
.action-btn.bookmark { margin-left: auto; margin-right: 0; }

.post-content-visual {
    width: 100%;
    background: #000;
    display: flex;
    align-items: center;
    justify-content: center;
    overflow: hidden;
    /* Aspect ratio handling */
    min-height: 300px;
    max-height: 600px;
}
.post-content-visual img, .post-content-visual video {
    width: 100%;
    height: 100%;
    object-fit: cover;
    max-height: 600px;
}

.post-caption-area {
    padding: 0 14px 8px 14px;
    font-size: 14px;
    color: #262626;
    margin-top: 8px;
}
.username-caption {
    font-weight: 600;
    margin-right: 6px;
}

.post-time {
    font-size: 10px;
    color: #8e8e8e;
    text-transform: uppercase;
    padding: 0 14px 10px 14px;
    letter-spacing: 0.2px;
}

/* --- REELS VIEW (New) --- */
#reel-view-overlay {
    background-color: #000;
    z-index: 100;
}
.reel-video-container {
    height: 100%;
    width: 100%;
    max-width: 450px;
    position: relative;
    margin: 0 auto;
    display: flex;
    align-items: center;
    justify-content: center;
}
.reel-video {
    width: 100%;
    height: 100%;
    object-fit: cover; /* Fill screen like reels */
}
.reel-overlay-content {
    position: absolute;
    bottom: 0;
    left: 0;
    width: 100%;
    padding: 20px;
    background: linear-gradient(to top, rgba(0,0,0,0.8), transparent);
    color: white;
    z-index: 20;
}
.reel-side-actions {
    position: absolute;
    bottom: 80px;
    right: 10px;
    display: flex;
    flex-direction: column;
    gap: 20px;
    z-index: 25;
}
.reel-action-btn {
    display: flex;
    flex-direction: column;
    align-items: center;
    color: white;
    gap: 4px;
    font-size: 12px;
    font-weight: 500;
}
.reel-action-btn svg { stroke-width: 2px; filter: drop-shadow(0 2px 4px rgba(0,0,0,0.3)); }

/* --- COMPOSE & MODALS --- */
#compose-modal, #create-menu-modal {
border-radius: 12px;
border: none;
box-shadow: 0 4px 12px rgba(0,0,0,0.15);
}

.compose-header {
border-bottom: 1px solid var(--outline);
padding: 12px 16px;
display: flex; justify-content: space-between; align-items: center;
}
.compose-title { font-weight: 600; font-size: 16px; text-align: center; flex: 1; }

.compose-textarea {
    font-family: -apple-system, BlinkMacSystemFont, sans-serif;
    padding: 16px;
}

/* --- BOTTOM NAV (Mobile) --- */
#mobile-bottom-nav {
    border-top: 1px solid var(--outline);
    height: 54px;
    padding-bottom: env(safe-area-inset-bottom);
}
.mobile-nav-item {
    color: #000;
    opacity: 0.7;
}
.mobile-nav-item.active {
    color: #000;
    opacity: 1;
}
.mobile-nav-item.active svg {
    stroke-width: 2.5px;
}

/* Create Button Mobile - Squircle */
.mobile-create-btn {
    background: #000;
    color: white;
    border-radius: 14px; /* Squircleish */
    width: 36px;
    height: 36px;
    display: flex;
    align-items: center;
    justify-content: center;
}

/* General Layout */
#main-panel {
    border: none;
    background: var(--background);
}
#view-feed {
    padding-top: 60px; /* Header height */
    max-width: 630px; /* Insta feed width constraint */
    margin: 0 auto;
}
@media (max-width: 768px) {
    #view-feed { padding-top: 60px; max-width: 100%; }
}

/* Header */
#main-header {
    background: #fff;
    border-bottom: 1px solid var(--outline);
    height: 60px;
}

/* Logo */
.logo-text {
    font-family: 'Google Sans', sans-serif; /* Instagram uses a cursive font, Google Sans is fine */
    font-weight: 700;
    font-size: 24px;
    letter-spacing: -0.5px;
}

/* Grid for Explore/Profile */
.grid-post-container { gap: 3px; }
.grid-post-item { aspect-ratio: 1/1; background: #efefef; }

</style>
</head>
<body class="h-screen flex overflow-hidden bg-[#fafafa]" onclick="hidePostMenu()">
<!-- LOADING OVERLAY -->
<div id="app-loader" class="fixed inset-0 z-[9999] bg-white flex justify-center items-center transition-opacity duration-500">
    <img src="https://i.imghippo.com/files/vgr8207c.png" class="w-16 h-16 animate-pulse">
</div>

<!-- REEL VIEW OVERLAY (Reels Player) -->
<div id="reel-view-overlay" class="fixed inset-0 z-[100] hidden flex flex-col scale-in">
    <button class="absolute top-4 right-4 z-50 text-white p-2 drop-shadow-md" onclick="closeReelView()">
        <i data-lucide="x" class="w-8 h-8"></i>
    </button>
    <div class="reel-video-container">
        <video id="reel-player" class="reel-video" loop playsinline onclick="toggleReelPlay()"></video>
        <div id="reel-play-icon" class="absolute pointer-events-none opacity-0 transition-opacity duration-200">
            <i data-lucide="play" class="w-20 h-20 fill-white/80 text-transparent"></i>
        </div>
        
        <!-- Right Side Actions -->
        <div class="reel-side-actions">
            <div class="reel-action-btn">
                <i data-lucide="heart" class="w-7 h-7"></i>
                <span id="reel-likes">0</span>
            </div>
            <div class="reel-action-btn">
                <i data-lucide="message-circle" class="w-7 h-7"></i>
                <span id="reel-comments">0</span>
            </div>
            <div class="reel-action-btn">
                <i data-lucide="send" class="w-7 h-7"></i>
            </div>
            <div class="reel-action-btn">
                <i data-lucide="more-horizontal" class="w-7 h-7"></i>
            </div>
        </div>

        <!-- Bottom Info -->
        <div class="reel-overlay-content">
            <div class="flex items-center gap-3 mb-3 cursor-pointer" id="reel-user-profile">
                <img id="reel-avatar" src="" class="w-8 h-8 rounded-full border border-white/50">
                <span id="reel-username" class="font-bold text-sm drop-shadow-md"></span>
                <button class="border border-white/50 text-white text-[10px] px-2 py-1 rounded-[4px] font-semibold bg-transparent backdrop-blur-sm">Follow</button>
            </div>
            <p id="reel-caption" class="text-sm text-white/90 line-clamp-2 drop-shadow-md mb-2"></p>
            <div class="flex items-center gap-2 text-xs text-white/80">
                <i data-lucide="music" class="w-3 h-3"></i>
                <span class="scrolling-text w-40 truncate">Original Audio</span>
            </div>
        </div>
        
        <!-- Progress Bar -->
        <div class="absolute bottom-0 left-0 w-full h-[2px] bg-white/20">
            <div id="reel-progress" class="h-full bg-white w-0 transition-all duration-100 ease-linear"></div>
        </div>
    </div>
</div>

<!-- Custom Alert -->
<div id="custom-alert" class="fixed inset-0 z-[80] flex items-center justify-center bg-black/40 backdrop-blur-sm hidden opacity-0 transition-opacity duration-200">
<div class="bg-white rounded-[12px] p-6 shadow-xl max-w-xs w-[85%] transform scale-95 transition-transform duration-200 text-center" id="custom-alert-box">
<h3 class="text-lg font-bold text-black mb-2" id="alert-title">Confirm</h3>
<p class="text-gray-500 mb-6 text-sm" id="alert-msg">Are you sure?</p>
<div class="flex border-t border-gray-100 pt-4 -mb-2">
<button class="flex-1 py-2 text-gray-500 font-semibold text-sm" onclick="closeAlert(false)">Cancel</button>
<div class="w-[1px] bg-gray-100"></div>
<button class="flex-1 py-2 text-red-500 font-bold text-sm" id="alert-confirm-btn">Confirm</button>
</div>
</div>
</div>

<!-- Post Options Menu -->
<div id="global-post-menu" class="post-options-menu"></div>

<!-- Mobile Headers -->
<div id="mobile-notifications-header" class="md:hidden fixed top-0 left-0 w-full bg-white z-30 flex-col hidden border-b border-outline pb-0">
   <div class="h-12 flex items-center justify-center relative shrink-0">
      <span class="font-bold text-base text-black">Notifications</span>
      <button onclick="switchView('feed')" class="absolute left-4 icon-btn"><i data-lucide="arrow-left" class="w-6 h-6 text-black"></i></button>
   </div>
   <div class="tab-group mb-0 mx-0 w-full border-t border-outline">
        <button onclick="switchNotifTab('friends')" id="ntab-friends-mobile" class="tab-btn active">Following</button>
        <button onclick="switchNotifTab('others')" id="ntab-others-mobile" class="tab-btn">Others</button>
        <button onclick="switchNotifTab('official')" id="ntab-official-mobile" class="tab-btn">Official</button>
    </div>
</div>

<div id="mobile-explore-header" class="md:hidden fixed top-0 left-0 w-full bg-white z-30 flex items-center gap-3 px-3 h-14 border-b border-outline hidden">
    <div class="relative flex-1 bg-gray-100 rounded-lg group focus-within:bg-white focus-within:ring-1 focus-within:ring-gray-300">
         <i data-lucide="search" class="absolute left-3 top-2.5 w-4 h-4 text-gray-400"></i>
         <input type="text" id="mobile-explore-search" class="w-full bg-transparent border-none py-2 pl-9 pr-4 text-sm outline-none" placeholder="Search" oninput="handleSearch(this.value)">
    </div>
</div>

<!-- Post View Overlay -->
<div id="post-view-overlay" class="fixed inset-0 z-[60] hidden flex justify-center items-center">
<div class="absolute inset-0 bg-black/60 backdrop-blur-sm transition-opacity" onclick="closePostView()"></div>
<div class="bg-white w-full h-full md:w-[1100px] md:h-[85vh] md:rounded-r-[4px] md:rounded-l-[4px] relative flex flex-col md:flex-row overflow-hidden shadow-2xl animate-fade-in">
    <!-- Media Side -->
    <div class="w-full md:w-[60%] bg-black flex items-center justify-center relative h-[40vh] md:h-full">
        <div id="injected-post-media" class="w-full h-full flex items-center justify-center"></div>
        <button onclick="closePostView()" class="absolute top-4 left-4 text-white md:hidden bg-black/20 rounded-full p-1"><i data-lucide="chevron-down" class="w-6 h-6"></i></button>
    </div>
    <!-- Comments Side -->
    <div class="w-full md:w-[40%] flex flex-col h-[60vh] md:h-full bg-white relative">
        <div class="h-16 border-b border-outline flex items-center justify-between px-4 shrink-0 bg-white">
            <div class="flex items-center gap-3" id="post-view-header">
                <!-- User info injected here -->
            </div>
            <button class="icon-btn" onclick="showPostOptions(event, window.currentViewingPostId, window.currentViewingAuthorId)"><i data-lucide="more-horizontal" class="w-5 h-5 text-black"></i></button>
        </div>
        
        <div id="comments-list-desktop" class="flex-1 overflow-y-auto p-4 bg-white"></div>
        
        <!-- Post Actions in Modal -->
        <div class="p-3 border-t border-outline">
             <div class="flex justify-between mb-2">
                <div class="flex gap-4">
                    <button id="modal-like-btn" onclick="toggleLike(window.currentViewingPostId)"><i data-lucide="heart" class="w-6 h-6"></i></button>
                    <button><i data-lucide="message-circle" class="w-6 h-6 -rotate-90"></i></button>
                    <button><i data-lucide="send" class="w-6 h-6"></i></button>
                </div>
                <button onclick="toggleSave(window.currentViewingPostId)"><i data-lucide="bookmark" class="w-6 h-6"></i></button>
             </div>
             <div class="font-semibold text-sm mb-1"><span id="modal-like-count">0</span> likes</div>
             <div class="text-[10px] text-gray-400 uppercase" id="modal-date">Now</div>
        </div>

        <div class="p-3 border-t border-outline flex items-center gap-2">
            <i data-lucide="smile" class="w-6 h-6 text-black"></i>
            <textarea id="comment-input-desktop" placeholder="Add a comment..." class="flex-1 bg-transparent outline-none text-sm resize-none h-[18px] py-0" oninput="this.style.height='auto';this.style.height=this.scrollHeight+'px'"></textarea>
            <button onclick="submitCommentDesktop()" class="text-blue-500 font-semibold text-sm disabled:opacity-50">Post</button>
        </div>
    </div>
</div>
</div>

<div id="toast" class="toast">
<i id="toast-icon" data-lucide="check" class="w-5 h-5 text-white"></i><span id="toast-msg">Action Completed</span>
</div>

<!-- SETTINGS MODAL -->
<div id="settings-overlay" class="fixed inset-0 z-[70] flex items-center justify-center bg-black/40 hidden" onclick="closeSettings()">
<div class="bg-white w-[400px] rounded-[12px] shadow-2xl overflow-hidden flex flex-col animate-fade-in" onclick="event.stopPropagation()">
    <div class="py-3 border-b border-gray-200 text-center font-bold">Settings</div>
    <button class="py-3 border-b border-gray-200 w-full hover:bg-gray-50 text-sm" onclick="togglePrivacy()">Toggle Private Account</button>
    <a href="pre.html" class="block py-3 border-b border-gray-200 w-full hover:bg-gray-50 text-center text-sm">Premium</a>
    <a href="p.html" class="block py-3 border-b border-gray-200 w-full hover:bg-gray-50 text-center text-sm">Privacy Policy</a>
    <button class="py-3 w-full hover:bg-gray-50 text-red-500 font-bold text-sm" onclick="doLogout()">Log Out</button>
    <button class="py-3 w-full hover:bg-gray-50 text-sm border-t border-gray-100" onclick="closeSettings()">Cancel</button>
</div>
</div>

<!-- CREATE MODAL -->
<div id="create-menu-overlay" class="fixed inset-0 z-50 flex items-center justify-center bg-black/60 hidden" onclick="closeCreateMenu()">
    <div class="bg-white rounded-[12px] overflow-hidden w-[380px] animate-fade-in" onclick="event.stopPropagation()">
        <div class="py-3 text-center font-bold border-b border-gray-200">Create new</div>
        <div class="flex flex-col">
            <button onclick="openCompose()" class="p-4 flex items-center gap-3 hover:bg-gray-50 border-b border-gray-100">
                <i data-lucide="image" class="w-6 h-6"></i>
                <div class="text-left">
                    <div class="font-semibold text-sm">Post</div>
                    <div class="text-xs text-gray-500">Share photos or videos</div>
                </div>
            </button>
            <button onclick="openEventComposer()" class="p-4 flex items-center gap-3 hover:bg-gray-50 border-b border-gray-100">
                <i data-lucide="calendar" class="w-6 h-6"></i>
                <div class="text-left">
                    <div class="font-semibold text-sm">Event</div>
                    <div class="text-xs text-gray-500">Plan a meetup</div>
                </div>
            </button>
             <button onclick="openMentorship()" class="p-4 flex items-center gap-3 hover:bg-gray-50">
                <i data-lucide="graduation-cap" class="w-6 h-6"></i>
                <div class="text-left">
                    <div class="font-semibold text-sm">Mentorship</div>
                    <div class="text-xs text-gray-500">Find a mentor</div>
                </div>
            </button>
        </div>
    </div>
</div>

<!-- COMPOSE OVERLAY -->
<div id="compose-overlay" class="fixed inset-0 z-[55] flex items-center justify-center bg-black/60 hidden" onclick="closeCompose()">
<div id="compose-modal" class="bg-white w-[95%] max-w-[500px] h-[500px] md:h-auto rounded-[12px] flex flex-col animate-fade-in" onclick="event.stopPropagation()">
<div class="compose-header">
    <button onclick="closeCompose()" class="text-black"><i data-lucide="arrow-left" class="w-6 h-6"></i></button>
    <span class="compose-title">New Post</span>
    <button id="btn-publish" onclick="publishPost()" class="text-blue-500 font-bold text-sm disabled:opacity-50">Share</button>
</div>
<div class="flex-1 flex flex-col md:flex-row overflow-hidden">
    <div id="media-drop-zone" class="flex-1 bg-gray-50 flex flex-col items-center justify-center border-b md:border-r border-gray-100 relative min-h-[250px]">
        <div id="media-preview-container" class="hidden w-full h-full absolute inset-0 bg-black flex items-center justify-center">
             <img id="media-preview-img" class="max-w-full max-h-full object-contain hidden">
             <video id="media-preview-video" class="max-w-full max-h-full object-contain hidden" controls></video>
             <button onclick="removeMedia()" class="absolute top-2 right-2 bg-black/50 text-white rounded-full p-1"><i data-lucide="x" class="w-4 h-4"></i></button>
        </div>
        <div class="text-center p-6" id="upload-placeholder">
            <i data-lucide="image" class="w-16 h-16 mx-auto text-black mb-4"></i>
            <p class="text-lg font-light mb-4">Drag photos or videos here</p>
            <button onclick="document.getElementById('media-input').click()" class="bg-blue-500 text-white px-4 py-1.5 rounded-[4px] font-bold text-sm">Select from computer</button>
        </div>
    </div>
    <div class="w-full md:w-[300px] flex flex-col bg-white">
        <div class="flex items-center gap-3 p-4">
            <img id="compose-avatar" src="" class="w-7 h-7 rounded-full">
            <span id="compose-name" class="font-bold text-sm"></span>
        </div>
        <textarea id="compose-text" placeholder="Write a caption..." class="w-full p-4 h-32 resize-none outline-none text-sm"></textarea>
        <div class="border-t border-gray-100 p-3">
             <div class="flex justify-between items-center text-sm text-gray-500 cursor-pointer" onclick="toggleComposeSettings()">
                <span>Advanced settings</span>
                <i data-lucide="chevron-down" class="w-4 h-4"></i>
             </div>
             <div id="compose-settings-area" class="hidden mt-3 space-y-3">
                <label class="flex items-center justify-between text-sm"><span>Hide like counts</span><input type="checkbox" id="post-setting-likes" class="accent-black"></label>
                <label class="flex items-center justify-between text-sm"><span>Turn off commenting</span><input type="checkbox" id="post-setting-comments" class="accent-black"></label>
             </div>
        </div>
    </div>
</div>
</div>
</div>

<!-- MAIN SIDEBAR (Desktop) -->
<aside id="main-sidebar" class="hidden md:flex app-panel fixed h-full bg-white border-r border-gray-200">
<div class="h-16 flex items-center justify-center xl:justify-start px-2 mb-6 cursor-pointer" onclick="switchView('feed')">
    <h1 class="logo-text hidden xl:block">EduLink</h1>
    <img src="https://i.imghippo.com/files/fRGt5603uII.png" class="w-8 h-8 xl:hidden">
</div>

<nav class="flex-1 space-y-2">
<a href="#" onclick="switchView('feed'); return false;" id="nav-feed" class="nav-item active">
    <i data-lucide="home" class="w-6 h-6"></i> <span class="hidden xl:block">Home</span>
</a>
<a href="#" onclick="switchView('explore'); return false;" id="nav-explore" class="nav-item">
    <i data-lucide="search" class="w-6 h-6"></i> <span class="hidden xl:block">Search</span>
</a>
<a href="#" onclick="switchView('explore'); return false;" class="nav-item">
    <i data-lucide="compass" class="w-6 h-6"></i> <span class="hidden xl:block">Explore</span>
</a>
<a href="#" onclick="switchView('notifications'); return false;" id="nav-notifications" class="nav-item relative">
    <i data-lucide="heart" class="w-6 h-6"></i> <span class="hidden xl:block">Notifications</span>
    <span id="notif-badge" class="nav-dot"></span>
</a>
<a href="#" onclick="openCreateMenu(); return false;" class="nav-item">
    <i data-lucide="plus-square" class="w-6 h-6"></i> <span class="hidden xl:block">Create</span>
</a>
<a href="#" onclick="showProfile(auth.currentUser ? auth.currentUser.uid : null); return false;" id="nav-profile" class="nav-item">
    <img id="sidebar-avatar" src="" class="w-6 h-6 rounded-full border border-gray-200"> <span class="hidden xl:block font-bold" id="sidebar-name-text">Profile</span>
</a>
</nav>

<div class="mt-auto pb-6">
<div class="nav-item" onclick="openSettings()">
    <i data-lucide="menu" class="w-6 h-6"></i> <span class="hidden xl:block">More</span>
</div>
</div>
</aside>

<div id="workspace-layout" class="flex-1 flex min-w-0 md:ml-[72px] xl:ml-[245px] transition-all duration-300">
<main id="main-panel" class="flex-1 app-panel min-w-0 relative pb-16 md:pb-0">

<!-- Mobile Header -->
<header id="main-header" class="md:hidden fixed top-0 w-full z-20 flex items-center justify-between px-4">
    <h1 class="logo-text">EduLink</h1>
    <div class="flex items-center gap-4">
        <button onclick="toggleNotifications()" class="relative">
            <i data-lucide="heart" class="w-6 h-6 text-black"></i>
            <span id="mobile-notif-badge" class="absolute top-0 right-0 w-2 h-2 bg-red-500 rounded-full hidden"></span>
        </button>
        <button onclick="switchView('chat')"> <!-- Placeholder for future chat -->
            <i data-lucide="send" class="w-6 h-6 text-black"></i>
        </button>
    </div>
</header>

<!-- FEED VIEW -->
<div id="view-feed" class="flex-1 h-full overflow-y-auto no-scrollbar">
    <div class="md:hidden h-20 overflow-x-auto flex items-center gap-4 px-4 border-b border-outline mb-2">
        <!-- Stories Placeholder -->
        <div class="flex flex-col items-center gap-1 shrink-0">
            <div class="w-16 h-16 rounded-full bg-gradient-to-tr from-yellow-400 to-purple-600 p-[2px]">
                <div class="w-full h-full rounded-full bg-white p-[2px]">
                    <img src="https://api.dicebear.com/9.x/lorelei/svg?seed=Story" class="w-full h-full rounded-full bg-gray-200">
                </div>
            </div>
            <span class="text-xs truncate w-14 text-center">Your Story</span>
        </div>
    </div>
    
    <div id="feed-container" class="pb-20"></div>
    
    <div class="flex flex-col items-center justify-center py-10 opacity-60">
        <i data-lucide="check-circle" class="w-12 h-12 text-gray-300 mb-2"></i>
        <p class="text-sm text-gray-400">You're all caught up</p>
    </div>
</div>

<!-- PROFILE VIEW -->
<div id="view-profile" class="flex-1 h-full overflow-y-auto no-scrollbar hidden bg-white"></div>

<!-- NOTIFICATIONS VIEW -->
<div id="view-notifications" class="flex-1 h-full overflow-y-auto no-scrollbar hidden bg-white pt-14 md:pt-4 max-w-2xl mx-auto border-x border-outline">
    <h2 class="text-xl font-bold px-4 mb-4 hidden md:block">Notifications</h2>
    <div id="notification-list" class="w-full"></div>
</div>

<!-- EXPLORE VIEW -->
<div id="view-explore" class="flex-1 h-full overflow-y-auto no-scrollbar hidden bg-white pt-14 md:pt-4 max-w-4xl mx-auto">
    <div class="px-4 mb-4 hidden md:block">
        <input type="text" id="global-search" oninput="handleSearch(this.value)" class="w-full bg-gray-100 rounded-lg py-2 px-4 outline-none" placeholder="Search">
    </div>
    <div id="explore-results" class="pb-20"></div>
</div>

</main>
</div>

<!-- Bottom Nav for Mobile -->
<nav id="mobile-bottom-nav" class="md:hidden fixed bottom-0 left-0 w-full bg-white flex items-center justify-around z-50 px-2 shadow-[0_-1px_3px_rgba(0,0,0,0.05)]">
<div class="mobile-nav-item active" onclick="switchView('feed')">
<i data-lucide="home"></i>
</div>
<div class="mobile-nav-item" onclick="switchView('explore')">
<i data-lucide="search"></i>
</div>
<div class="mobile-nav-item" onclick="openCreateMenu()">
<div class="mobile-create-btn">
    <i data-lucide="plus" class="w-5 h-5 text-white"></i>
</div>
</div>
<div class="mobile-nav-item" onclick="switchView('notifications')">
<i data-lucide="heart"></i> <!-- Instagram uses Heart for notifs on mobile nav mostly -->
</div>
<div class="mobile-nav-item" onclick="showProfile(auth.currentUser ? auth.currentUser.uid : null)">
<img id="mobile-avatar" src="" class="w-6 h-6 rounded-full border border-gray-200">
</div>
</nav>

<input type="file" id="media-input" class="hidden" accept="image/*,video/*" onchange="handleFileSelect(event)">

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";
import { getFirestore, collection, doc, getDoc, setDoc, updateDoc, deleteDoc, arrayUnion, arrayRemove, addDoc, onSnapshot, query, orderBy, where, serverTimestamp, getDocs, writeBatch } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";
import { getStorage, ref, uploadString, getDownloadURL, uploadBytes } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-storage.js";

const firebaseConfig = {
apiKey: "AIzaSyAJH79UQl0rc96Qug0DKLevO4ZI_sn8Kno",
authDomain: "edulinki.firebaseapp.com",
projectId: "edulinki",
storageBucket: "edulinki.firebasestorage.app",
messagingSenderId: "248886466474",
appId: "1:248886466474:web:160043201a6b28bafbbdd3",
measurementId: "G-MQBH12VL7N"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);
const storage = getStorage(app);

// Expose services globally
window.auth = auth;
window.db = db;

// State Variables
let currentUser = null;
let users = [];
let posts = [];
let notifications = [];
let savedPosts = [];
let activeNotifTab = 'friends';
window.replyingToCommentId = null;
window.currentViewingProfileId = null;
window.activeExploreTab = 'people';
window.currentProfileTab = 'posts';

// Global Vars for App Logic
window.currentContext = "";
window.currentMedia = null;
window.currentMediaType = null;
window.currentMediaBlob = null;
window.editingPostId = null;

// Sandbox API Key for api.video (User provided)
const API_VIDEO_KEY = "gcQbU5Ewx8996Emed0W7pDy8ctd3TE1N9FWrJaLxd2j";

// Helper: Reliable Icon Refresh
function refreshIcons() {
if(window.lucide) {
window.lucide.createIcons();
}
}

// Helper: Date Formatter
function formatDate(timestamp) {
if (!timestamp) return '';
let date;
if (timestamp.toDate) date = timestamp.toDate();
else if (typeof timestamp === 'number') date = new Date(timestamp);
else date = new Date(timestamp);

const now = new Date();
const diff = Math.floor((now - date) / 1000); // seconds

if (diff < 60) return 'Just now';
if (diff < 3600) return `${Math.floor(diff / 60)}m`;
if (diff < 86400) return `${Math.floor(diff / 3600)}h`;
if (diff < 604800) return `${Math.floor(diff / 86400)}d`;
return `${Math.floor(diff / 604800)}w`;
}

// Auth Listener
onAuthStateChanged(auth, async (user) => {
const loader = document.getElementById('app-loader');
if (user) {
const userRef = doc(db, "users", user.uid);
const userSnap = await getDoc(userRef);
let isOfficial = false;
if(user.email === 'edulinkbht@gmail.com') { isOfficial = true; }

if (userSnap.exists()) {
currentUser = { id: user.uid, ...userSnap.data() };
if(isOfficial && !currentUser.isOfficial) {
await updateDoc(userRef, { isOfficial: true });
currentUser.isOfficial = true;
}
} else {
currentUser = {
id: user.uid,
name: user.displayName || user.email.split('@')[0],
email: user.email,
avatar: user.photoURL || `https://api.dicebear.com/9.x/lorelei/svg?seed=${user.uid}`,
bio: "New EduLink Member",
following: [],
followers: [],
saved: [],
isOfficial: isOfficial,
settings: { privateNetwork: false }
};
await setDoc(userRef, currentUser);
}

currentUser.following = currentUser.following || [];
currentUser.followers = currentUser.followers || [];
currentUser.saved = currentUser.saved || [];
currentUser.settings = currentUser.settings || { privateNetwork: false };

window.currentUser = currentUser;
savedPosts = currentUser.saved;

const params = new URLSearchParams(window.location.search);
const sharedPostId = params.get('postId');

updateUserInterface();
initRealtimeListeners();
refreshIcons();

if(loader) loader.style.opacity = '0';
setTimeout(() => { if(loader) loader.remove(); }, 500);

if(sharedPostId) {
setTimeout(() => {
openPostView(sharedPostId);
window.history.pushState({}, document.title, window.location.pathname);
}, 1000);
}

} else {
window.location.href = 'index.html';
}
});

function initRealtimeListeners() {
onSnapshot(collection(db, "users"), (snapshot) => {
users = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
refreshIcons();
});

const qPosts = query(collection(db, "posts"), orderBy("timestamp", "desc"));
onSnapshot(qPosts, { includeMetadataChanges: true }, (snapshot) => {
posts = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data(), timestamp: doc.data().timestamp }));
if (snapshot.metadata.hasPendingWrites) return;
renderFeed();
});

const qNotifs = query(collection(db, "notifications"), where("receiverId", "==", currentUser.id));
onSnapshot(qNotifs, (snapshot) => {
notifications = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data(), timestamp: doc.data().timestamp }));
notifications.sort((a,b) => (b.timestamp?.toDate ? b.timestamp.toDate() : 0) - (a.timestamp?.toDate ? a.timestamp.toDate() : 0));

const badge = document.getElementById('notif-badge');
const mobBadge = document.getElementById('mobile-notif-badge');
const unread = notifications.some(n => !n.read);
if(unread) {
    if(badge) badge.style.display = 'block';
    if(mobBadge) mobBadge.classList.remove('hidden');
} else {
    if(badge) badge.style.display = 'none';
    if(mobBadge) mobBadge.classList.add('hidden');
}
if(!document.getElementById('view-notifications').classList.contains('hidden')) renderNotifications();
});
}

function updateUserInterface() {
if(!currentUser) return;
// Update Avatars
const avatars = document.querySelectorAll('#sidebar-avatar, #mobile-avatar, #header-avatar, #compose-avatar');
avatars.forEach(img => img.src = currentUser.avatar);
const sidebarName = document.getElementById('sidebar-name-text');
if(sidebarName) sidebarName.innerText = currentUser.name;
const composeName = document.getElementById('compose-name');
if(composeName) composeName.innerText = currentUser.name;
refreshIcons();
}

window.switchView = function(viewName) {
    // Hide all main views
    const views = ['feed', 'explore', 'notifications', 'profile'];
    views.forEach(v => document.getElementById(`view-${v}`).classList.add('hidden'));
    
    // Reset Nav active states
    document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
    document.querySelectorAll('.mobile-nav-item').forEach(el => el.classList.remove('active'));
    
    // Show selected view
    const viewEl = document.getElementById(`view-${viewName}`);
    if(viewEl) viewEl.classList.remove('hidden');
    
    // Update Icons based on view
    if(viewName === 'feed') {
        document.getElementById('nav-feed').classList.add('active');
        document.querySelectorAll('.mobile-nav-item')[0].classList.add('active');
        renderFeed();
    } else if (viewName === 'explore') {
        document.getElementById('nav-explore').classList.add('active');
        document.querySelectorAll('.mobile-nav-item')[1].classList.add('active');
        handleSearch("");
    } else if (viewName === 'notifications') {
        document.getElementById('nav-notifications').classList.add('active');
        document.querySelectorAll('.mobile-nav-item')[3].classList.add('active');
        renderNotifications();
        // Clear badges
        document.getElementById('notif-badge').style.display = 'none';
        document.getElementById('mobile-notif-badge').classList.add('hidden');
    }
    
    refreshIcons();
}

// API VIDEO UPLOAD FUNCTION
async function uploadToApiVideo(file) {
    // 1. Create video container
    const createResponse = await fetch('https://ws.api.video/videos', {
        method: 'POST',
        headers: {
            'Authorization': `Bearer ${API_VIDEO_KEY}`,
            'Content-Type': 'application/json'
        },
        body: JSON.stringify({ 
            title: `EduLink Post - ${currentUser.name}`,
            public: true,
            mp4Support: true // Ensure we get mp4 link
        })
    });
    
    if(!createResponse.ok) throw new Error('Failed to create video container');
    const videoData = await createResponse.json();
    const videoId = videoData.videoId;
    
    // 2. Upload source
    const formData = new FormData();
    formData.append('file', file);
    
    const uploadResponse = await fetch(`https://ws.api.video/videos/${videoId}/source`, {
        method: 'POST',
        headers: {
            'Authorization': `Bearer ${API_VIDEO_KEY}`
        },
        body: formData
    });
    
    if(!uploadResponse.ok) throw new Error('Failed to upload video file');
    const uploadData = await uploadResponse.json();
    
    // Prefer mp4 for direct playback, fallback to player if processing
    if (uploadData.assets && uploadData.assets.mp4) {
        return uploadData.assets.mp4;
    } else {
        // If mp4 not ready immediately (transcoding), return the videoId or player link
        // For simple demo, we will construct the mp4 link pattern or use player
        // But better to use the mp4 asset URL from response. 
        // If null, it means it's encoding.
        // We will return the player url as fallback, but logic will prefer MP4
        return uploadData.assets.mp4 || uploadData.assets.player; 
    }
}

// Handle File Selection (Modified for Video)
window.handleFileSelect = function(event) {
    const file = event.target.files[0];
    if (file) {
        window.currentMediaBlob = file;
        window.currentMediaType = file.type.startsWith('video') ? 'video' : 'image';
        
        const reader = new FileReader();
        reader.onload = function(e) {
            window.currentMedia = e.target.result; // Data URL for preview
            
            // Show preview
            document.getElementById('media-drop-zone').classList.remove('bg-gray-50');
            document.getElementById('upload-placeholder').classList.add('hidden');
            document.getElementById('media-preview-container').classList.remove('hidden');
            
            if(window.currentMediaType === 'video') {
                const vid = document.getElementById('media-preview-video');
                vid.src = window.currentMedia;
                vid.classList.remove('hidden');
                document.getElementById('media-preview-img').classList.add('hidden');
            } else {
                const img = document.getElementById('media-preview-img');
                img.src = window.currentMedia;
                img.classList.remove('hidden');
                document.getElementById('media-preview-video').classList.add('hidden');
            }
        };
        reader.readAsDataURL(file);
    }
}

window.removeMedia = function() {
    window.currentMedia = null;
    window.currentMediaBlob = null;
    document.getElementById('media-preview-container').classList.add('hidden');
    document.getElementById('upload-placeholder').classList.remove('hidden');
    document.getElementById('media-input').value = "";
}

window.publishPost = async function() {
    const textRaw = document.getElementById('compose-text').value;
    const btn = document.getElementById('btn-publish');
    
    if (!textRaw.trim() && !window.currentMediaBlob) {
        showToast("Post cannot be empty", true);
        return;
    }
    
    btn.innerHTML = 'Sharing...';
    btn.disabled = true;
    
    try {
        let mediaUrl = null;
        
        if (window.currentMediaBlob) {
            if (window.currentMediaType === 'video') {
                // Upload to api.video
                mediaUrl = await uploadToApiVideo(window.currentMediaBlob);
            } else {
                // Upload Image (ImgHippo)
                mediaUrl = await uploadToImgHippo(window.currentMediaBlob);
            }
        }
        
        const postData = {
            authorId: currentUser.id,
            content: textRaw,
            media: mediaUrl,
            mediaType: window.currentMediaType || 'text', // Store type
            timestamp: serverTimestamp(),
            likes: [],
            comments: []
        };
        
        await addDoc(collection(db, "posts"), postData);
        showToast("Shared successfully");
        closeCompose();
        
    } catch (e) {
        console.error(e);
        showToast("Upload failed", true);
    } finally {
        btn.innerHTML = 'Share';
        btn.disabled = false;
    }
}

// ImgHippo Helper
async function uploadToImgHippo(file) {
    const formData = new FormData();
    formData.append('api_key', 'd28bf3c492ad07b53dc4e3f9ce99b072');
    formData.append('file', file);
    const res = await fetch('https://api.imghippo.com/v1/upload', { method: 'POST', body: formData });
    const data = await res.json();
    return data.success ? data.data.url : null;
}

// Feed Rendering (Instagram Style)
window.renderFeed = function() {
    const container = document.getElementById('feed-container');
    container.innerHTML = "";
    
    if(posts.length === 0) {
        container.innerHTML = `<div class="p-8 text-center text-gray-400">Follow people to see posts here</div>`;
        return;
    }
    
    posts.forEach(post => {
        const author = users.find(u => u.id === post.authorId) || { name: 'Unknown', avatar: '' };
        const isLiked = post.likes && post.likes.includes(currentUser.id);
        
        const div = document.createElement('article');
        div.className = "post-card";
        
        let mediaHTML = "";
        if (post.media) {
            if (post.mediaType === 'video' || post.media.includes('api.video') || post.media.includes('.mp4')) {
                // For video, we show a clickable area that opens the Reel view
                mediaHTML = `
                <div class="post-content-visual cursor-pointer relative group" onclick="openReelView('${post.id}')">
                    <video src="${post.media}" class="w-full h-full object-cover" muted loop onmouseover="this.play()" onmouseout="this.pause()"></video>
                    <div class="absolute top-2 right-2 bg-black/50 p-1.5 rounded-full">
                        <i data-lucide="video" class="w-4 h-4 text-white"></i>
                    </div>
                    <div class="absolute inset-0 flex items-center justify-center pointer-events-none">
                        <i data-lucide="play" class="w-16 h-16 fill-white text-transparent opacity-0 group-hover:opacity-50 transition-opacity"></i>
                    </div>
                </div>`;
            } else {
                mediaHTML = `
                <div class="post-content-visual">
                    <img src="${post.media}" class="w-full h-full object-cover">
                </div>`;
            }
        }
        
        div.innerHTML = `
            <div class="post-header">
                <div class="flex items-center cursor-pointer" onclick="showProfile('${author.id}')">
                    <div class="post-avatar-container">
                        <img src="${author.avatar}" class="post-avatar">
                    </div>
                    <span class="post-author-name">${author.name}</span>
                </div>
                <button class="icon-btn"><i data-lucide="more-horizontal" class="w-5 h-5"></i></button>
            </div>
            
            ${mediaHTML}
            
            <div class="post-actions">
                <div class="flex items-center gap-4">
                    <button class="action-btn like" onclick="toggleLike('${post.id}')">
                        <i data-lucide="heart" class="w-6 h-6 ${isLiked ? 'fill-red-500 text-red-500' : 'text-black'}"></i>
                    </button>
                    <button class="action-btn" onclick="openPostView('${post.id}')">
                        <i data-lucide="message-circle" class="w-6 h-6 -rotate-90"></i>
                    </button>
                    <button class="action-btn">
                        <i data-lucide="send" class="w-6 h-6"></i>
                    </button>
                </div>
                <button class="action-btn bookmark" onclick="toggleSave('${post.id}')">
                    <i data-lucide="bookmark" class="w-6 h-6"></i>
                </button>
            </div>
            
            <div class="px-[14px] font-semibold text-sm mb-1 mt-1">${post.likes ? post.likes.length : 0} likes</div>
            
            <div class="post-caption-area">
                <span class="username-caption cursor-pointer" onclick="showProfile('${author.id}')">${author.name}</span>
                <span class="text-sm">${post.content}</span>
            </div>
            
            ${post.comments && post.comments.length > 0 ? `<div class="px-[14px] text-gray-500 text-sm cursor-pointer mb-1" onclick="openPostView('${post.id}')">View all ${post.comments.length} comments</div>` : ''}
            
            <div class="post-time">${formatDate(post.timestamp)}</div>
        `;
        container.appendChild(div);
    });
    refreshIcons();
}

// Reel Logic
window.openReelView = function(postId) {
    const post = posts.find(p => p.id === postId);
    if(!post) return;
    
    // Only open if it is a video, else regular post view
    if (post.mediaType !== 'video' && !post.media.includes('.mp4')) {
        openPostView(postId);
        return;
    }
    
    const author = users.find(u => u.id === post.authorId);
    
    const player = document.getElementById('reel-player');
    player.src = post.media;
    player.currentTime = 0;
    
    document.getElementById('reel-username').innerText = author.name;
    document.getElementById('reel-avatar').src = author.avatar;
    document.getElementById('reel-caption').innerText = post.content;
    document.getElementById('reel-likes').innerText = post.likes ? post.likes.length : 0;
    document.getElementById('reel-comments').innerText = post.comments ? post.comments.length : 0;
    
    document.getElementById('reel-view-overlay').classList.remove('hidden');
    
    // Auto Play
    player.play().catch(e => console.log("Autoplay blocked", e));
}

window.closeReelView = function() {
    const player = document.getElementById('reel-player');
    player.pause();
    player.src = "";
    document.getElementById('reel-view-overlay').classList.add('hidden');
}

window.toggleReelPlay = function() {
    const player = document.getElementById('reel-player');
    const icon = document.getElementById('reel-play-icon');
    
    if (player.paused) {
        player.play();
        icon.classList.remove('opacity-100');
        icon.classList.add('opacity-0');
    } else {
        player.pause();
        icon.classList.remove('opacity-0');
        icon.classList.add('opacity-100');
    }
}

// Reel Progress bar update
document.getElementById('reel-player').addEventListener('timeupdate', function() {
    const progress = (this.currentTime / this.duration) * 100;
    document.getElementById('reel-progress').style.width = `${progress}%`;
});

// Post Actions (Like, Save) - Reusing Logic
window.toggleLike = async function(postId) {
    const postRef = doc(db, "posts", postId);
    const post = posts.find(p => p.id === postId);
    
    if(post.likes.includes(currentUser.id)) {
        await updateDoc(postRef, { likes: arrayRemove(currentUser.id) });
    } else {
        await updateDoc(postRef, { likes: arrayUnion(currentUser.id) });
        if(post.authorId !== currentUser.id) sendNotification(post.authorId, 'like', 'liked your post', postId);
    }
}

// ... (Other helpers similar to before: toggleSave, sendNotification) ...

// Simple Notifications Render
window.renderNotifications = function() {
    const container = document.getElementById('notification-list');
    container.innerHTML = "";
    if(notifications.length === 0) {
        container.innerHTML = `<div class="p-8 text-center text-gray-400">No notifications</div>`;
        return;
    }
    notifications.forEach(n => {
        const sender = users.find(u => u.id === n.senderId);
        const div = document.createElement('div');
        div.className = "flex items-center gap-3 p-4 border-b border-gray-50 hover:bg-gray-50 cursor-pointer";
        div.innerHTML = `
            <img src="${sender.avatar}" class="w-10 h-10 rounded-full">
            <div class="text-sm">
                <span class="font-bold text-black">${sender.name}</span>
                <span class="text-gray-600">${n.content}</span>
                <div class="text-xs text-gray-400 mt-1">${formatDate(n.timestamp)}</div>
            </div>
        `;
        container.appendChild(div);
    });
}

// Explore Render
window.handleSearch = function(query) {
    const container = document.getElementById('explore-results');
    container.innerHTML = "";
    
    // Grid Layout
    container.className = "grid grid-cols-3 gap-1 md:gap-4 pb-20";
    
    let filtered = posts;
    if(query) filtered = posts.filter(p => p.content.toLowerCase().includes(query.toLowerCase()));
    
    filtered.forEach(p => {
        const div = document.createElement('div');
        div.className = "relative aspect-square bg-gray-100 cursor-pointer group overflow-hidden";
        div.onclick = () => openReelView(p.id); // Or post view
        
        let content = '';
        if(p.mediaType === 'video' || p.media.includes('.mp4')) {
            content = `
                <video src="${p.media}" class="w-full h-full object-cover"></video>
                <div class="absolute top-2 right-2"><i data-lucide="video" class="w-4 h-4 text-white drop-shadow-md"></i></div>
            `;
        } else {
            content = `<img src="${p.media}" class="w-full h-full object-cover">`;
        }
        
        div.innerHTML = `
            ${content}
            <div class="absolute inset-0 bg-black/30 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center gap-4 text-white font-bold">
                <div class="flex items-center gap-1"><i data-lucide="heart" class="fill-white w-5 h-5"></i> ${p.likes.length}</div>
            </div>
        `;
        container.appendChild(div);
    });
    refreshIcons();
}

// Modal Management
window.openCompose = () => {
    document.getElementById('compose-overlay').classList.remove('hidden');
    document.getElementById('create-menu-overlay').classList.add('hidden');
}
window.closeCompose = () => {
    document.getElementById('compose-overlay').classList.add('hidden');
    removeMedia();
    document.getElementById('compose-text').value = "";
}
window.openCreateMenu = () => document.getElementById('create-menu-overlay').classList.remove('hidden');
window.closeCreateMenu = () => document.getElementById('create-menu-overlay').classList.add('hidden');

// Toast Helper
window.showToast = (msg) => {
    const toast = document.getElementById('toast');
    document.getElementById('toast-msg').innerText = msg;
    toast.classList.add('show');
    setTimeout(() => toast.classList.remove('show'), 3000);
}

// Initial Load
refreshIcons();
</script>
</body>
</html>
