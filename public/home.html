<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, interactive-widget=resizes-content">
<title>EduLink - Place where learning meets</title>
<link rel="icon" type="image/png" href="https://i.imghippo.com/files/vgr8207c.png">
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://unpkg.com/lucide@latest"></script>
<style>
@import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Google+Sans:wght@400;500;700&display=swap');
:root { --surface:#ffffff; --background:#ffffff; --on-surface:#0f0f0f; --text-secondary:#606060; --outline:#e5e7eb; --hover-bg:#f2f2f2; --primary:#065fd4; }
body { font-family:'Inter',sans-serif; background-color:var(--background); color:var(--on-surface); overflow:hidden; }
h1,h2,h3,.google-font { font-family:'Google Sans','Inter',sans-serif; }
* { scrollbar-width:none; -ms-overflow-style:none; } *::-webkit-scrollbar { width:0px; background:transparent; display:none; }
i[data-lucide],svg { flex-shrink:0; }
.fade-in { animation:fadeUp 0.4s cubic-bezier(0.2,0,0,1) forwards; opacity:0; transform:translateY(10px); }
@keyframes fadeUp { to { opacity:1; transform:translateY(0); } }
.app-panel { background:var(--surface); border-radius:0; border:none; height:100%; display:flex; flex-direction:column; overflow:hidden; transition:all 0.3s cubic-bezier(0.2,0,0,1); }
@media (min-width:768px) { .app-panel { border-radius:20px; border:1px solid var(--outline); box-shadow:0 1px 2px rgba(0,0,0,0.03); } }
@media (max-width:768px) { body { padding:0!important; } #workspace-layout { gap:0!important; } }
#main-sidebar { width:88px; flex-shrink:0; padding:24px 12px; transition:width 0.3s cubic-bezier(0.2,0,0,1),padding 0.3s ease; }
@media (min-width:1024px) { #main-sidebar { width:260px; padding:24px 20px; } }
.nav-item { display:flex; align-items:center; gap:14px; padding:12px; color:var(--text-secondary); font-weight:500; font-size:15px; border-radius:12px; transition:all 0.2s ease; cursor:pointer; text-decoration:none; margin-bottom:4px; justify-content:center; position:relative; }
.nav-item:hover { color:var(--on-surface); background-color:var(--hover-bg); }
.nav-item.active { color:var(--primary); background-color:#eff4ff; font-weight:600; }
.nav-badge { position:absolute; top:10px; right:12px; background-color:#cc0000; color:white; font-size:10px; font-weight:700; height:16px; min-width:16px; padding:0 4px; border-radius:10px; display:none; align-items:center; justify-content:center; border:2px solid #fff; z-index:10; }
.mobile-footer-badge { position:absolute; top:-4px; right:-4px; background-color:#cc0000; color:white; font-size:10px; font-weight:700; height:16px; min-width:16px; padding:0 4px; border-radius:10px; display:none; align-items:center; justify-content:center; border:2px solid #ffffff; z-index:20; }
@media (min-width:1024px) { .nav-item { justify-content:flex-start; padding:10px 16px; } .nav-badge { right:auto; left:28px; top:8px; } }
.sidebar-user { display:flex; align-items:center; gap:12px; padding:8px; border-radius:12px; cursor:pointer; transition:background-color 0.2s; justify-content:center; }
.sidebar-user:hover { background-color:var(--hover-bg); }
@media (min-width:1024px) { .sidebar-user { justify-content:flex-start; padding:8px 12px; } }
.create-btn { display:flex; align-items:center; justify-content:flex-start; gap:12px; background:#1f1f1f; color:white; padding:12px 20px; border-radius:12px; font-weight:500; font-size:14px; transition:all 0.2s ease; width:100%; margin-bottom:24px; box-shadow:0 4px 6px -1px rgba(0,0,0,0.1); line-height:1; min-width:0; white-space:nowrap; }
.create-btn:hover { background:#000; transform:translateY(-1px); box-shadow:0 10px 15px -3px rgba(0,0,0,0.1); }
.post-card { background:var(--surface); border-bottom:1px solid var(--outline); border-radius:0; transition:background-color 0.2s ease; margin-bottom:0; box-shadow:none; overflow:visible; }
.post-card:hover { background-color:#fdfdfd; cursor:pointer; transform:none; }
.post-header { display:flex; justify-content:space-between; align-items:flex-start; margin-bottom:12px; }
.post-avatar-container { position:relative; }
.post-avatar { width:40px; height:40px; border-radius:50%; background-color:var(--hover-bg); object-fit:cover; }
.post-author-name { font-weight:600; font-size:15px; color:var(--on-surface); line-height:1.2; }
.post-author-name:hover { text-decoration:underline; color:var(--primary); }
.post-meta { font-size:12px; color:var(--text-secondary); margin-top:2px; font-weight:400; }
.post-body { font-size:15px; line-height:1.6; color:var(--on-surface); margin-bottom:12px; white-space:pre-wrap; }
.post-actions { display:flex; align-items:center; justify-content:space-between; padding-top:12px; border-top:1px solid transparent; }
.action-btn { display:flex; align-items:center; gap:8px; padding:8px; border-radius:18px; color:var(--on-surface); font-size:13px; font-weight:500; transition:all 0.2s; background:transparent; border:none; cursor:pointer; }
.action-btn:hover { background-color:var(--hover-bg); }
.action-btn.like.active svg { fill:#ff0000; stroke:none; }
/* Yellow save icon */
.action-btn.bookmark.active svg { fill:#eab308; stroke:#eab308; } /* Yellow-500 */
#compose-modal,#create-menu-modal,#edit-profile-modal,#user-list-modal,#settings-modal,#likes-overlay,#username-modal,#add-link-modal,#promo-modal,#upload-options-modal,#share-modal { box-shadow:0 20px 60px rgba(0,0,0,0.15); border:1px solid var(--outline); }
.compose-header { display:flex; align-items:center; justify-content:space-between; padding-bottom:16px; margin-bottom:16px; border-bottom:1px solid var(--outline); }
.compose-title { font-size:18px; font-weight:600; color:var(--on-surface); font-family:'Google Sans',sans-serif; }
.compose-textarea { width:100%; min-height:120px; font-size:17px; line-height:1.6; color:var(--on-surface); border:none; outline:none; resize:none; background:transparent; }
.compose-tools { display:flex; align-items:center; justify-content:space-between; margin-top:16px; padding-top:16px; border-top:1px solid var(--outline); }
.tool-group { display:flex; gap:4px; }
.tool-btn { width:40px; height:40px; border-radius:50%; display:flex; align-items:center; justify-content:center; color:var(--text-secondary); transition:background 0.2s; cursor:pointer; }
.tool-btn:hover { background-color:var(--hover-bg); color:var(--on-surface); }
.create-option-card { display:flex; flex-direction:column; align-items:center; justify-content:center; padding:24px; border-radius:16px; border:1px solid var(--outline); background:var(--surface); cursor:pointer; transition:all 0.2s; gap:12px; height:140px; }
.create-option-card:hover { border-color:var(--primary); background:#eff4ff; transform:translateY(-2px); box-shadow:0 4px 12px rgba(11,87,208,0.1); }
.create-icon-bg { width:56px; height:56px; border-radius:50%; background:var(--hover-bg); display:flex; align-items:center; justify-content:center; color:var(--on-surface); margin-bottom:8px; transition:background 0.2s; }
.create-option-card:hover .create-icon-bg { background:#d3e3fd; color:#0b57d0; }
.media-preview-wrapper { margin-top:12px; position:relative; width:100%; background:var(--hover-bg); border-radius:12px; overflow:hidden; border:1px solid var(--outline); display:flex; justify-content:center; align-items:center; }
.media-preview-content { width:100%; height:auto; max-height:400px; object-fit:contain; display:block; }
.feed-panel { flex:1; min-width:0; order:1; }
.trending-panel { width:100%; flex-shrink:0; order:2; border-left:1px solid var(--outline); }
@media (min-width:1280px) { .trending-panel { width:380px; } }
.backdrop { position:fixed; inset:0; background:rgba(0,0,0,0.2); backdrop-filter:blur(2px); z-index:90; opacity:0; pointer-events:none; transition:opacity 0.3s; }
.backdrop.active { opacity:1; pointer-events:auto; }
.toast { position:fixed; bottom:100px; left:50%; transform:translateX(-50%) translateY(20px); background:#0f0f0f; color:#f2f2f2; padding:14px 28px; border-radius:48px; font-size:15px; opacity:0; pointer-events:none; transition:all 0.3s; z-index:200; display:flex; align-items:center; gap:12px; box-shadow:0 4px 20px rgba(0,0,0,0.15); }
.toast.show { opacity:1; transform:translateX(-50%) translateY(0); }
.icon-btn { width:40px; height:40px; border-radius:50%; display:flex; align-items:center; justify-content:center; transition:background 0.2s; cursor:pointer; color:var(--on-surface); }
.icon-btn:hover { background-color:var(--hover-bg); }
.post-options-menu { position:absolute; background:var(--surface); border:1px solid var(--outline); border-radius:12px; box-shadow:0 4px 6px -2px rgba(0,0,0,0.05),0 10px 15px -3px rgba(0,0,0,0.1); width:160px; z-index:50; opacity:0; pointer-events:none; transform:scale(0.95); transition:all 0.1s ease-out; padding:6px; }
.post-options-menu.active { opacity:1; pointer-events:auto; transform:scale(1); }
.post-option-item { display:flex; align-items:center; gap:10px; padding:10px; font-size:14px; color:var(--on-surface); cursor:pointer; border-radius:8px; transition:background 0.1s; font-weight:500; }
.post-option-item:hover { background:var(--hover-bg); color:var(--on-surface); }
.post-option-item.danger { color:#d92d20; }
.post-option-item.danger:hover { background:#fef2f2; color:#b91c1c; }
.tab-group { display:flex; width:100%; background:transparent; padding:0; border:none; border-bottom:1px solid var(--outline); border-radius:0; }
.tab-btn { flex:1; padding:14px 0; font-size:14px; font-weight:600; color:var(--text-secondary); border-radius:0; transition:all 0.2s ease; cursor:pointer; background:transparent; text-align:center; position:relative; display:flex; align-items:center; justify-content:center; gap:8px; }
.tab-btn:hover { color:var(--on-surface); background-color:var(--hover-bg); }
.tab-btn.active { color:var(--on-surface); background:transparent; box-shadow:none; }
.tab-btn.active i { stroke-width:3px; }
.tab-btn.active::after { content:''; position:absolute; bottom:0; left:50%; transform:translateX(-50%); width:60px; height:4px; background-color:var(--on-surface); border-radius:4px 4px 0 0; }
.grid-post-container { display:grid; grid-template-columns:repeat(3,1fr); gap:2px; }
@media (min-width:768px) { .grid-post-container { gap:16px; } }
.grid-post-item { position:relative; aspect-ratio:4/5; overflow:hidden; cursor:pointer; background-color:#f3f4f6; }
.grid-post-item:hover .grid-post-overlay { opacity:1; }
.grid-post-overlay { position:absolute; inset:0; background:rgba(0,0,0,0.3); display:flex; align-items:center; justify-content:center; opacity:0; transition:opacity 0.2s; color:white; font-weight:bold; gap:16px; }
.grid-post-text-preview { width:100%; height:100%; padding:12px; font-size:10px; display:flex; align-items:center; justify-content:center; text-align:center; color:#4b5563; background:#f9fafb; overflow:hidden; }
.mobile-nav-item { display:flex; flex-direction:column; align-items:center; justify-content:center; height:100%; flex:1; gap:4px; color:var(--on-surface); transition:all 0.2s; cursor:pointer; position:relative; }
.mobile-nav-item.active { color:var(--on-surface); }
.mobile-nav-item i { width:24px; height:24px; transition:transform 0.2s; stroke-width: 1.5px; }
.mobile-nav-item.active i { transform:scale(1.1); stroke-width:2.5px; fill: var(--on-surface); }
.scale-in { animation:scaleIn 0.3s cubic-bezier(0.2,0,0,1) forwards; }
@keyframes scaleIn { from { transform:scale(0.95); opacity:0; } to { transform:scale(1); opacity:1; } }
#app-loader { position:fixed; inset:0; background:var(--surface); z-index:9999; display:flex; justify-content:center; align-items:center; transition:opacity 0.5s ease; }
.loader-spinner { width:40px; height:40px; border:4px solid var(--hover-bg); border-top:4px solid var(--primary); border-radius:50%; animation:spin 1s linear infinite; }
.loader-logo { width:80px; height:80px; object-fit:contain; }
@keyframes spin { 0% { transform:rotate(0deg); } 100% { transform:rotate(360deg); } }
.profile-banner-container { height:140px; width:100%; background-color:#e5e7eb; position:relative; overflow:hidden; cursor:default; }
.profile-banner-img { width:100%; height:100%; object-fit:cover; pointer-events:none; }
.banner-edit-container { height:140px; width:100%; background:#e5e7eb; position:relative; overflow:hidden; cursor:grab; border-radius:12px; }
.banner-edit-container:active { cursor:grabbing; }
.banner-edit-img { width:100%; height:100%; object-fit:cover; user-select:none; -webkit-user-drag:none; }
.toggle-checkbox:checked { right:0; border-color:#0b57d0; }
.toggle-checkbox:checked+.toggle-label { background-color:#0b57d0; }
.toggle-switch { position:relative; width:44px; height:24px; background-color:#e5e7eb; border-radius:9999px; transition:background-color 0.2s; cursor:pointer; }
.toggle-switch.active { background-color:#0b57d0; }
.toggle-dot { position:absolute; top:2px; left:2px; width:20px; height:20px; background-color:white; border-radius:50%; transition:transform 0.2s; }
.toggle-switch.active .toggle-dot { transform:translateX(20px); }
#main-header { transition:transform 0.3s cubic-bezier(0.2,0,0,1); }
#explore-header-container { transition:transform 0.3s cubic-bezier(0.2,0,0,1); }
.collab-chip { display:inline-flex; align-items:center; background-color:#f3f4f6; padding:4px 10px; border-radius:20px; font-size:13px; margin-right:6px; margin-bottom:6px; color:#1f1f1f; border:1px solid #e5e7eb; }
.post-modal-layout { display:flex; flex-direction:column; width:100%; height:100%; overflow:hidden; gap:0; }
body.reel-mode #mobile-bottom-nav { display:none!important; }
.mobile-reel-view .mobile-header,.mobile-reel-view .mobile-footer { display:none!important; }
.mobile-reel-view .reel-ui-layer { display:flex!important; }
.reel-ui-layer { display:none; flex-direction:column; justify-content:space-between; position:absolute; inset:0; z-index:40; padding:16px 12px 30px; background:linear-gradient(to top,rgba(0,0,0,0.9) 0%,rgba(0,0,0,0.5) 30%,rgba(0,0,0,0) 80%,rgba(0,0,0,0.4) 100%); pointer-events:none; }
.reel-interact-btn { pointer-events:auto; display:flex; flex-direction:column; align-items:center; gap:4px; text-shadow:0 1px 2px rgba(0,0,0,0.5); }
.reel-interact-icon { width:32px; height:32px; color:white; filter:drop-shadow(0 2px 4px rgba(0,0,0,0.3)); }
.reel-interact-text { font-size:11px; font-weight:600; color:white; }
.reel-audio-btn { width:36px; height:36px; border-radius:50%; border:2px solid white; overflow:hidden; display:flex; align-items:center; justify-content:center; background:#1f1f1f; animation:spin 4s linear infinite; }
.mobile-reel-header { display:none; height:60px; background-color:#000000; align-items:center; padding:0 16px; z-index:50; flex-shrink:0; }
.mobile-reel-view .mobile-reel-header { display:flex; }
.reel-back-btn { width:36px; height:36px; border-radius:50%; background:rgba(255,255,255,0.2); display:flex; align-items:center; justify-content:center; color:white; }
@media (min-width:768px) { .post-modal-layout { flex-direction:row; width:90vw; max-width:1200px; height:85vh; gap:0; align-items:center; background:transparent; border-radius: 24px; overflow: hidden; } .stage-panel { flex:1; height:100%; background:radial-gradient(circle at center,#000 0%,#0f0f0f 100%); position:relative; display:flex; align-items:center; justify-content:center; overflow:hidden; min-width:0; } .stage-content { max-width:100%; max-height:100%; object-fit:contain; } .discussion-panel { width:450px; height:100%; background:#ffffff; display:flex; flex-direction:column; overflow:hidden; flex-shrink:0; } }
@media (max-width:767px) { .post-modal-layout { display:flex; flex-direction:column; background:#fff; width:100vw; height:100%; overflow:hidden; } .mobile-header { display:flex; flex-shrink:0; height:60px; align-items:center; justify-content:space-between; padding:0 16px; border-bottom:1px solid #f0f0f0; background:#fff; z-index:20; } .stage-panel { flex:1; background:#000; width:100%; position:relative; display:flex; align-items:center; justify-content:center; overflow:hidden; } .stage-content { width:100%; height:100%; object-fit:contain; } .mobile-footer { display:block; flex-shrink:0; background:#fff; border-top:1px solid #f0f0f0; padding:12px 16px; padding-bottom:calc(12px + env(safe-area-inset-bottom,20px)); z-index:20; } .mobile-actions-bar { display:flex; align-items:center; justify-content:space-between; margin-bottom:8px; } .mobile-action-group { display:flex; align-items:center; gap:20px; } .mobile-caption-text { font-size:14px; line-height:1.5; max-height:80px; overflow-y:auto; color:#0f0f0f; } .discussion-panel { position:absolute; bottom:0; left:0; right:0; height:75vh; background:#fff; z-index:50; border-radius:20px 20px 0 0; box-shadow:0 -4px 20px rgba(0,0,0,0.15); transform:translateY(100%); transition:transform 0.3s cubic-bezier(0.2,0,0,1); display:flex; flex-direction:column; } .discussion-panel.open { transform:translateY(0); } .caption-box { display:none!important; } .discussion-header { border-radius:20px 20px 0 0; background:white; } }
.discussion-header { padding:12px 16px; border-bottom:1px solid var(--outline); display:flex; align-items:center; justify-content:space-between; background:#fff; z-index:10; }
.discussion-scroll { flex:1; overflow-y:auto; padding:0; background:#fff; }
.caption-box { padding:16px; border-bottom:1px solid var(--outline); background:#fff; }
.comments-list { padding:0; display:flex; flex-direction:column; }
.discussion-footer { padding:12px 16px; border-top:1px solid var(--outline); background:#fff; z-index:10; }
/* YouTube Style Comments */
.comment-row { display:flex; gap:16px; align-items:flex-start; padding:12px 16px; transition:background-color 0.1s; }
.comment-row:hover { background-color: #f9f9f9; }
.comment-row.me { flex-direction:row; } /* Reset special 'me' direction for YT style */
.comment-avatar { width:40px; height:40px; border-radius:50%; object-fit:cover; background-color:var(--hover-bg); flex-shrink: 0; }
.comment-content-box { display:flex; flex-direction:column; gap:4px; flex: 1; min-width: 0; }
.comment-header { font-size:13px; font-weight:600; color:var(--on-surface); display:flex; align-items:center; gap:4px; line-height: 1.2; }
.comment-time { font-size:12px; font-weight:400; color:var(--text-secondary); }
.comment-text { font-size:14px; line-height:20px; color:var(--on-surface); white-space: pre-wrap; word-break: break-word; }
.comment-actions-row { display:flex; align-items:center; gap:16px; margin-top:4px; }
.comment-action-btn { display:flex; align-items:center; gap:6px; font-size:12px; font-weight:500; color:var(--on-surface); cursor:pointer; background:none; border:none; padding:4px 8px; border-radius:16px; transition:background 0.2s; }
.comment-action-btn:hover { background-color:var(--hover-bg); }
.comment-reply-btn { display:flex; align-items:center; justify-content:center; width:30px; height:30px; border-radius:50%; cursor:pointer; transition:background 0.2s; color:#0f0f0f; }
.comment-reply-btn:hover { background-color:var(--hover-bg); }
.chat-input-wrapper { display:flex; align-items:flex-end; background:transparent; padding:8px 0; gap: 12px; border-top: 1px solid transparent; }
.chat-input-field { flex: 1; border-bottom: 1px solid #ccc; padding-bottom: 4px; outline: none; transition: border-bottom-color 0.2s; font-size: 14px; max-height: 80px; resize: none; overflow-y: hidden; }
.chat-input-field:focus { border-bottom-color: var(--on-surface); }
.play-pause-overlay { position:absolute; inset:0; display:flex; align-items:center; justify-content:center; pointer-events:none; opacity:0; transition:opacity 0.2s; }
.play-pause-overlay.show { opacity:1; }
.play-pause-icon { width:80px; height:80px; background:rgba(0,0,0,0.4); border-radius:50%; padding:20px; color:white; backdrop-filter:blur(4px); }
.read-more-btn { color: var(--text-secondary); font-weight: 600; font-size: 14px; cursor: pointer; margin-left: 4px; }
.read-more-btn:hover { text-decoration: underline; }
.explore-tab-btn { font-size:16px; font-weight:700; color:#9ca3af; padding-bottom:4px; border-bottom:2px solid transparent; transition:all 0.2s; }
.explore-tab-btn.active { color:#1f1f1f; border-color:#1f1f1f; }
.category-chip { padding:6px 16px; border-radius:9999px; font-size:13px; font-weight:600; white-space:nowrap; border:1px solid #e5e7eb; color:#4b5563; background:white; cursor:pointer; transition:all 0.2s; }
.category-chip.active { background:#1f1f1f; color:white; border-color:#1f1f1f; }
.category-chip:hover:not(.active) { background:#f9fafb; }
@media (min-width:1024px) { #explore-results .grid { gap:16px!important; } #explore-results .aspect-square { border-radius:12px; } }
.trend-item { padding:12px; border-radius:12px; cursor:pointer; transition:background 0.2s; }
.trend-item:hover { background:var(--hover-bg); }
.trend-rank { font-size:11px; color:var(--text-secondary); margin-bottom:2px; }
.trend-tag { font-weight:700; color:var(--on-surface); margin-bottom:2px; font-size:15px; }
.trend-count { font-size:11px; color:var(--text-secondary); }
.post-carousel { position:relative; width:100%; overflow:hidden; background-color:#000; aspect-ratio:4/5; }
.post-carousel-inner { display:flex; transition:transform 0.3s ease-out; height:100%; width:100%; }
.post-carousel-item { min-width:100%; flex:0 0 100%; width:100%; height:100%; display:flex; justify-content:center; align-items:center; background:#000; }
.post-carousel-item img,.post-carousel-item video { width:100%; height:100%; object-fit:cover; }
/* Updated Carousel Dots: Outside */
.carousel-dots-outside { display:flex; justify-content:center; gap:6px; margin-top:10px; }
.carousel-dot { width:6px; height:6px; border-radius:50%; background:#d1d5db; transition:background 0.2s; }
.carousel-dot.active { background:#3b82f6; } /* Blue active dot */
.carousel-nav-btn { position:absolute; top:50%; transform:translateY(-50%); background:rgba(0,0,0,0.5); color:white; border-radius:50%; width:24px; height:24px; display:flex; align-items:center; justify-content:center; cursor:pointer; z-index:10; border:none; }
.carousel-nav-btn.prev { left:8px; } .carousel-nav-btn.next { right:8px; }
/* Overlay Consistency Mobile */
#thread-overlay { border-radius: 20px 20px 0 0; box-shadow: 0 -4px 20px rgba(0,0,0,0.15); }
#ptr-spinner { position:absolute; top:70px; left:50%; transform:translateX(-50%) translateY(-20px); width:40px; height:40px; background:white; border-radius:50%; box-shadow:0 3px 10px rgba(0,0,0,0.1); display:flex; justify-content:center; align-items:center; z-index:15; opacity:0; pointer-events:none; transition:transform 0.2s,opacity 0.2s; color:#0b57d0; }
@media(max-width: 768px) {
  #thread-overlay .discussion-panel { height: 75vh; width: 100%; position: absolute; bottom: 0; transform: translateY(0); }
  .thread-mobile-container { height: 75vh; background: #fff; width: 100%; display: flex; flex-direction: column; border-radius: 20px 20px 0 0; }
}
/* Share Menu Overlay CSS */
.share-icon-btn { display: flex; flex-direction: column; align-items: center; gap: 8px; width: 100%; padding: 12px 4px; border-radius: 12px; transition: background-color 0.2s; cursor: pointer; }
.share-icon-btn:hover { background-color: var(--hover-bg); }
.share-icon-circle { width: 48px; height: 48px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 20px; color: white; transition: transform 0.2s; }
.share-icon-btn:hover .share-icon-circle { transform: scale(1.05); }
</style>
</head>
<body class="h-screen flex overflow-hidden p-0 md:p-3 gap-4 bg-white">
<div id="app-loader"><img src="https://i.imghippo.com/files/fRGt5603uII.png" class="loader-logo"></div>
<div id="custom-alert" class="fixed inset-0 z-[80] flex items-center justify-center bg-black/40 backdrop-blur-sm hidden opacity-0 transition-opacity duration-200">
<div class="bg-white rounded-2xl p-6 shadow-2xl max-w-sm w-[90%] transform scale-95 transition-transform duration-200" id="custom-alert-box"><h3 class="text-lg font-bold text-[#1f1f1f] mb-2" id="alert-title">Confirm</h3><p class="text-gray-600 mb-6 text-sm" id="alert-msg">Are you sure?</p><div class="flex justify-end gap-3"><button class="px-4 py-2 text-gray-600 font-bold text-sm hover:bg-gray-100 rounded-lg transition-colors" onclick="closeAlert(false)">Cancel</button><button class="px-4 py-2 bg-[#0b57d0] text-white font-bold text-sm rounded-lg hover:bg-blue-700 transition-colors" id="alert-confirm-btn">Confirm</button></div></div></div>
<div id="username-modal" class="fixed inset-0 z-[90] flex items-center justify-center bg-black/60 backdrop-blur-sm hidden"><div class="bg-white w-[90%] max-w-[400px] rounded-[24px] shadow-2xl p-8 relative flex flex-col items-center"><h2 class="text-2xl font-bold text-[#1f1f1f] mb-2 google-font">Create Username</h2><p class="text-sm text-gray-500 mb-6 text-center">Choose a unique username.</p><div class="w-full relative mb-4"><span class="absolute left-4 top-3 text-gray-400 font-bold">@</span><input type="text" id="new-username-input" class="w-full bg-gray-100 rounded-xl py-3 pl-8 pr-4 outline-none focus:ring-2 focus:ring-blue-500 font-medium" placeholder="username"></div><button onclick="saveUsername()" class="w-full bg-[#0b57d0] text-white py-3 rounded-xl font-bold hover:bg-blue-700 transition-all">Start Exploring</button></div></div>
<div id="add-link-modal" class="fixed inset-0 z-[80] flex items-center justify-center bg-black/60 backdrop-blur-sm hidden"><div class="bg-white w-[90%] max-w-[400px] rounded-2xl shadow-2xl p-6 relative"><h3 class="text-lg font-bold text-gray-900 mb-4">Add Link</h3><div class="space-y-4 mb-6"><div><label class="text-xs font-bold text-gray-500 uppercase">Title</label><input type="text" id="new-link-title" class="w-full border-b border-gray-200 py-2 outline-none focus:border-blue-500 font-medium text-gray-900"></div><div><label class="text-xs font-bold text-gray-500 uppercase">URL</label><input type="url" id="new-link-url" class="w-full border-b border-gray-200 py-2 outline-none focus:border-blue-500 font-medium text-gray-900"></div></div><div class="flex justify-end gap-3"><button onclick="document.getElementById('add-link-modal').classList.add('hidden')" class="px-4 py-2 text-gray-600 font-bold text-sm hover:bg-gray-100 rounded-lg">Cancel</button><button onclick="saveLink()" class="px-4 py-2 bg-[#0b57d0] text-white font-bold text-sm rounded-lg hover:bg-blue-700">Add Link</button></div></div></div>
<div id="promo-modal" class="fixed inset-0 z-[80] flex items-center justify-center bg-black/60 backdrop-blur-sm hidden"><div class="bg-white w-[90%] max-w-[400px] rounded-2xl shadow-2xl p-6 relative"><h3 class="text-lg font-bold text-gray-900 mb-4">Edit Promo</h3><div class="space-y-4 mb-6"><div><label class="text-xs font-bold text-gray-500 uppercase">Image URL</label><div class="flex gap-2"><input type="text" id="promo-img-url" class="w-full border-b border-gray-200 py-2 outline-none focus:border-blue-500 font-medium text-gray-900"><button onclick="document.getElementById('promo-file-input').click()" class="icon-btn bg-gray-100 hover:bg-gray-200"><i data-lucide="upload" class="w-4 h-4"></i></button></div><input type="file" id="promo-file-input" class="hidden" accept="image/*" onchange="handlePromoFile(event)"></div><div><label class="text-xs font-bold text-gray-500 uppercase">Target Link</label><input type="url" id="promo-target-url" class="w-full border-b border-gray-200 py-2 outline-none focus:border-blue-500 font-medium text-gray-900"></div></div><div class="flex justify-end gap-3"><button onclick="document.getElementById('promo-modal').classList.add('hidden')" class="px-4 py-2 text-gray-600 font-bold text-sm hover:bg-gray-100 rounded-lg">Cancel</button><button onclick="savePromo()" class="px-4 py-2 bg-[#0b57d0] text-white font-bold text-sm rounded-lg hover:bg-blue-700">Save</button></div></div></div>
<div id="post-options-overlay" class="fixed inset-0 z-[75] flex items-end md:items-center justify-center bg-black/40 backdrop-blur-sm hidden opacity-0 transition-opacity duration-200" onclick="hidePostMenu()"><div id="post-options-modal" class="bg-white w-full md:w-[400px] md:rounded-[24px] rounded-t-[24px] shadow-2xl p-4 transform translate-y-full md:translate-y-0 md:scale-95 transition-transform duration-200" onclick="event.stopPropagation()"><div class="flex justify-center mb-4 md:hidden"><div class="w-12 h-1.5 bg-gray-300 rounded-full"></div></div><div id="post-options-content" class="flex flex-col gap-2"></div><button onclick="hidePostMenu()" class="w-full py-3 mt-2 font-bold text-gray-900 bg-gray-100 hover:bg-gray-200 rounded-xl transition-colors">Cancel</button></div></div>
<!-- SHARE OVERLAY START -->
<div id="share-overlay" class="fixed inset-0 z-[80] flex items-end md:items-center justify-center bg-black/40 backdrop-blur-sm hidden opacity-0 transition-opacity duration-200" onclick="closeShareMenu()"><div id="share-modal" class="bg-white w-full md:w-[400px] md:rounded-[24px] rounded-t-[24px] shadow-2xl p-6 relative transform translate-y-full md:translate-y-0 md:scale-95 transition-transform duration-200" onclick="event.stopPropagation()"><div class="w-12 h-1.5 bg-gray-300 rounded-full mx-auto mb-6 md:hidden"></div><h3 class="text-lg font-bold text-gray-900 mb-6 text-center">Share to...</h3><div class="grid grid-cols-4 gap-2 mb-6"><div class="share-icon-btn" onclick="triggerShare('copy')"><div class="share-icon-circle bg-gray-100 text-gray-800 border border-gray-200"><i data-lucide="link" class="w-6 h-6"></i></div><span class="text-xs font-medium text-gray-700">Copy Link</span></div><div class="share-icon-btn" onclick="triggerShare('twitter')"><div class="share-icon-circle bg-black text-white"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 4l11.733 16h4.267l-11.733 -16z"/><path d="M4 20l6.768 -6.768m2.46 -2.46l6.772 -6.772"/></svg></div><span class="text-xs font-medium text-gray-700">X</span></div><div class="share-icon-btn" onclick="triggerShare('whatsapp')"><div class="share-icon-circle bg-[#25D366] text-white"><svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 21l1.65 -3.8a9 9 0 1 1 3.4 2.9l-5.05 .9"/><path d="M9 10a.5 .5 0 0 0 1 0v-1a.5 .5 0 0 0 -1 0v1a5 5 0 0 0 5 5h1a.5 .5 0 0 0 0 -1h-1a.5 .5 0 0 0 0 1"/></svg></div><span class="text-xs font-medium text-gray-700">WhatsApp</span></div><div class="share-icon-btn" onclick="triggerShare('email')"><div class="share-icon-circle bg-blue-500 text-white"><i data-lucide="mail" class="w-6 h-6"></i></div><span class="text-xs font-medium text-gray-700">Email</span></div></div><div class="bg-gray-100 rounded-xl p-3 flex items-center gap-3"><div class="w-8 h-8 rounded-full bg-white flex items-center justify-center border border-gray-200 text-gray-500"><i data-lucide="link" class="w-4 h-4"></i></div><input type="text" id="share-link-input" class="bg-transparent border-none outline-none text-sm text-gray-600 flex-1 truncate" readonly><button onclick="triggerShare('copy')" class="text-sm font-bold text-[#0b57d0] hover:underline px-2">Copy</button></div><button onclick="closeShareMenu()" class="w-full py-3 mt-6 font-bold text-gray-900 bg-gray-50 hover:bg-gray-100 rounded-xl transition-colors border border-gray-200">Cancel</button></div></div>
<!-- SHARE OVERLAY END -->
<div id="upload-options-modal" class="fixed inset-0 z-[80] flex items-center justify-center bg-black/60 backdrop-blur-sm hidden" onclick="document.getElementById('upload-options-modal').classList.add('hidden')"><div class="bg-white w-[90%] max-w-[300px] rounded-2xl shadow-xl p-4 transform scale-100 transition-transform" onclick="event.stopPropagation()"><h3 class="text-center font-bold text-gray-900 mb-4 text-lg">Select Upload Type</h3><div class="flex flex-col gap-3"><button onclick="triggerUpload('single')" class="flex items-center gap-3 p-3 hover:bg-gray-50 rounded-xl border border-gray-100 transition-colors"><div class="w-10 h-10 rounded-full bg-blue-50 flex items-center justify-center text-blue-600"><i data-lucide="image" class="w-5 h-5"></i></div><span class="font-bold text-gray-700">Single</span></button><button onclick="triggerUpload('multiple')" class="flex items-center gap-3 p-3 hover:bg-gray-50 rounded-xl border border-gray-100 transition-colors"><div class="w-10 h-10 rounded-full bg-purple-50 flex items-center justify-center text-purple-600"><i data-lucide="layers" class="w-5 h-5"></i></div><span class="font-bold text-gray-700">Multiple (Carousel)</span></button></div></div></div>
<div id="mobile-notifications-header" class="md:hidden fixed top-0 left-0 w-full bg-white z-30 flex-col hidden border-b border-gray-100 pb-0"><div class="h-14 flex items-center justify-between px-4 shrink-0 relative"><span class="font-bold text-lg text-[#1f1f1f]">Notifications</span><div class="flex items-center gap-3"><button onclick="toggleNotifSearchMobile()" class="icon-btn"><i data-lucide="search" class="w-5 h-5 text-[#1f1f1f]"></i></button><div class="relative"><button onclick="toggleNotifMenu()" class="icon-btn"><i data-lucide="more-vertical" class="w-5 h-5 text-[#1f1f1f]"></i></button><div id="notif-menu-dropdown" class="absolute right-0 top-10 bg-white border border-gray-100 shadow-xl rounded-xl z-50 w-48 hidden flex-col overflow-hidden"><button onclick="toggleNotifSelection()" class="px-4 py-3 text-left hover:bg-gray-50 text-sm font-medium border-b border-gray-50 text-gray-700">Select</button><button onclick="deleteSelectedNotifs()" class="px-4 py-3 text-left hover:bg-gray-50 text-sm font-medium text-red-500">Delete Selected</button><button onclick="clearAllNotifications()" class="px-4 py-3 text-left hover:bg-gray-50 text-sm font-medium text-red-500">Delete All</button></div></div></div></div><div id="mobile-notif-search-container" class="px-4 pb-2 hidden"><div class="relative"><i data-lucide="search" class="absolute left-3 top-2.5 w-4 h-4 text-gray-400"></i><input type="text" id="notif-search" placeholder="Search..." oninput="handleNotifSearch(this.value)" class="w-full bg-gray-100 rounded-xl py-2 pl-9 pr-4 text-sm outline-none focus:ring-1 focus:ring-blue-500 transition-all"></div></div><div class="tab-group mb-0 mx-0 w-full"><button onclick="switchNotifTab('all')" id="ntab-all-mobile" class="tab-btn active"><i data-lucide="bell" class="w-5 h-5"></i> All</button><button onclick="switchNotifTab('official')" id="ntab-official-mobile" class="tab-btn"><i data-lucide="megaphone" class="w-5 h-5"></i> Official</button></div></div>
<div id="thread-overlay" class="fixed inset-0 z-[65] hidden flex justify-center items-end md:items-center"><div class="absolute inset-0 bg-black/40 backdrop-blur-sm transition-opacity" onclick="closeThread()"></div><div class="bg-white w-full md:w-[450px] h-[75vh] md:h-[85vh] md:rounded-[24px] rounded-t-[20px] shadow-2xl relative flex flex-col transform transition-transform duration-300 scale-100 opacity-100 overflow-hidden scale-in thread-mobile-container"><div class="discussion-header"><div class="flex items-center gap-3"><button onclick="closeThread()" class="icon-btn hover:bg-gray-100 md:hidden"><i data-lucide="chevron-down" class="w-6 h-6 text-gray-600"></i></button><span class="font-bold text-lg text-[#1f1f1f]">Thread</span></div><button onclick="closeThread()" class="icon-btn hover:bg-gray-100 hidden md:flex"><i data-lucide="x" class="w-5 h-5 text-gray-600"></i></button></div><div id="thread-content" class="discussion-scroll bg-white"></div><div class="discussion-footer"><div class="chat-input-wrapper"><img id="thread-input-avatar" src="" class="w-7 h-7 rounded-full bg-gray-200 object-cover mr-2 shrink-0"><textarea id="thread-input" placeholder="Add a reply..." class="chat-input-field" onkeydown="if(event.key==='Enter'&&!event.shiftKey){event.preventDefault();submitThreadReply();}"></textarea><button onclick="submitThreadReply()" class="text-white bg-[#065fd4] font-medium text-sm px-4 py-2 rounded-full hover:bg-blue-700 transition-colors">Reply</button></div></div></div></div>
<div id="post-view-overlay" class="fixed inset-0 z-[60] hidden flex justify-center items-center"><div class="absolute inset-0 bg-black/80 backdrop-blur-md transition-opacity" onclick="closePostView()"></div><div class="post-modal-layout scale-in relative z-10"><div class="mobile-header md:hidden"><div class="flex items-center gap-3 cursor-pointer" onclick="closePostView();if(window.currentViewingProfileId)showProfile(window.currentViewingProfileId)"><img id="mobile-post-pfp" class="w-8 h-8 rounded-full border border-gray-200 object-cover bg-white"><span id="mobile-post-username" class="font-bold text-sm text-[#1f1f1f]">User</span></div><button onclick="closePostView()" class="icon-btn hover:bg-gray-100 w-9 h-9 border border-gray-200"><i data-lucide="x" class="w-5 h-5 text-gray-600"></i></button></div><div id="mobile-reel-header" class="mobile-reel-header md:hidden"><button onclick="closePostView()" class="reel-back-btn"><i data-lucide="chevron-left" class="w-6 h-6"></i></button><span class="ml-4 text-white font-bold text-lg">Frame</span></div><div id="post-view-media-container" class="stage-panel group relative"><div id="video-play-overlay" class="play-pause-overlay"><i data-lucide="play" class="play-pause-icon"></i></div></div><div id="reel-ui-layer" class="reel-ui-layer md:hidden"><div class="mt-14 pointer-events-none"></div><div class="flex items-end justify-between w-full"><div class="flex flex-col gap-3 max-w-[80%] text-white drop-shadow-md pointer-events-auto pb-2"><div class="flex items-center gap-2 cursor-pointer" id="reel-user-info-area"><img id="reel-user-avatar" src="" class="w-8 h-8 rounded-full border border-white/50 object-cover"><span id="reel-username" class="font-bold text-sm">Username</span><button id="reel-follow-btn" class="bg-white/20 backdrop-blur text-xs px-2.5 py-1 rounded-md font-medium border border-white/30 hidden">Follow</button></div><div id="reel-caption" class="text-sm leading-snug opacity-90 break-words"></div></div><div class="flex flex-col gap-5 items-center pointer-events-auto pb-2 mr-1"><div class="reel-interact-btn cursor-pointer"><div onclick="if(window.currentViewingPostId)toggleLike(window.currentViewingPostId)"><i id="reel-like-icon" data-lucide="heart" class="reel-interact-icon"></i></div><span id="reel-like-count" class="reel-interact-text mt-1 p-1" onclick="if(window.currentViewingPostId)openLikes(window.currentViewingPostId)">0</span></div><div class="reel-interact-btn cursor-pointer" onclick="toggleMobileCommentDrawer()"><i data-lucide="message-circle" class="reel-interact-icon"></i><span id="reel-comment-count" class="reel-interact-text">0</span></div><div class="reel-interact-btn cursor-pointer" onclick="if(window.currentViewingPostId)sharePost(window.currentViewingPostId)"><i data-lucide="send" class="reel-interact-icon transform -rotate-12"></i></div><div class="reel-interact-btn cursor-pointer" onclick="if(window.currentViewingPostId)toggleSave(window.currentViewingPostId)"><i id="reel-save-icon" data-lucide="bookmark" class="reel-interact-icon"></i></div><div class="reel-interact-btn mt-2"><div class="reel-audio-btn"><i data-lucide="disc" class="w-5 h-5 text-white"></i></div></div></div></div></div><div class="mobile-footer md:hidden"><div class="mobile-actions-bar"><div class="mobile-action-group"><i id="mobile-action-like" data-lucide="heart" class="w-7 h-7 text-[#1f1f1f] cursor-pointer" onclick="if(window.currentViewingPostId)toggleLike(window.currentViewingPostId)"></i><i data-lucide="message-circle" class="w-7 h-7 text-[#1f1f1f] cursor-pointer" onclick="toggleMobileCommentDrawer()"></i><i data-lucide="send" class="w-7 h-7 text-[#1f1f1f] cursor-pointer" onclick="if(window.currentViewingPostId)sharePost(window.currentViewingPostId)"></i></div><i id="mobile-action-save" data-lucide="bookmark" class="w-7 h-7 text-[#1f1f1f] cursor-pointer" onclick="if(window.currentViewingPostId)toggleSave(window.currentViewingPostId)"></i></div><div id="mobile-like-count" class="text-sm font-bold text-[#1f1f1f] mb-1">0 likes</div><div id="mobile-post-caption" class="mobile-caption-text"></div></div><div class="discussion-panel"><div class="discussion-header"><div class="flex items-center gap-3"><span class="font-bold text-xl text-[#0f0f0f]">Comments</span></div><button onclick="closePostView()" class="icon-btn hover:bg-gray-100 hidden md:flex"><i data-lucide="x" class="w-5 h-5 text-gray-500"></i></button><button onclick="toggleMobileCommentDrawer()" class="icon-btn hover:bg-gray-100 md:hidden"><i data-lucide="x" class="w-5 h-5 text-gray-500"></i></button></div><div id="post-view-scroll" class="discussion-scroll scroll-smooth"><div id="post-view-caption-area" class="caption-box hidden"></div><div id="post-view-comments" class="comments-list"></div></div><div class="discussion-footer"><div class="flex justify-between items-center mb-3 px-1 hidden md:flex"><div class="flex gap-4"><i id="post-view-like-btn" data-lucide="heart" class="w-6 h-6 text-gray-700 cursor-pointer hover:scale-110 transition-transform"></i><i data-lucide="message-circle" class="w-6 h-6 text-gray-700 cursor-pointer hover:scale-110 transition-transform" onclick="document.getElementById('comment-input-desktop').focus()"></i><i data-lucide="send" class="w-6 h-6 text-gray-700 cursor-pointer hover:scale-110 transition-transform" onclick="if(window.currentViewingPostId)sharePost(window.currentViewingPostId)"></i></div><div class="flex gap-4 items-center"><span class="font-bold text-sm text-gray-900 cursor-pointer hover:underline" id="post-view-likes-count" onclick="openLikes(window.currentViewingPostId)">0 likes</span><i id="post-view-save-btn" data-lucide="bookmark" class="w-6 h-6 text-gray-700 cursor-pointer hover:scale-110 transition-transform"></i></div></div><div class="chat-input-wrapper"><img id="comment-input-avatar" src="" class="w-8 h-8 rounded-full bg-gray-200 object-cover"><textarea id="comment-input-desktop" placeholder="Add a comment..." class="chat-input-field" onkeydown="if(event.key==='Enter'&&!event.shiftKey){event.preventDefault();submitCommentDesktop();}"></textarea><button onclick="submitCommentDesktop()" class="text-white bg-[#065fd4] font-medium text-sm px-4 py-2 rounded-full hover:bg-blue-700 transition-colors">Comment</button></div></div></div></div></div>
<div id="lightbox" class="fixed inset-0 bg-black/95 z-[9999] flex justify-center items-center opacity-0 pointer-events-none transition-opacity duration-300" onclick="closeLightbox()"><button class="absolute top-8 right-8 text-white/70 hover:text-white bg-white/10 rounded-full p-3 hover:bg-white/20"><i data-lucide="x" class="w-8 h-8"></i></button><div id="lightbox-wrapper" class="w-full h-full flex justify-center items-center p-6"></div></div>
<div id="toast" class="toast"><i id="toast-icon" data-lucide="check-circle-2" class="w-5 h-5 text-[#c4eed0]"></i><span id="toast-msg">Action Completed</span></div>
<div id="likes-overlay" class="fixed inset-0 z-[70] flex items-end md:items-center justify-center bg-black/40 backdrop-blur-sm hidden opacity-0 transition-opacity duration-200" onclick="closeLikes()"><div id="likes-modal" class="bg-white w-full h-[70vh] md:h-auto md:w-[400px] md:max-h-[80vh] md:rounded-[24px] rounded-t-[24px] shadow-2xl relative transform translate-y-full md:translate-y-0 md:scale-95 transition-transform duration-200 flex flex-col overflow-hidden" onclick="event.stopPropagation()"><div class="w-12 h-1.5 bg-gray-300 rounded-full mx-auto mt-3 mb-1 shrink-0 md:hidden"></div><div class="flex justify-between items-center p-4 border-b border-gray-100 shrink-0"><h3 class="text-lg font-bold text-gray-900">Likes</h3><button onclick="closeLikes()" class="icon-btn hover:bg-gray-100"><i data-lucide="x" class="w-5 h-5"></i></button></div><div id="likes-list-content" class="flex-1 overflow-y-auto p-2"></div></div></div>
<div id="settings-overlay" class="fixed inset-0 z-[70] flex items-center justify-center bg-black/40 backdrop-blur-sm hidden" onclick="closeSettings()"><div class="bg-white w-[90%] max-w-[450px] rounded-[24px] shadow-2xl p-6 relative transform transition-all scale-100 overflow-hidden flex flex-col max-h-[85vh]" onclick="event.stopPropagation()"><div class="flex justify-between items-center mb-6"><h2 class="text-xl font-bold text-[#1f1f1f] google-font">Settings</h2><button onclick="closeSettings()" class="icon-btn hover:bg-gray-100"><i data-lucide="x" class="w-5 h-5"></i></button></div><div class="flex-1 overflow-y-auto space-y-6"><div><h3 class="text-xs font-bold text-gray-500 uppercase tracking-wider mb-3">Privacy</h3><div class="flex items-center justify-between py-2"><div><div class="font-medium text-gray-900">Private Account</div><div class="text-xs text-gray-500">Only followers can see your posts</div></div><div id="toggle-privacy" class="toggle-switch" onclick="togglePrivacy()"><div class="toggle-dot"></div></div></div></div><div><h3 class="text-xs font-bold text-gray-500 uppercase tracking-wider mb-3">About</h3><a href="pre.html" class="flex items-center justify-between py-3 hover:bg-gray-50 rounded-lg px-2 -mx-2 transition-colors group"><div class="flex items-center gap-3"><div class="w-8 h-8 rounded-full bg-yellow-100 flex items-center justify-center text-yellow-600"><i data-lucide="crown" class="w-4 h-4"></i></div><span class="font-medium text-gray-900">Premium</span></div><i data-lucide="chevron-right" class="w-4 h-4 text-gray-400 group-hover:text-gray-600"></i></a><a href="p.html" class="flex items-center justify-between py-3 hover:bg-gray-50 rounded-lg px-2 -mx-2 transition-colors group"><div class="flex items-center gap-3"><div class="w-8 h-8 rounded-full bg-blue-100 flex items-center justify-center text-blue-600"><i data-lucide="shield" class="w-4 h-4"></i></div><span class="font-medium text-gray-900">Privacy Policy</span></div><i data-lucide="chevron-right" class="w-4 h-4 text-gray-400 group-hover:text-gray-600"></i></a><a href="idea.html" class="flex items-center justify-between py-3 hover:bg-gray-50 rounded-lg px-2 -mx-2 transition-colors group"><div class="flex items-center gap-3"><div class="w-8 h-8 rounded-full bg-indigo-100 flex items-center justify-center text-indigo-600"><i data-lucide="book-open" class="w-4 h-4"></i></div><span class="font-medium text-gray-900">Learn about EduLink</span></div><i data-lucide="chevron-right" class="w-4 h-4 text-gray-400 group-hover:text-gray-600"></i></a></div></div><div class="mt-6 pt-4 border-t border-gray-100"><button onclick="doLogout()" class="w-full py-3 text-red-500 font-bold hover:bg-red-50 rounded-xl transition-colors">Log Out</button></div></div></div>
<div id="user-list-overlay" class="fixed inset-0 z-[70] flex items-center justify-center bg-black/40 backdrop-blur-sm hidden" onclick="closeUserList()"><div class="bg-white w-[90%] max-w-[400px] rounded-[24px] shadow-2xl flex flex-col max-h-[80vh] overflow-hidden transform transition-all scale-100" onclick="event.stopPropagation()"><div class="flex justify-between items-center p-4 border-b border-gray-100"><h3 class="text-lg font-bold text-gray-900" id="user-list-title">Users</h3><button onclick="closeUserList()" class="icon-btn hover:bg-gray-100"><i data-lucide="x" class="w-5 h-5"></i></button></div><div id="user-list-content" class="flex-1 overflow-y-auto p-2"></div></div></div>
<div id="create-menu-overlay" class="fixed inset-0 z-50 flex items-center justify-center bg-[#000]/40 backdrop-blur-sm opacity-0 pointer-events-none transition-opacity duration-200" onclick="closeCreateMenu()"><div id="create-menu-modal" class="bg-white w-[90%] max-w-[500px] rounded-[24px] shadow-2xl p-6 relative transform scale-95 transition-transform duration-200" onclick="event.stopPropagation()"><div class="flex justify-between items-center mb-6"><h2 class="text-xl font-bold text-[#1f1f1f] google-font">Create New</h2><button onclick="closeCreateMenu()" class="icon-btn hover:bg-[#f0f4f9]"><i data-lucide="x" class="w-5 h-5"></i></button></div><div class="grid grid-cols-1 gap-4"><div class="create-option-card" onclick="openCompose()"><div class="create-icon-bg"><i data-lucide="pen-tool" class="w-6 h-6"></i></div><span class="font-bold text-[#1f1f1f]">Post</span></div><div id="create-option-ad" class="create-option-card hidden" onclick="openPromoModal(event);closeCreateMenu()"><div class="create-icon-bg"><i data-lucide="megaphone" class="w-6 h-6"></i></div><span class="font-bold text-[#1f1f1f]">Ad</span></div></div></div></div>
<div id="edit-profile-overlay" class="fixed inset-0 z-50 flex items-end md:items-center justify-center bg-black/40 backdrop-blur-sm hidden opacity-0 transition-opacity duration-200" onclick="closeEditProfile()"><div id="edit-profile-modal" class="bg-white w-full h-[85vh] md:h-auto md:w-[95%] md:max-w-[500px] md:max-h-[90vh] md:rounded-[24px] rounded-t-[24px] shadow-2xl relative transform translate-y-full md:translate-y-0 md:scale-95 transition-transform duration-200 flex flex-col" onclick="event.stopPropagation()"><div class="w-12 h-1.5 bg-gray-300 rounded-full mx-auto mt-3 mb-1 shrink-0 md:hidden"></div><div class="flex justify-between items-center p-4 border-b border-gray-100 shrink-0"><h2 class="text-xl font-bold google-font">Edit Profile</h2><button onclick="closeEditProfile()" class="icon-btn"><i data-lucide="x" class="w-5 h-5"></i></button></div><div class="flex-1 overflow-y-auto p-6 pb-24 md:pb-6"><div class="flex flex-col gap-5"><div class="flex flex-col items-center mb-2"><div class="relative group cursor-pointer" onclick="document.getElementById('edit-avatar-input').click()"><img id="edit-avatar-preview" src="" class="w-24 h-24 rounded-full border-2 border-gray-100 object-cover"><div class="absolute inset-0 bg-black/40 rounded-full flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity"><i data-lucide="camera" class="text-white w-6 h-6"></i></div></div><input type="file" id="edit-avatar-input" class="hidden" accept="image/*" onchange="handleEditAvatarSelect(event)"><input type="file" id="edit-banner-input" class="hidden" accept="image/*" onchange="handleEditBannerSelect(event)"></div><div><label class="text-xs font-bold text-gray-500 uppercase mb-2 block">Banner Image</label><div id="banner-edit-area" class="banner-edit-container group mb-2 h-36" onclick="document.getElementById('edit-banner-input').click()"><img id="edit-banner-preview" src="" class="banner-edit-img" style="object-position:center 50%"><div class="absolute inset-0 bg-black/30 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity"><i data-lucide="upload" class="text-white w-6 h-6"></i></div></div><div class="text-[10px] text-gray-400 mb-1 flex justify-between"><span>Click banner to change, drag to reposition</span> <span id="banner-pos-hint">50%</span></div></div><div><label class="text-xs font-bold text-gray-500 uppercase">Display Name</label><input type="text" id="edit-name" class="w-full border-b border-gray-200 py-2 outline-none focus:border-blue-500 font-medium text-gray-900"></div><div><label class="text-xs font-bold text-gray-500 uppercase">Email</label><input type="text" id="edit-email" class="w-full border-b border-gray-200 py-2 outline-none text-gray-500 bg-transparent select-text" disabled></div><div><label class="text-xs font-bold text-gray-500 uppercase">Bio</label><textarea id="edit-bio" class="w-full border-b border-gray-200 py-2 outline-none focus:border-blue-500 text-sm text-gray-700 resize-none" rows="3"></textarea></div><button id="save-profile-btn" onclick="saveProfileChanges()" class="w-full bg-[#0b57d0] text-white py-3 rounded-xl font-bold hover:bg-blue-700 transition-all mt-4 mb-8 md:mb-0">Save Changes</button></div></div></div></div>
<input type="file" id="event-cover-input" class="hidden" accept="image/*" onchange="handleEventCoverSelect(event)">
<div id="event-overlay" class="fixed inset-0 z-[55] flex items-center justify-center bg-[#000]/40 backdrop-blur-sm opacity-0 pointer-events-none transition-opacity duration-200"><div id="event-modal-box" class="bg-white w-[95%] max-w-[550px] rounded-[16px] shadow-2xl relative transform scale-95 transition-transform duration-200 flex flex-col overflow-hidden p-0"><div id="event-cover-preview-container" class="w-full h-40 bg-gray-100 hidden relative group"><img id="event-cover-preview" class="w-full h-full object-cover"><button onclick="removeEventCover()" class="absolute top-2 right-2 bg-black/50 text-white p-1 rounded-full opacity-0 group-hover:opacity-100 transition-opacity hover:bg-black/70 z-20"><i data-lucide="x" class="w-4 h-4"></i></button><button onclick="document.getElementById('event-cover-input').click()" class="absolute bottom-2 right-2 bg-white/80 text-gray-700 text-xs font-bold px-2 py-1 rounded opacity-0 group-hover:opacity-100 transition-opacity hover:bg-white z-20">Change</button></div><button onclick="closeEventComposer()" class="absolute top-4 right-4 icon-btn hover:bg-[#f0f4f9] z-10 bg-white/50 backdrop-blur-sm"><i data-lucide="x" class="w-5 h-5"></i></button><div class="p-8 pt-6"><div id="add-cover-btn" class="mb-6 opacity-60 hover:opacity-100 transition-opacity cursor-pointer flex items-center gap-2 text-sm text-[#667085]" onclick="document.getElementById('event-cover-input').click()"><i data-lucide="image" class="w-4 h-4"></i> Add cover</div><input type="text" id="event-title" placeholder="Untitled Event" class="text-3xl font-bold text-[#1f1f1f] placeholder-[#d1d5db] border-none outline-none bg-transparent w-full mb-6 google-font"><div class="flex flex-col gap-1 mb-6"><div class="notion-input-row"><div class="notion-label"><i data-lucide="clock" class="w-4 h-4"></i> Date</div><input type="date" id="event-date" class="notion-input"></div><div class="notion-input-row"><div class="notion-label"><i data-lucide="watch" class="w-4 h-4"></i> Time</div><input type="time" id="event-time" class="notion-input"></div><div class="notion-input-row"><div class="notion-label"><i data-lucide="map-pin" class="w-4 h-4"></i> Location</div><input type="text" id="event-location" placeholder="Add location..." class="notion-input"></div></div><textarea id="event-desc" placeholder="Add description..." class="w-full min-h-[100px] resize-none border-none outline-none text-[#374151] text-[15px] leading-relaxed bg-transparent"></textarea><div class="flex justify-end mt-6 pt-4 border-t border-gray-100"><button onclick="publishEvent()" class="bg-[#0b57d0] text-white px-6 py-2 rounded-lg font-bold text-sm hover:bg-[#0b57d0]/90 transition-all shadow-sm">Create Event</button></div></div></div></div>
<div id="compose-overlay" class="fixed inset-0 z-[55] flex items-center justify-center bg-[#000]/40 backdrop-blur-sm opacity-0 pointer-events-none transition-opacity duration-200" onclick="closeCompose()"><div id="compose-modal" class="bg-white w-full h-full md:w-[95%] md:max-w-[620px] md:h-auto md:rounded-[24px] shadow-2xl p-6 relative transform scale-100 md:scale-95 transition-transform duration-200 flex flex-col" onclick="event.stopPropagation()"><div class="compose-header"><div class="flex items-center gap-3"><button onclick="closeCompose()" class="icon-btn hover:bg-[#f0f4f9] w-8 h-8"><i data-lucide="x" class="w-5 h-5"></i></button><span class="compose-title" id="compose-title-text">Create Post</span></div><button onclick="publishPost()" class="md:hidden text-[#0b57d0] font-bold text-sm px-3 py-1 bg-blue-50 rounded-full">Post</button></div><div class="flex gap-3 mb-4 items-center"><img id="compose-avatar" src="" class="w-10 h-10 rounded-full border border-gray-100 bg-gray-50 object-cover"><div><div id="compose-name" class="text-[15px] font-bold text-[#1f1f1f]">User</div></div></div><textarea id="compose-text" placeholder="What do you want to share today?" class="compose-textarea"></textarea><div id="media-preview-container" class="hidden media-preview-wrapper group"><div id="preview-inner" class="flex overflow-x-auto gap-2 p-2"></div><button onclick="removeMedia()" class="absolute top-2 right-2 bg-black/60 text-white rounded-full p-1.5 hover:bg-black/80 transition-colors shadow-sm z-10"><i data-lucide="x" class="w-4 h-4"></i></button></div><div id="collab-chips-container" class="flex flex-wrap mb-2"></div><div class="compose-tools"><div class="tool-group"><button onclick="openUploadOptions()" class="tool-btn" title="Upload Media"><i data-lucide="image" class="w-5 h-5"></i></button><button onclick="promptForImageLink()" class="tool-btn" title="Image Link"><i data-lucide="link" class="w-5 h-5"></i></button></div><button id="btn-publish" onclick="publishPost()" class="hidden md:block bg-[#0b57d0] text-white px-6 py-2 rounded-full font-bold text-[15px] hover:bg-[#0b57d0]/90 transition-all shadow-sm hover:shadow-md disabled:opacity-50 disabled:cursor-not-allowed">Post</button></div><div class="border-t border-gray-100 pt-3 mt-2"><div class="flex items-center justify-between cursor-pointer p-1" onclick="toggleComposeSettings()"><span class="text-xs font-bold text-gray-500 uppercase tracking-wider">Post Settings</span><i data-lucide="chevron-down" id="compose-settings-arrow" class="w-4 h-4 text-gray-400 transition-transform"></i></div><div id="compose-settings-area" class="hidden mt-3 space-y-3 px-1"><div class="flex items-center justify-between"><div class="flex items-center gap-2 text-sm text-gray-700"><i data-lucide="lock" class="w-4 h-4"></i> Private (Followers Only)</div><input type="checkbox" id="post-setting-privacy" class="accent-blue-600 w-4 h-4 cursor-pointer"></div><div class="flex items-center justify-between"><div class="flex items-center gap-2 text-sm text-gray-700"><i data-lucide="heart" class="w-4 h-4"></i> Show Like Count</div><input type="checkbox" id="post-setting-likes" class="accent-blue-600 w-4 h-4 cursor-pointer" checked></div><div class="flex items-center justify-between"><div class="flex items-center gap-2 text-sm text-gray-700"><i data-lucide="message-square" class="w-4 h-4"></i> Show Comment Count</div><input type="checkbox" id="post-setting-comments" class="accent-blue-600 w-4 h-4 cursor-pointer" checked></div><div class="flex items-center justify-between"><div class="flex items-center gap-2 text-sm text-gray-700"><i data-lucide="users" class="w-4 h-4"></i> Allow viewers to see who liked</div><input type="checkbox" id="post-setting-like-view" class="accent-blue-600 w-4 h-4 cursor-pointer" checked></div><div class="flex items-center justify-between"><div class="flex items-center gap-2 text-sm text-gray-700"><i data-lucide="message-circle" class="w-4 h-4"></i> Allow comments</div><input type="checkbox" id="post-setting-allow-comments" class="accent-blue-600 w-4 h-4 cursor-pointer" checked></div></div></div></div></div>
<aside id="main-sidebar" class="hidden md:flex app-panel"><div class="h-12 flex items-center gap-3 mb-6 px-2 cursor-pointer" onclick="switchView('feed')"><img src="https://i.imghippo.com/files/fRGt5603uII.png" class="w-8 h-8 object-contain"><h1 class="text-[20px] font-bold text-[#1f1f1f] hidden lg:block tracking-tight">EduLink</h1></div><button onclick="openCreateMenu()" class="create-btn hidden lg:flex"><i data-lucide="plus" class="w-5 h-5"></i><span>Create</span></button><nav class="flex-1 space-y-1" id="desktop-nav-items"><a href="#" onclick="switchView('feed');return false;" id="nav-feed" class="nav-item active"><i data-lucide="home" class="w-5 h-5"></i> <span class="hidden lg:block">Home</span></a><a href="#" onclick="switchView('explore');return false;" id="nav-explore" class="nav-item"><i data-lucide="compass" class="w-5 h-5"></i> <span class="hidden lg:block">Explore</span></a><a href="#" onclick="switchView('network');return false;" id="nav-network" class="nav-item"><i data-lucide="users" class="w-5 h-5"></i> <span class="hidden lg:block">Network</span></a><a href="#" onclick="switchView('notifications');return false;" id="nav-notifications" class="nav-item relative"><i data-lucide="bell" class="w-5 h-5"></i><span class="hidden lg:block">Notifications</span><span id="nav-notif-badge" class="nav-badge">0</span></a><a href="#" onclick="showProfile(auth.currentUser?auth.currentUser.uid:null);return false;" id="nav-profile" class="nav-item"><i data-lucide="user" class="w-5 h-5"></i> <span class="hidden lg:block">Profile</span></a></nav><div class="mt-auto pt-4 border-t border-gray-100 flex flex-col gap-2"><div class="sidebar-user group cursor-pointer" onclick="openSettings()"><div class="w-9 h-9 rounded-full bg-gray-100 flex items-center justify-center text-gray-600 hover:bg-gray-200 transition-colors"><i data-lucide="settings" class="w-5 h-5"></i></div><div class="hidden lg:block"><div class="text-sm font-bold text-[#1f1f1f]">Settings</div></div></div><div class="sidebar-user group" onclick="showProfile(auth.currentUser?auth.currentUser.uid:null)"><img id="sidebar-avatar" src="" class="w-9 h-9 rounded-full bg-gray-100 border border-gray-200 shrink-0 object-cover"><div class="hidden lg:block"><div id="sidebar-name" class="text-sm font-bold text-[#1f1f1f] group-hover:text-blue-700 transition-colors truncate w-[140px]">User</div><div class="text-xs text-[#667085]">View Profile</div></div></div></div></aside>
<div id="workspace-layout" class="flex-1 flex min-w-0 gap-4 relative overflow-hidden transition-all duration-300"><main id="main-panel" class="flex-1 app-panel min-w-0 relative"><header id="main-header" class="h-16 md:h-20 flex items-center justify-between px-4 md:px-6 shrink-0 z-20 absolute top-0 w-full bg-white/95 md:bg-white/90 backdrop-blur-md border-b border-[#f0f0f0] transition-transform duration-300"><div class="md:hidden flex items-center gap-3 cursor-pointer" onclick="switchView('feed')"><img src="https://i.imghippo.com/files/fRGt5603uII.png" class="w-8 h-8 object-contain"><h1 class="text-lg font-bold text-[#1f1f1f] tracking-tight">EduLink</h1></div><div class="flex-1 max-w-[600px] relative group hidden md:block"><i data-lucide="search" class="absolute left-5 top-3.5 w-5 h-5 text-[#667085] group-focus-within:text-[#0b57d0] transition-colors"></i><input type="text" placeholder="Search EduLink" id="global-search" oninput="handleSearch(this.value)" class="w-full bg-[#f3f4f6] rounded-full py-3.5 pl-14 pr-6 outline-none focus:bg-[#ffffff] focus:shadow-sm focus:ring-1 focus:ring-gray-200 transition-all text-[#1f1f1f] text-[15px]"></div><div class="flex items-center gap-3 pl-4"><button onclick="openSettings()" class="icon-btn hover:bg-gray-100 md:hidden"><i data-lucide="settings" class="w-6 h-6"></i></button><button class="icon-btn relative" onclick="toggleNotifications()"><i data-lucide="bell" class="w-6 h-6"></i></button><img id="header-avatar" src="" class="w-9 h-9 rounded-full bg-gray-100 border border-gray-200 cursor-pointer hover:ring-2 ring-offset-1 ring-blue-500 transition-all hidden md:block" onclick="showProfile(auth.currentUser?auth.currentUser.uid:null)"></div></header>
<div id="ptr-spinner"><i data-lucide="arrow-down" class="w-5 h-5"></i></div>
<div id="view-feed" class="flex-1 h-full overflow-y-auto no-scrollbar p-0 bg-white pt-16 md:pt-20"><div id="feed-container"></div><div class="flex flex-col items-center justify-center py-10 opacity-60"><img src="https://api.dicebear.com/9.x/lorelei/svg?seed=Chase" class="w-24 h-24 mb-4 opacity-80 grayscale hover:grayscale-0 transition-all duration-500"><h3 class="text-lg font-bold text-gray-400 google-font">Grow and Share</h3><p class="text-sm text-gray-400 text-center max-w-xs mt-1">Your network starts here. Share your first idea!</p></div></div>
<div id="view-saved" class="flex-1 h-full overflow-y-auto no-scrollbar p-0 md:p-6 hidden bg-[#f9fafb] md:bg-[#fff] pt-16 md:pt-6"><h2 class="text-2xl font-bold mb-6 px-4 md:px-0">Saved Posts</h2><div id="saved-container" class="space-y-4"></div></div>
<div id="view-network" class="flex-1 h-full overflow-y-auto no-scrollbar p-0 md:p-6 hidden bg-[#f9fafb] md:bg-[#fff] pt-16 md:pt-6"><h2 class="text-2xl font-bold mb-6 px-4 md:px-0">My Network</h2><div class="tab-group mb-4 mx-0 md:mx-0"><button onclick="switchNetworkTab('people')" id="net-tab-people" class="tab-btn active">People</button><button onclick="switchNetworkTab('posts')" id="net-tab-posts" class="tab-btn">Posts</button></div><div id="network-content"></div></div>
<div id="view-profile" class="flex-1 h-full overflow-y-auto no-scrollbar hidden bg-white"></div>
<div id="view-notifications" class="flex-1 h-full overflow-y-auto no-scrollbar p-0 md:p-6 hidden bg-white pt-[106px] md:pt-6"><div class="flex justify-between items-center mb-6 px-4 md:px-0 hidden md:flex"><h2 class="text-2xl font-bold">Notifications</h2><button onclick="clearAllNotifications()" class="text-xs text-red-500 font-bold hover:underline">Clear All</button></div><div class="tab-group mb-4 mx-0 md:mx-0 hidden md:flex"><button onclick="switchNotifTab('all')" id="ntab-all" class="tab-btn active"><i data-lucide="bell" class="w-4 h-4"></i> All</button><button onclick="switchNotifTab('official')" id="ntab-official" class="tab-btn"><i data-lucide="megaphone" class="w-4 h-4"></i> Official</button></div><div id="notification-list" class="flex flex-col w-full pb-24 md:pb-0"></div></div>
<div id="view-announcements" class="flex-1 h-full overflow-y-auto p-0 md:p-6 hidden bg-white pt-16 md:pt-6"><h2 class="text-2xl font-bold mb-6 px-4 md:px-0">Broadcast Announcement</h2><div class="p-6 bg-white rounded-xl border border-gray-200 shadow-sm max-w-2xl mb-8"><label class="block text-sm font-bold text-gray-700 mb-2">Message to All Users</label><textarea id="announcement-text" class="w-full h-32 border border-gray-300 rounded-lg p-3 outline-none focus:border-blue-500 mb-4" placeholder="Type your official announcement here..."></textarea><div class="flex items-center justify-between"><button id="send-announcement-btn" onclick="sendAnnouncement()" class="bg-blue-600 text-white px-6 py-2 rounded-lg font-bold hover:bg-blue-700 transition-colors">Send Broadcast</button></div></div></div>
<div id="view-events" class="flex-1 h-full overflow-y-auto p-0 md:p-6 hidden bg-[#f9fafb] md:bg-[#fff] pt-16 md:pt-6"><div class="flex items-center justify-between mb-6 px-4 md:px-0"><h2 class="text-2xl font-bold text-[#1f1f1f]">Upcoming Events</h2><button onclick="openEventComposer()" class="bg-[#0b57d0] text-white px-4 py-2 rounded-lg text-sm font-bold flex items-center gap-2"><i data-lucide="plus" class="w-4 h-4"></i> New Event</button></div><div id="events-list" class="grid grid-cols-1 gap-4 px-4 md:px-0"></div></div>
<div id="view-explore" class="flex-1 h-full overflow-y-auto no-scrollbar p-0 md:pt-20 hidden bg-white"><div id="explore-header-container" class="sticky top-0 bg-white z-20 border-b border-gray-100 md:hidden"><div class="h-14 flex items-center px-4 shrink-0"><div class="relative bg-gray-100 rounded-xl flex items-center px-3 py-2 w-full"><i data-lucide="search" class="w-4 h-4 text-gray-400 mr-2"></i><input type="text" id="mobile-explore-search" class="bg-transparent border-none outline-none text-sm w-full" placeholder="Search..." oninput="handleSearch(this.value)"></div></div><div class="tab-group"><button id="tab-explore-main" onclick="switchExploreMainTab('explore')" class="tab-btn active"><i data-lucide="grid" class="w-5 h-5"></i></button><button id="tab-explore-video" onclick="switchExploreMainTab('video')" class="tab-btn"><i data-lucide="play-circle" class="w-5 h-5"></i></button><button id="tab-explore-people" onclick="switchExploreMainTab('people')" class="tab-btn"><i data-lucide="users" class="w-5 h-5"></i></button><button id="tab-explore-tags" onclick="switchExploreMainTab('tags')" class="tab-btn"><i data-lucide="hash" class="w-5 h-5"></i></button></div></div><div class="hidden md:block w-full bg-white z-10 border-b border-gray-100"><div class="max-w-5xl mx-auto tab-group border-b-0 px-0 justify-center"><button id="tab-explore-main-d" onclick="switchExploreMainTab('explore')" class="tab-btn active max-w-[120px]"><i data-lucide="grid" class="w-4 h-4"></i> Posts</button><button id="tab-explore-video-d" onclick="switchExploreMainTab('video')" class="tab-btn max-w-[120px]"><i data-lucide="play-circle" class="w-4 h-4"></i> Videos</button><button id="tab-explore-people-d" onclick="switchExploreMainTab('people')" class="tab-btn max-w-[120px]"><i data-lucide="users" class="w-4 h-4"></i> People</button><button id="tab-explore-tags-d" onclick="switchExploreMainTab('tags')" class="tab-btn max-w-[120px]"><i data-lucide="hash" class="w-4 h-4"></i> Tags</button></div></div><div id="explore-content-wrapper" class="pb-32 max-w-5xl mx-auto py-6"><div id="explore-people-results" class="hidden flex-col p-4 pt-0"></div><div id="explore-results" class="space-y-0 pt-0"></div></div></div></main><aside id="trending-panel" class="trending-panel hidden xl:flex app-panel mb-16 md:mb-0 flex-col bg-white"><div class="h-16 md:h-20 shrink-0 border-b border-[#f0f0f0] flex items-center justify-between px-6 bg-white/95 backdrop-blur z-20"><div class="flex items-center gap-3"><span class="text-[19px] font-bold text-[#1f1f1f] google-font">People</span></div></div><div class="flex-1 overflow-y-auto p-5"><div class="mb-8"><h3 class="text-lg font-bold text-[#1f1f1f] mb-4">Who to follow</h3><div id="who-to-follow-list" class="flex flex-col gap-4"></div></div><div id="promo-section" class="hidden"><div class="relative group rounded-xl overflow-hidden cursor-pointer"><a id="promo-link" href="#" target="_blank" class="block w-full h-full"><img id="promo-image" src="" class="w-full h-auto object-cover rounded-xl border border-gray-200 hover:opacity-95 transition-opacity"></a><button id="edit-promo-btn" onclick="openPromoModal(event)" class="absolute top-2 right-2 bg-black/60 text-white p-2 rounded-full opacity-0 group-hover:opacity-100 transition-opacity hover:bg-black/80 hidden z-20"><i data-lucide="edit-2" class="w-4 h-4"></i></button><div class="absolute bottom-2 left-2 bg-black/60 text-white text-[10px] px-2 py-0.5 rounded-md font-medium uppercase tracking-wide backdrop-blur-sm pointer-events-none">Promoted</div></div></div></div></aside></div>
<nav id="mobile-bottom-nav" class="md:hidden fixed bottom-0 left-0 w-full bg-white border-t border-[#eaecf0] h-[64px] flex items-center justify-around z-50 pb-[env(safe-area-inset-bottom)] px-2 shadow-lg transition-transform duration-300"><div class="mobile-nav-item active" onclick="switchView('feed')"><i data-lucide="home"></i></div><div class="mobile-nav-item" onclick="switchView('explore')"><i data-lucide="compass"></i></div><div class="mobile-nav-item" onclick="openCreateMenu()"><i data-lucide="plus-square"></i></div><div class="mobile-nav-item" onclick="switchView('notifications')"><div class="relative"><i data-lucide="bell"></i><span id="mobile-footer-badge" class="mobile-footer-badge">0</span></div></div><div class="mobile-nav-item" onclick="showProfile(auth.currentUser?auth.currentUser.uid:null)"><img id="mobile-avatar" src="" class="w-6 h-6 rounded-full border border-gray-200"></div></nav>
<input type="file" id="media-input" class="hidden" accept="image/*,video/*" onchange="handleFileSelect(event)">
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";
import { getFirestore, collection, doc, getDoc, setDoc, updateDoc, deleteDoc, arrayUnion, arrayRemove, addDoc, onSnapshot, query, orderBy, where, serverTimestamp, getDocs, writeBatch } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";
import { getStorage, ref, uploadString, getDownloadURL, uploadBytes } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-storage.js";
const firebaseConfig = { apiKey:"AIzaSyAJH79UQl0rc96Qug0DKLevO4ZI_sn8Kno", authDomain:"edulinki.firebaseapp.com", projectId:"edulinki", storageBucket:"edulinki.firebasestorage.app", messagingSenderId:"248886466474", appId:"1:248886466474:web:160043201a6b28bafbbdd3", measurementId:"G-MQBH12VL7N" };
const app=initializeApp(firebaseConfig); const auth=getAuth(app); const db=getFirestore(app); const storage=getStorage(app); window.auth=auth; window.db=db;
let currentUser=null, users=[], posts=[], notifications=[], savedPosts=[], activeNotifTab='all', activeNetworkTab='people';
window.replyingToCommentId=null; window.currentViewingProfileId=null; window.activeExploreTab='explore'; window.activeExploreCategory='For You'; window.currentProfileTab='posts';
window.currentMedia=[]; window.uploadMode='single'; window.currentMediaType=null; window.isWebSearchActive=false;
let stopGeneration=false, abortController=null; window.isPlusMenuOpen=false; window.currentEventCover=null; window.editingPostId=null; window.threadParentCommentId=null; window.threadPostId=null;
let currentEventCoverBlob=null, currentAvatarBlob=null, currentBannerBlob=null; window.currentPromoBlob=null;
window.notifSelectionMode=false; window.selectedNotifs=new Set(); window.notifSearchTerm=''; window.selectedCollaborators=[];
window.currentSharePid=null;
let lastScrollTop=0; const feedView=document.getElementById('view-feed');

/* Helper function for Swipe Logic */
function setupSwipeClose(modalId, overlayId, closeFunc) {
    let startY = 0;
    const modal = document.getElementById(modalId);
    if (!modal) return;
    
    modal.addEventListener('touchstart', e => {
        if(document.getElementById(overlayId).classList.contains('hidden')) return;
        // Check if we are at the top of scroll content
        const content = modal.querySelector('.overflow-y-auto');
        if(content && content.scrollTop > 0) return;
        
        startY = e.touches[0].clientY;
    }, {passive: true});

    modal.addEventListener('touchmove', e => {
        if(document.getElementById(overlayId).classList.contains('hidden') || startY === 0) return;
        const content = modal.querySelector('.overflow-y-auto');
        if(content && content.scrollTop > 0) return;

        const diff = e.touches[0].clientY - startY;
        if (diff > 0) {
            e.preventDefault(); // Prevent scrolling the body/background
            modal.style.transform = `translateY(${diff}px)`;
        }
    }, {passive: false});

    modal.addEventListener('touchend', e => {
        if(document.getElementById(overlayId).classList.contains('hidden') || startY === 0) return;
        const diff = e.changedTouches[0].clientY - startY;
        const content = modal.querySelector('.overflow-y-auto');
        if(content && content.scrollTop > 0) { startY = 0; return; }

        if (diff > 100) {
            closeFunc();
            setTimeout(() => modal.style.transform = '', 300);
        } else {
            modal.style.transform = '';
        }
        startY = 0;
    }, {passive: true});
}

// Setup Swipes
setupSwipeClose('share-modal', 'share-overlay', closeShareMenu);
setupSwipeClose('edit-profile-modal', 'edit-profile-overlay', closeEditProfile);
setupSwipeClose('likes-modal', 'likes-overlay', closeLikes);

/* PTR Logic */
const ptrSpinner = document.getElementById('ptr-spinner');
let ptrStartY = 0, ptrDist = 0, isPtr = false, isRefreshing = false;
feedView.addEventListener('touchstart', e => {
    if (feedView.scrollTop === 0 && !isRefreshing) {
        ptrStartY = e.touches[0].pageY;
        isPtr = true;
        ptrSpinner.style.transition = 'none';
    }
}, {passive: true});
feedView.addEventListener('touchmove', e => {
    if (!isPtr || isRefreshing) return;
    const y = e.touches[0].pageY;
    const diff = y - ptrStartY;
    if (diff > 0 && feedView.scrollTop === 0) {
        if (e.cancelable) e.preventDefault();
        ptrDist = diff;
        const ty = Math.min(diff * 0.4, 80); 
        ptrSpinner.style.transform = `translateX(-50%) translateY(${ty}px) rotate(${ty*3}deg)`;
        ptrSpinner.style.opacity = Math.min(ty/40, 1);
    } else {
        isPtr = false;
        ptrSpinner.style.opacity = '0';
        ptrSpinner.style.transform = `translateX(-50%) translateY(-20px)`;
    }
}, {passive: false});
feedView.addEventListener('touchend', async () => {
    if (!isPtr || isRefreshing) return;
    isPtr = false;
    ptrSpinner.style.transition = 'all 0.3s cubic-bezier(0.2,0,0,1)';
    if (ptrDist > 100) {
        isRefreshing = true;
        ptrSpinner.style.transform = `translateX(-50%) translateY(50px)`;
        ptrSpinner.style.opacity = '1';
        ptrSpinner.innerHTML = '<i data-lucide="loader-2" class="animate-spin w-5 h-5 text-blue-600"></i>';
        refreshIcons();
        await new Promise(r => setTimeout(r, 1000));
        renderFeed();
        showToast("Feed updated");
        isRefreshing = false;
        ptrSpinner.style.transform = `translateX(-50%) translateY(-20px)`;
        ptrSpinner.style.opacity = '0';
        setTimeout(() => {
            ptrSpinner.innerHTML = '<i data-lucide="arrow-down" class="w-5 h-5 text-blue-600"></i>';
            refreshIcons();
        }, 300);
    } else {
        ptrSpinner.style.transform = `translateX(-50%) translateY(-20px)`;
        ptrSpinner.style.opacity = '0';
    }
    ptrDist = 0;
});
if(feedView) feedView.addEventListener('scroll',()=>{const c=feedView.scrollTop; const h=document.getElementById('main-header'); if(c>lastScrollTop&&c>60) h.style.transform='translateY(-100%)'; else h.style.transform='translateY(0)'; lastScrollTop=c<=0?0:c;},{passive:true});
let lastExploreScrollTop=0; const exploreView=document.getElementById('view-explore');
if(exploreView) exploreView.addEventListener('scroll', ()=>{const c=exploreView.scrollTop; const h=document.getElementById('explore-header-container'); if(c>lastExploreScrollTop&&c>60) h.style.transform='translateY(-100%)'; else h.style.transform='translateY(0)'; lastExploreScrollTop=c<=0?0:c;}, {passive:true});
function refreshIcons(){ if(window.lucide) window.lucide.createIcons(); }
function formatDate(t){ if(!t) return ''; let d; if(t.toDate) d=t.toDate(); else if(typeof t==='number'||t instanceof Date) d=new Date(t); else return ''; const n=new Date(), s=Math.floor((n-d)/1000); if(s<60) return 'Just now'; if(s<3600) return Math.floor(s/60)+'m ago'; if(s<86400) return Math.floor(s/3600)+'h ago'; if(s<604800) return Math.floor(s/86400)+'d ago'; return d.toLocaleDateString(); }
function formatContent(t){ if(!t) return ''; 
    let h=t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"); 
    h=h.replace(/@(\w+)/g,(m,u)=>{ const f=users.find(x=>(x.username||'').toLowerCase()===u.toLowerCase()); return f?`<span class="text-blue-600 font-bold cursor-pointer hover:underline" onclick="event.stopPropagation(); showProfile('${f.id}')">@${u}</span>`:`<span class="text-blue-600 font-bold">@${u}</span>`; });
    h=h.replace(/#(\w+)/g, '<span class="text-blue-600 font-bold cursor-pointer hover:underline" onclick="event.stopPropagation(); searchTag(\'$1\')">#$1</span>');
    return h.replace(/\n/g,'<br>'); 
}
window.searchTag=t=>{ switchView('explore'); document.getElementById('mobile-explore-search').value = `#${t}`; document.getElementById('global-search').value = `#${t}`; handleSearch(`#${t}`); };
onAuthStateChanged(auth,async(u)=>{ const l=document.getElementById('app-loader'); if(u){ const r=doc(db,"users",u.uid), s=await getDoc(r); let off=u.email==='edulinkbht@gmail.com'; if(s.exists()){ currentUser={id:u.uid,...s.data()}; if(off&&!currentUser.isOfficial){ await updateDoc(r,{isOfficial:true}); currentUser.isOfficial=true; } } else { currentUser={id:u.uid,name:u.displayName||u.email.split('@')[0],email:u.email,avatar:u.photoURL||`https://api.dicebear.com/9.x/lorelei/svg?seed=${u.uid}`,bio:"New EduLink Member",following:[],followers:[],friends:[],saved:[],links:[],isOfficial:off,settings:{privateNetwork:false},username:""}; await setDoc(r,currentUser); } currentUser.following=currentUser.following||[]; currentUser.followers=currentUser.followers||[]; currentUser.friends=currentUser.friends||[]; currentUser.saved=currentUser.saved||[]; currentUser.links=currentUser.links||[]; currentUser.settings=currentUser.settings||{privateNetwork:false}; window.currentUser=currentUser; savedPosts=currentUser.saved; if(!currentUser.username) document.getElementById('username-modal').classList.remove('hidden'); updateUserInterface(); initRealtimeListeners(); refreshIcons(); initBannerDrag(); if(l) l.style.opacity='0'; setTimeout(()=>{if(l)l.remove();},500); const p=new URLSearchParams(window.location.search).get('postId'); if(p) setTimeout(()=>{openPostView(p); window.history.pushState({},document.title,window.location.pathname);},1000); } else window.location.href='index.html'; });
window.saveUsername=async()=>{ const v=document.getElementById('new-username-input').value.trim().toLowerCase(); if(v.length<3||/\s/.test(v)||!/^[a-z0-9_.]+$/.test(v)) return showToast("Invalid username",true); const q=query(collection(db,"users"),where("username","==",v)), s=await getDocs(q); if(!s.empty) return showToast("Taken",true); await updateDoc(doc(db,"users",currentUser.id),{username:v}); currentUser.username=v; document.getElementById('username-modal').classList.add('hidden'); showToast("Username set!"); };
function initRealtimeListeners(){ onSnapshot(collection(db,"users"),s=>{ users=s.docs.map(d=>({id:d.id,...d.data()})); if(!document.getElementById('view-network').classList.contains('hidden')) renderNetwork(); if(window.currentViewingProfileId) showProfile(window.currentViewingProfileId,window.currentProfileTab); renderRightSidebar(); refreshIcons(); }); onSnapshot(doc(db,"global","promo"),s=>{ if(s.exists()){ const d=s.data(), sec=document.getElementById('promo-section'); if(d.imageUrl){ sec.classList.remove('hidden'); document.getElementById('promo-image').src=d.imageUrl; document.getElementById('promo-link').href=d.linkUrl||'#'; } else if(currentUser&&currentUser.email!=='edulinkbht@gmail.com') sec.classList.add('hidden'); } }); const qP=query(collection(db,"posts"),orderBy("timestamp","desc")); onSnapshot(qP,{includeMetadataChanges:true},s=>{ posts=s.docs.map(d=>({id:d.id,...d.data(),timestamp:d.data().timestamp})); if(s.metadata.hasPendingWrites) return; const ch=s.docChanges(); let full=document.getElementById('feed-container').children.length===0; if(!full) ch.forEach(c=>{ if(c.type!=="modified") full=true; else { const p=c.doc.data(), id=c.doc.id; const l=document.getElementById(`like-count-${id}`), cm=document.getElementById(`comment-count-${id}`); if(l) l.innerText=p.likes?p.likes.length:0; if(cm) cm.innerText=p.comments?p.comments.length:0; } }); if(!document.getElementById('view-feed').classList.contains('hidden')&&full) renderFeed(); if(!document.getElementById('view-saved').classList.contains('hidden')) renderSaved(); if(!document.getElementById('view-network').classList.contains('hidden')&&activeNetworkTab==='posts') renderNetwork(); if(!document.getElementById('view-explore').classList.contains('hidden')) handleSearch(document.getElementById('global-search').value||document.getElementById('mobile-explore-search').value); if(window.currentViewingPostId){ const cp=posts.find(p=>p.id===window.currentViewingPostId); if(cp){ renderCommentsInModal(window.currentViewingPostId); updatePostViewStats(window.currentViewingPostId); } } if(window.threadPostId) renderThreadContent(window.threadPostId,window.threadParentCommentId); renderRightSidebar(); setTimeout(refreshIcons,50); }); const qN=query(collection(db,"notifications"),where("receiverId","==",currentUser.id)); onSnapshot(qN,s=>{ notifications=s.docs.map(d=>({id:d.id,...d.data(),timestamp:d.data().timestamp})).sort((a,b)=>(b.timestamp?.toDate?b.timestamp.toDate():0)-(a.timestamp?.toDate?a.timestamp.toDate():0)); const u=notifications.filter(n=>!n.read).length, t=u>99?'99+':u, d=document.getElementById('nav-notif-badge'), m=document.getElementById('mobile-footer-badge'); if(d){ d.style.display=u>0?'flex':'none'; d.innerText=t; } if(m){ m.style.display=u>0?'flex':'none'; m.innerText=t; } if(!document.getElementById('view-notifications').classList.contains('hidden')) renderNotifications(); refreshIcons(); }); }
window.renderRightSidebar=()=>{ const l=document.getElementById('who-to-follow-list'); if(!l||!currentUser) return; l.innerHTML=''; const c=users.filter(u=>u.id!==currentUser.id&&u.name&&u.name!=='undefined').sort(()=>0.5-Math.random()).slice(0,3); if(c.length===0) l.innerHTML='<div class="text-sm text-gray-400 p-2">No suggestions.</div>'; else c.forEach(u=>{ const d=document.createElement('div'); d.className="flex items-center justify-between"; d.onclick=()=>showProfile(u.id); d.innerHTML=`<div class="flex items-center gap-3 overflow-hidden"><img src="${u.avatar}" class="w-10 h-10 rounded-full bg-gray-200 object-cover shrink-0"><div class="min-w-0"><div class="font-bold text-sm text-gray-900 truncate hover:underline cursor-pointer">${u.name}</div><div class="text-xs text-gray-500 truncate">@${u.username||'user'}</div></div></div><button onclick="event.stopPropagation(); toggleFollow('${u.id}')" class="bg-black text-white text-xs px-3 py-1.5 rounded-full font-bold hover:bg-gray-800 transition-colors">Follow</button>`; l.appendChild(d); }); };
window.openPromoModal=e=>{ if(e){e.stopPropagation();e.preventDefault();} document.getElementById('promo-modal').classList.remove('hidden'); const i=document.getElementById('promo-image'), l=document.getElementById('promo-link'); if(i.src) document.getElementById('promo-img-url').value=i.src; if(l.href) document.getElementById('promo-target-url').value=l.href; };
window.handlePromoFile=e=>{ const f=e.target.files[0]; if(f){ window.currentPromoBlob=f; showToast("Image selected"); } };
window.savePromo=async()=>{ const b=event.target, ot=b.innerText; b.innerText="Saving..."; b.disabled=true; let i=document.getElementById('promo-img-url').value.trim(); const l=document.getElementById('promo-target-url').value.trim(); if(window.currentPromoBlob) try{ i=await uploadToImgHippo(window.currentPromoBlob); }catch(e){ return showToast("Upload failed"); } if(!i){ showToast("Image URL required"); b.innerText=ot; b.disabled=false; return; } await setDoc(doc(db,"global","promo"),{imageUrl:i,linkUrl:l}); showToast("Promo updated!"); document.getElementById('promo-modal').classList.add('hidden'); window.currentPromoBlob=null; b.innerText=ot; b.disabled=false; };
window.updatePostViewStats=pid=>{ const p=posts.find(x=>x.id===pid); if(!p) return; const dl=document.getElementById('post-view-likes-count'), ml=document.getElementById('mobile-like-count'), rl=document.getElementById('reel-like-count'), rc=document.getElementById('reel-comment-count'), rli=document.getElementById('reel-like-icon'), rsi=document.getElementById('reel-save-icon'); if(dl) dl.innerText=`${p.likes?p.likes.length:0} likes`; if(ml){ ml.innerText=`${p.likes?p.likes.length:0} likes`; ml.style.display=(p.settings?.showLikes!==false)?'block':'none'; } if(rl) rl.innerText=p.likes?p.likes.length:0; if(rc) rc.innerText=p.comments?p.comments.length:0; if(rli){ if(p.likes&&p.likes.includes(currentUser.id)) rli.classList.add('fill-red-500','text-red-500'), rli.classList.remove('text-white'); else rsi.classList.remove('fill-red-500','text-red-500'), rli.classList.add('text-white'); } if(rsi){ if(savedPosts.includes(pid)) rsi.classList.add('fill-yellow-500','text-yellow-500','text-yellow-500'); else rsi.classList.remove('fill-yellow-500','text-yellow-500','text-yellow-500'), rsi.classList.add('text-white'); } };
function updateUserInterface(){ if(!currentUser) return; const u=currentUser; document.getElementById('sidebar-name').innerText=u.name; document.getElementById('sidebar-avatar').src=u.avatar; document.getElementById('mobile-avatar').src=u.avatar; document.getElementById('header-avatar').src=u.avatar; document.getElementById('compose-name').innerText=u.name; document.getElementById('compose-avatar').src=u.avatar; document.getElementById('edit-name').value=u.name; document.getElementById('edit-bio').value=u.bio; document.getElementById('edit-avatar-preview').src=u.avatar; const bp=u.bannerPos||50, bu=u.banner||'https://images.unsplash.com/photo-1579546929518-9e396f3cc809?ixlib=rb-1.2.1&auto=format&fit=crop&w=1000&q=80'; document.getElementById('edit-banner-preview').src=bu; document.getElementById('edit-banner-preview').style.objectPosition=`center ${currentBannerPos}%`; document.getElementById('banner-pos-hint').innerText=`${currentBannerPos}%`; const tp=document.getElementById('toggle-privacy'); if(tp) u.settings?.privateNetwork?tp.classList.add('active'):tp.classList.remove('active'); if(u.email==='edulinkbht@gmail.com'){ const nav=document.querySelector('#desktop-nav-items'); if(!document.getElementById('nav-announcements')){ const a=document.createElement('a'); a.href="#"; a.id="nav-announcements"; a.className="nav-item text-blue-600"; a.innerHTML=`<i data-lucide="megaphone" class="w-5 h-5"></i> <span class="hidden lg:block">Announcements</span>`; a.onclick=()=>{switchView('announcements');return false;}; nav.appendChild(a); } document.getElementById('edit-promo-btn').classList.remove('hidden'); document.getElementById('promo-section').classList.remove('hidden'); document.getElementById('create-option-ad').classList.remove('hidden'); } else document.getElementById('create-option-ad').classList.add('hidden'); refreshIcons(); }
let alertCallback=null; window.showAlert=(m,cb)=>{ document.getElementById('alert-msg').innerText=m; const a=document.getElementById('custom-alert'); a.classList.remove('hidden'); setTimeout(()=>{a.classList.remove('opacity-0'); document.getElementById('custom-alert-box').classList.remove('scale-95');},10); alertCallback=cb; const b=document.getElementById('alert-confirm-btn'), nb=b.cloneNode(true); b.parentNode.replaceChild(nb,b); nb.onclick=()=>{if(alertCallback)alertCallback();closeAlert(true);}; };
window.closeAlert=()=>{ const a=document.getElementById('custom-alert'); a.classList.add('opacity-0'); document.getElementById('custom-alert-box').classList.add('scale-95'); setTimeout(()=>a.classList.add('hidden'),200); };
let isDraggingBanner=false, startY=0, initialBannerPos=50, currentBannerPos=50;
function initBannerDrag(){ const c=document.getElementById('banner-edit-area'); c.addEventListener('mousedown',sd); c.addEventListener('touchstart',sd,{passive:false}); window.addEventListener('mousemove',dg); window.addEventListener('touchmove',dg,{passive:false}); window.addEventListener('mouseup',ed); window.addEventListener('touchend',ed); }
function sd(e){ if(e.target.closest('#banner-edit-area')){ isDraggingBanner=true; startY=e.type.includes('mouse')?e.clientY:e.touches[0].clientY; initialBannerPos=currentBannerPos; } }
function dg(e){ if(!isDraggingBanner) return; if(e.cancelable) e.preventDefault(); const y=e.type.includes('mouse')?e.clientY:e.touches[0].clientY, d=startY-y, p=initialBannerPos+(d/2); currentBannerPos=Math.round(Math.max(0,Math.min(100,p))); document.getElementById('edit-banner-preview').style.objectPosition=`center ${currentBannerPos}%`; document.getElementById('banner-pos-hint').innerText=`${currentBannerPos}%`; }
function ed(){ isDraggingBanner=false; }
window.openSettings=()=>document.getElementById('settings-overlay').classList.remove('hidden'); window.closeSettings=()=>document.getElementById('settings-overlay').classList.add('hidden');
window.togglePrivacy=async()=>{ const t=document.getElementById('toggle-privacy'), p=!t.classList.contains('active'); t.classList.toggle('active'); const s=currentUser.settings||{}; s.privateNetwork=p; await updateDoc(doc(db,"users",currentUser.id),{settings:s}); currentUser.settings=s; showToast(`Account is ${p?'Private':'Public'}`); };
window.switchView=async v=>{
    ['feed','events','saved','network','profile','explore','notifications','announcements'].forEach(n=>{const e=document.getElementById(`view-${n}`);if(e)e.classList.add('hidden');});
    const tp=document.getElementById('trending-panel'), mh=document.getElementById('main-header'), mbn=document.getElementById('mobile-bottom-nav'), mnh=document.getElementById('mobile-notifications-header'), meh=document.getElementById('mobile-explore-header');
    if(mh){mh.classList.remove('hidden');mh.style.transform='translateY(0)';}
    if(mbn)mbn.classList.remove('hidden');
    if(mnh)mnh.classList.add('hidden','flex');
    if(v==='profile'&&mh) mh.classList.add('hidden');
    if(window.innerWidth<768){
        if(v==='notifications'){if(mh)mh.classList.add('hidden');if(mnh)mnh.classList.remove('hidden'),mnh.classList.add('flex');}
        else if(v==='explore'){if(mh)mh.classList.add('hidden');}
    }
    if(window.innerWidth>=1280) tp.classList.remove('hidden'),tp.classList.add('xl:flex');
    if(v!=='ai') document.getElementById(`view-${v}`)?.classList.remove('hidden');
    document.querySelectorAll('.nav-item,.mobile-nav-item').forEach(e=>e.classList.remove('active'));
    const nav=document.getElementById(`nav-${v}`), mnav=document.querySelectorAll('.mobile-nav-item');
    if(nav) nav.classList.add('active');
    if(v==='feed'){mnav[0]?.classList.add('active');if(document.getElementById('feed-container').children.length===0)renderFeed();}
    else if(v==='explore'){mnav[1]?.classList.add('active');switchExploreMainTab('explore');}
    else if(v==='network'){if(nav)nav.classList.add('active');if(document.getElementById('network-content').children.length===0)renderNetwork();}
    else if(v==='notifications'){
        if(nav)nav.classList.add('active');
        mnav[3]?.classList.add('active');
        renderNotifications();
        // Mark as read
        const unread = notifications.filter(n=>!n.read);
        if(unread.length > 0) {
           const batch = writeBatch(db);
           unread.forEach(n => {
               const ref = doc(db, "notifications", n.id);
               batch.update(ref, {read: true});
           });
           await batch.commit();
        }
    }
    else if(v==='saved'){if(nav)nav.classList.add('active');if(document.getElementById('saved-container').children.length===0)renderSaved();}
    setTimeout(()=>refreshIcons(),10);
};
window.switchNetworkTab=t=>{ activeNetworkTab=t; document.querySelectorAll('.tab-btn').forEach(b=>b.classList.remove('active')); document.getElementById(`net-tab-${t}`)?.classList.add('active'); renderNetwork(); };
window.renderNetwork=()=>{ const c=document.getElementById('network-content'); c.innerHTML=""; if(activeNetworkTab==='people'){ const g=document.createElement('div'); g.className="grid grid-cols-1 md:grid-cols-2 gap-4 px-4 md:px-0"; const f=users.filter(u=>currentUser.following.includes(u.id)); if(!f.length) c.innerHTML='<div class="flex flex-col items-center justify-center py-10 opacity-60"><p>You aren\'t following anyone yet.</p></div>'; else { f.forEach(u=>{ const d=document.createElement('div'); d.className="bg-white p-4 rounded-xl border border-gray-100 flex items-center gap-4 hover:shadow-md transition-all cursor-pointer"; d.onclick=()=>showProfile(u.id); d.innerHTML=`<img src="${u.avatar}" class="w-12 h-12 rounded-full border border-gray-100 bg-gray-50 object-cover"><div><h4 class="font-bold text-gray-900">${u.name} ${u.isOfficial?'<i data-lucide="badge-check" class="w-4 h-4 inline text-blue-500"></i>':''}</h4><p class="text-xs text-gray-500 line-clamp-1">${u.bio}</p></div><button onclick="event.stopPropagation(); toggleFollow('${u.id}')" class="ml-auto text-xs border border-gray-200 px-3 py-1 rounded-full hover:bg-gray-50">Unfollow</button>`; g.appendChild(d); }); c.appendChild(g); } } else { const fp=posts.filter(p=>currentUser.following.includes(p.authorId)); if(!fp.length) c.innerHTML='<div class="text-center py-10 text-gray-400">No posts.</div>'; else { const pc=document.createElement('div'); pc.className="space-y-4 px-4 md:px-0"; fp.forEach(p=>pc.appendChild(createPostElement(p))); c.appendChild(pc); } } refreshIcons(); };
window.renderFeed=(ft="")=>{ const c=document.getElementById('feed-container'); c.innerHTML=""; let dp=[...posts]; if(ft) dp=dp.filter(p=>p.content.toLowerCase().includes(ft.toLowerCase())); dp=dp.filter(p=>{ const a=users.find(u=>u.id===p.authorId), pub=!p.settings||p.settings.privacy==='public', priv=a?.settings?.privateNetwork, fol=currentUser.following.includes(p.authorId); return p.authorId===currentUser.id || (priv?fol:(pub||fol)); }); dp.forEach(p=>c.appendChild(createPostElement(p))); refreshIcons(); };
let touchStartX=0, touchEndX=0;
window.handleTouchStart=(e)=>{ touchStartX=e.changedTouches[0].screenX; };
window.handleTouchEnd=(e,pid,ov)=>{ touchEndX=e.changedTouches[0].screenX; if(touchStartX-touchEndX>50) moveCarousel(pid,1,ov); if(touchEndX-touchStartX>50) moveCarousel(pid,-1,ov); };
function createPostElement(p){
    const a=users.find(u=>u.id===p.authorId)||{name:'Unknown',avatar:'',isOfficial:false,id:p.authorId}, liked=p.likes?.includes(currentUser.id), saved=savedPosts.includes(p.id), st=p.settings||{privacy:'public',showLikes:true,showComments:true};
    const d=document.createElement('article');
    d.className="post-card group overflow-hidden fade-in";
    d.onclick=()=>openPostView(p.id);
    let mh="";
    if(p.media){
        const ma=Array.isArray(p.media)?p.media:[p.media];
        if(ma.length===1){
            const s=ma[0], iv=s.startsWith('data:video')||s.includes('.mp4');
            mh=iv?`<div class="mt-3 rounded-xl overflow-hidden aspect-[4/5] bg-black flex items-center justify-center"><video src="${s}" class="w-full h-full object-cover" controls onclick="event.stopPropagation()"></video></div>`:`<div class="mt-3 rounded-xl overflow-hidden cursor-pointer aspect-[4/5] bg-gray-100" onclick="event.stopPropagation(); openLightbox('${s}','image')"><img src="${s}" class="w-full h-full object-cover"></div>`;
        } else {
            let sl='', dt='';
            ma.forEach((s,i)=>{
                const iv=s.startsWith('data:video')||s.includes('.mp4');
                sl+=`<div class="post-carousel-item">${iv?`<video src="${s}" controls></video>`:`<img src="${s}">`}</div>`;
                dt+=`<div class="carousel-dot ${i===0?'active':''}" id="dot-${p.id}-${i}"></div>`;
            });
            // Update: Dots moved OUTSIDE, Swipe enabled
            mh=`<div class="carousel-wrapper"><div class="mt-3 rounded-xl overflow-hidden post-carousel touch-pan-y" id="carousel-${p.id}" ontouchstart="handleTouchStart(event)" ontouchend="handleTouchEnd(event,'${p.id}',false)"><div class="post-carousel-inner" id="inner-${p.id}">${sl}</div><button class="carousel-nav-btn prev" onclick="event.stopPropagation();moveCarousel('${p.id}',-1)"><i data-lucide="chevron-left" class="w-4 h-4"></i></button><button class="carousel-nav-btn next" onclick="event.stopPropagation();moveCarousel('${p.id}',1)"><i data-lucide="chevron-right" class="w-4 h-4"></i></button><div class="absolute top-3 right-3 bg-black/50 text-white text-xs px-2 py-1 rounded-full backdrop-blur-sm pointer-events-none"><span id="counter-${p.id}">1</span>/${ma.length}</div></div><div class="carousel-dots-outside">${dt}</div></div>`;
            if(!window.carouselStates) window.carouselStates={};
            window.carouselStates[p.id]={index:0,total:ma.length};
        }
    }
    let lh='';
    if(p.likes?.length>0&&currentUser.following){
        const f=p.likes.filter(id=>currentUser.following.includes(id));
        if(f.length){
            const ff=users.find(u=>u.id===f[0]);
            if(ff) lh=`<div class="flex items-center mt-3 ml-1"><img src="${ff.avatar}" class="w-5 h-5 rounded-full border border-white -mr-1 z-10"><span class="text-[11px] text-gray-500 ml-2">Liked by <span class="font-bold text-gray-900">${ff.name}</span>${f.length>1?` and ${f.length-1} others`:''}</span></div>`;
        }
    }
    const MAX_CHARS = 180;
    let contentHtml = formatContent(p.content);
    let hasTruncation = false;
    if(p.content.length > MAX_CHARS) {
        hasTruncation = true;
        const truncated = formatContent(p.content.substring(0, MAX_CHARS)) + '...';
        contentHtml = `<span id="content-text-${p.id}">${truncated}</span><span id="read-more-${p.id}" class="read-more-btn" onclick="event.stopPropagation(); toggleReadMore('${p.id}')">more</span>`;
    }
    // Check comments disabled
    const commentIcon = st.allowComments === false ? 'message-circle-off' : 'message-circle';
    d.innerHTML=`<div class="p-4 md:p-5"><div class="post-header"><div class="flex gap-3"><div class="post-avatar-container"><img src="${a.avatar}" class="post-avatar"></div><div><div class="flex items-center"><span class="post-author-name" onclick="event.stopPropagation(); showProfile('${a.id}')">${a.name}</span>${a.isOfficial?'<i data-lucide="badge-check" class="w-4 h-4 official-badge text-blue-500 ml-1"></i>':''}${st.privacy==='private'?'<i data-lucide="lock" class="w-3 h-3 text-gray-400 ml-1"></i>':''}</div><div class="post-meta flex items-center">${formatDate(p.timestamp)}</div></div></div><button class="icon-btn w-8 h-8 -mr-2" onclick="showPostOptions(event,'${p.id}','${p.authorId}')"><i data-lucide="more-horizontal" class="w-5 h-5"></i></button></div><div class="post-content"><div class="post-body" id="post-body-${p.id}" data-full="${formatContent(p.content).replace(/"/g, '&quot;')}">${contentHtml}</div>${mh}</div>${lh}<div class="post-actions"><div class="flex items-center gap-1"><button id="like-btn-${p.id}" class="action-btn like ${liked?'active':''}" onclick="event.stopPropagation(); toggleLike('${p.id}')"><i data-lucide="heart" class="w-6 h-6"></i></button>${st.showLikes?`<span id="like-count-${p.id}" class="text-xs font-medium px-1 hover:underline cursor-pointer" onclick="event.stopPropagation();openLikes('${p.id}')">${p.likes?p.likes.length:0}</span>`:''}<button class="action-btn comment ml-2" onclick="event.stopPropagation(); openPostView('${p.id}')"><i data-lucide="${commentIcon}" class="w-6 h-6"></i> ${st.showComments?`<span id="comment-count-${p.id}" class="text-xs font-medium">${p.comments?p.comments.length:0}</span>`:''}</button><button class="action-btn share-btn ml-2" onclick="event.stopPropagation(); sharePost('${p.id}')"><i data-lucide="share-2" class="w-6 h-6"></i></button></div><button id="save-btn-${p.id}" class="action-btn bookmark ${saved?'active':''}" onclick="event.stopPropagation(); toggleSave('${p.id}')"><i data-lucide="bookmark" class="w-6 h-6"></i></button></div></div>`;
    return d;
}
window.toggleReadMore = (pid) => {
    const body = document.getElementById(`post-body-${pid}`);
    const btn = document.getElementById(`read-more-${pid}`);
    if (btn.innerText === 'more') {
        body.innerHTML = body.getAttribute('data-full') + `<span id="read-more-${pid}" class="read-more-btn" onclick="event.stopPropagation(); toggleReadMore('${pid}')">less</span>`;
    } else {
        const fullText = body.getAttribute('data-full'); 
        const p = posts.find(x => x.id === pid);
        if(p) {
             const truncated = formatContent(p.content.substring(0, 180)) + '...';
             body.innerHTML = `<span id="content-text-${pid}">${truncated}</span><span id="read-more-${pid}" class="read-more-btn" onclick="event.stopPropagation(); toggleReadMore('${pid}')">more</span>`;
        }
    }
};
window.moveCarousel=(pid,dir,ov=false)=>{ const k=ov?`overlay-${pid}`:pid; if(!window.carouselStates||!window.carouselStates[k]) return; const s=window.carouselStates[k], n=s.index+dir; if(n>=0&&n<s.total){ s.index=n; const ii=ov?`overlay-inner-${pid}`:`inner-${pid}`, wi=ov?`overlay-carousel-${pid}`:`carousel-${pid}`; document.getElementById(ii).style.transform=`translateX(-${s.index*100}%)`; const dotsContainer = ov ? document.getElementById(wi).nextElementSibling : document.getElementById(`carousel-${pid}`).nextElementSibling; const dots = dotsContainer.querySelectorAll('.carousel-dot'); dots.forEach((d,i)=>d.classList.toggle('active',i===s.index)); document.getElementById(ov?`overlay-counter-${pid}`:`counter-${pid}`).innerText=s.index+1; } };
window.switchExploreMainTab=t=>{ window.activeExploreTab=t; ['main','video','people','tags'].forEach(x=>document.getElementById(`tab-explore-${x}`)?.classList.remove('active')); ['main-d','video-d','people-d','tags-d'].forEach(x=>document.getElementById(`tab-explore-${x}-d`)?.classList.remove('active')); document.getElementById(`tab-explore-${t==='explore'?'main':t}`)?.classList.add('active'); document.getElementById(`tab-explore-${t==='explore'?'main':t}-d`)?.classList.add('active'); window.activeExploreCategory=t==='video'?'All':'For You'; handleSearch(document.getElementById('mobile-explore-search').value); };
window.toggleExploreSearch=()=>{ const b=document.getElementById('explore-search-bar'); if(b){ b.classList.toggle('hidden'); if(!b.classList.contains('hidden')) document.getElementById('mobile-explore-search').focus(); } };
window.handleSearch=q=>{ if(document.getElementById('view-explore').classList.contains('hidden')) switchView('explore'); const t=q?q.toLowerCase().trim():'', pl=document.getElementById('explore-people-results'), v=document.getElementById('explore-results'); if(window.activeExploreTab==='people'){ pl.classList.remove('hidden','flex'); pl.classList.add('flex'); let fu=t.length?users.filter(u=>(u.name||"").toLowerCase().includes(t)||(u.username||"").toLowerCase().includes(t)):users.slice(0,10); pl.innerHTML=''; if(fu.length) fu.forEach(u=>{ const d=document.createElement('div'); d.className="flex items-center justify-between p-4 border-b border-gray-100 hover:bg-gray-50 cursor-pointer last:border-b-0"; d.onclick=()=>showProfile(u.id); d.innerHTML=`<div class="flex items-center gap-3"><img src="${u.avatar}" class="w-12 h-12 rounded-full border border-gray-100 object-cover bg-gray-50"><div><div class="font-bold text-[#1f1f1f] text-[15px] flex items-center gap-1">${u.name}${u.isOfficial?'<i data-lucide="badge-check" class="w-4 h-4 text-blue-500 fill-blue-50"></i>':''}</div><div class="text-xs text-gray-500 font-medium">@${u.username||'user'}  ${u.followers?u.followers.length:0} followers</div></div></div><button onclick="event.stopPropagation(); toggleFollow('${u.id}')" class="bg-black text-white text-xs px-4 py-1.5 rounded-full font-bold hover:bg-gray-800 transition-colors shadow-sm">Follow</button>`; pl.appendChild(d); }); else pl.innerHTML='<div class="text-gray-400 text-xs italic text-center py-4">No people found</div>'; v.innerHTML=''; return; } else { pl.classList.add('hidden'); pl.classList.remove('flex'); } let fp=[...posts]; if(window.activeExploreTab==='video') fp=fp.filter(p=>p.media&&(Array.isArray(p.media)?p.media.some(m=>m.includes('video')||m.endsWith('.mp4')):p.media.includes('video')||p.media.endsWith('.mp4'))); else if(window.activeExploreTab==='tags') fp=fp.filter(p=>p.content.includes('#')); if(t) fp=fp.filter(p=>p.content.toLowerCase().includes(t)); else if(window.activeExploreTab!=='tags') fp=fp.sort(()=>0.5-Math.random()); v.innerHTML=''; if(!fp.length) v.innerHTML='<div class="text-center py-20 text-gray-400"><p>No posts found.</p></div>'; else { const l=document.createElement('div'); l.className="flex flex-col gap-0.5 md:gap-4"; fp.forEach(p=>l.appendChild(createPostElement(p))); v.appendChild(l); } refreshIcons(); };
window.openCollabSelector=()=>{ const o=document.getElementById('user-list-overlay'), c=document.getElementById('user-list-content'); document.getElementById('user-list-title').innerText="Tag Collaborators"; c.innerHTML=''; const r=users.filter(u=>u.id!==currentUser.id&&(currentUser.following.includes(u.id)||currentUser.followers.includes(u.id))); if(!r.length) c.innerHTML='<div class="text-center text-gray-400 py-8">No contacts.</div>'; else r.forEach(u=>{ const sel=window.selectedCollaborators.find(x=>x.id===u.id), d=document.createElement('div'); d.className=`flex items-center justify-between p-3 hover:bg-gray-50 rounded-xl cursor-pointer ${sel?'bg-gray-100':''}`; d.onclick=()=>toggleCollaborator(u); d.innerHTML=`<div class="flex items-center gap-3"><img src="${u.avatar}" class="w-10 h-10 rounded-full border border-gray-200 object-cover"><div><div class="font-bold text-sm text-gray-900">${u.name}</div><div class="text-xs text-gray-500">@${u.username||'user'}</div></div></div>${sel?'<i data-lucide="check" class="text-gray-600 w-5 h-5"></i>':''}`; c.appendChild(d); }); o.classList.remove('hidden'); refreshIcons(); };
window.toggleCollaborator=u=>{ const i=window.selectedCollaborators.findIndex(x=>x.id===u.id); if(i>-1) window.selectedCollaborators.splice(i,1); else window.selectedCollaborators.push({id:u.id,name:u.name,avatar:u.avatar,username:u.username,status:'pending'}); closeUserList(); openCollabSelector(); renderCollabChips(); };
window.renderCollabChips=()=>{ const c=document.getElementById('collab-chips-container'); c.innerHTML=''; window.selectedCollaborators.forEach(u=>{ const ch=document.createElement('div'); ch.className='collab-chip'; ch.innerHTML=`<img src="${u.avatar}" class="w-4 h-4 rounded-full mr-2"> <span>${u.name}</span> <i onclick="event.stopPropagation(); removeCollaborator('${u.id}')" data-lucide="x" class="w-3 h-3 ml-2 text-gray-500 hover:text-red-500 cursor-pointer"></i>`; c.appendChild(ch); }); refreshIcons(); };
window.removeCollaborator=id=>{ window.selectedCollaborators=window.selectedCollaborators.filter(u=>u.id!==id); renderCollabChips(); };
window.openCollabList=pid=>{ const p=posts.find(x=>x.id===pid); if(!p||!p.collaborators) return; const c=document.getElementById('user-list-content'); document.getElementById('user-list-title').innerText="Collaborators"; c.innerHTML=''; p.collaborators.filter(x=>x.status==='accepted').forEach(u=>{ const d=document.createElement('div'); d.className="flex items-center justify-between p-3 hover:bg-gray-50 rounded-xl cursor-pointer"; d.onclick=()=>{closeUserList();showProfile(u.id);}; d.innerHTML=`<div class="flex items-center gap-3"><img src="${u.avatar}" class="w-10 h-10 rounded-full border border-gray-200 object-cover"><div><div class="font-bold text-sm text-gray-900">${u.name}</div><div class="text-xs text-gray-500">@${u.username||'user'}</div></div></div>`; c.appendChild(d); }); document.getElementById('user-list-overlay').classList.remove('hidden'); };
window.toggleLike=async(pid)=>{
    const b=document.getElementById(`like-btn-${pid}`), cs=document.getElementById(`like-count-${pid}`);
    let isLiking = false;
    if(b){
        isLiking = !b.classList.contains('active');
        if(!isLiking){
            b.classList.remove('active');
            if(cs)cs.innerText=Math.max(0,(parseInt(cs.innerText)||0)-1);
        } else {
            b.classList.add('active');
            if(cs)cs.innerText=(parseInt(cs.innerText)||0)+1;
        }
    }
    const r=doc(db,"posts",pid), p=posts.find(x=>x.id===pid);
    if(p.likes&&p.likes.includes(currentUser.id)) await updateDoc(r,{likes:arrayRemove(currentUser.id)});
    else {
        await updateDoc(r,{likes:arrayUnion(currentUser.id)});
        if(p.authorId!==currentUser.id) {
             // Deduplicated notification: using custom ID
             sendNotification(p.authorId,'like','liked your post',pid);
        }
    }
};
window.openLikes=pid=>{ 
    const p=posts.find(x=>x.id===pid), c=document.getElementById('likes-list-content'); 
    c.innerHTML=''; 
    if(!p.likes?.length) c.innerHTML='<div class="text-center text-gray-400 py-8">No likes yet.</div>'; 
    else p.likes.forEach(uid=>{ 
        const u=users.find(x=>x.id===uid); 
        if(u){ 
            const d=document.createElement('div'); 
            d.className="flex items-center gap-3 p-3 hover:bg-gray-50 rounded-xl cursor-pointer"; 
            d.onclick=()=>{closeLikes();showProfile(u.id);}; 
            d.innerHTML=`<img src="${u.avatar}" class="w-10 h-10 rounded-full border border-gray-200 object-cover"><div><div class="font-bold text-sm text-gray-900">${u.name}</div><div class="text-xs text-gray-500 truncate w-32">${u.bio}</div></div>`; 
            c.appendChild(d); 
        } 
    }); 
    const overlay = document.getElementById('likes-overlay');
    const modal = document.getElementById('likes-modal');
    overlay.classList.remove('hidden');
    requestAnimationFrame(()=>{
       overlay.classList.remove('opacity-0');
       modal.classList.remove('translate-y-full', 'md:scale-95');
       modal.classList.add('translate-y-0', 'md:scale-100');
    });
};
window.closeLikes = () => {
   const overlay = document.getElementById('likes-overlay');
   const modal = document.getElementById('likes-modal');
   overlay.classList.add('opacity-0');
   modal.classList.add('translate-y-full', 'md:scale-95');
   modal.classList.remove('translate-y-0', 'md:scale-100');
   setTimeout(() => overlay.classList.add('hidden'), 200);
}
window.toggleSave=async(pid)=>{ const b=document.getElementById(`save-btn-${pid}`); if(b){ const i=b.classList.contains('active'); if(i){b.classList.remove('active');showToast("Removed");} else {b.classList.add('active');showToast("Saved");} } const r=doc(db,"users",currentUser.id); if(savedPosts.includes(pid)){ await updateDoc(r,{saved:arrayRemove(pid)}); savedPosts=savedPosts.filter(x=>x!==pid); } else { await updateDoc(r,{saved:arrayUnion(pid)}); savedPosts.push(pid); } };
window.sharePost=pid=>{ 
    window.currentSharePid = pid;
    const overlay = document.getElementById('share-overlay');
    const modal = document.getElementById('share-modal');
    const url = `${window.location.origin}${window.location.pathname}?postId=${pid}`;
    document.getElementById('share-link-input').value = url;
    
    overlay.classList.remove('hidden');
    requestAnimationFrame(() => {
        overlay.classList.remove('opacity-0');
        modal.classList.remove('translate-y-full', 'md:scale-95');
        modal.classList.add('translate-y-0', 'md:scale-100');
    });
};
window.closeShareMenu = () => {
    const overlay = document.getElementById('share-overlay');
    const modal = document.getElementById('share-modal');
    
    overlay.classList.add('opacity-0');
    modal.classList.add('translate-y-full', 'md:scale-95');
    modal.classList.remove('translate-y-0', 'md:scale-100');
    
    setTimeout(() => {
        overlay.classList.add('hidden');
        window.currentSharePid = null;
    }, 200);
};
window.triggerShare = (platform) => {
    if (!window.currentSharePid) return;
    const url = `${window.location.origin}${window.location.pathname}?postId=${window.currentSharePid}`;
    const text = "Check out this post on EduLink!";
    
    if (platform === 'copy') {
        navigator.clipboard.writeText(url).then(() => showToast("Link copied!"));
    } else if (platform === 'twitter') {
        window.open(`https://twitter.com/intent/tweet?text=${encodeURIComponent(text)}&url=${encodeURIComponent(url)}`, '_blank');
    } else if (platform === 'whatsapp') {
        window.open(`https://wa.me/?text=${encodeURIComponent(text + " " + url)}`, '_blank');
    } else if (platform === 'email') {
        window.open(`mailto:?subject=${encodeURIComponent(text)}&body=${encodeURIComponent(text + "\n\n" + url)}`);
    }
    
    // Close modal after action, except for copy which has its own toast
    if (platform !== 'copy') closeShareMenu();
};
window.renderSaved=()=>{ const c=document.getElementById('saved-container'); c.innerHTML=''; if(!savedPosts.length) c.innerHTML='<div class="flex flex-col items-center justify-center h-full text-gray-400 opacity-60"><i data-lucide="bookmark" class="w-16 h-16 mb-2"></i><p>No saved posts</p></div>'; else posts.filter(p=>savedPosts.includes(p.id)).forEach(p=>c.appendChild(createPostElement(p))); refreshIcons(); };
async function sendNotification(rid,t,c,pid=null){ 
    // New Smart Deduplication Logic: setDoc with deterministic ID
    // ID format: type_senderId_postId_receiverId
    const nid = `${t}_${currentUser.id}_${pid?pid:'general'}_${rid}`;
    await setDoc(doc(db,"notifications",nid),{receiverId:rid,senderId:currentUser.id,type:t,content:c,timestamp:serverTimestamp(),read:false,postId:pid},{merge:true}); 
}
window.switchNotifTab=t=>{ activeNotifTab=t; document.querySelectorAll('.tab-btn').forEach(b=>b.classList.remove('active')); document.getElementById(`ntab-${t}`)?.classList.add('active'); document.getElementById(`ntab-${t}-mobile`)?.classList.add('active'); renderNotifications(); };
window.toggleNotifMenu=()=>{ const m=document.getElementById('notif-menu-dropdown'); m.classList.toggle('hidden'); m.classList.toggle('flex'); };
window.toggleNotifSelection=()=>{ window.notifSelectionMode=!window.notifSelectionMode; if(!window.notifSelectionMode) window.selectedNotifs.clear(); toggleNotifMenu(); renderNotifications(); };
window.toggleNotifSearchMobile=()=>{ const c=document.getElementById('mobile-notif-search-container'); c.classList.toggle('hidden'); if(!c.classList.contains('hidden')) document.getElementById('notif-search').focus(); };
window.handleNotifSearch=v=>{ window.notifSearchTerm=v.toLowerCase(); renderNotifications(); };
window.deleteSelectedNotifs=async()=>{ if(!window.selectedNotifs.size) return showToast("None selected"); showAlert(`Delete ${window.selectedNotifs.size} items?`,async()=>{ const b=writeBatch(db); window.selectedNotifs.forEach(id=>b.delete(doc(db,"notifications",id))); await b.commit(); window.notifSelectionMode=false; window.selectedNotifs.clear(); toggleNotifMenu(); showToast("Deleted"); }); };
window.toggleNotifSelect=id=>{ window.selectedNotifs.has(id)?window.selectedNotifs.delete(id):window.selectedNotifs.add(id); renderNotifications(); };
window.renderNotifications=()=>{ const c=document.getElementById('notification-list'); c.innerHTML=''; const fl=notifications.filter(n=>{ const s=users.find(u=>u.id===n.senderId)||{name:'Admin',isOfficial:false}, off=n.type==='official'||s.isOfficial; let m=false; if(activeNotifTab==='official') m=off; else m=!off; if(window.notifSearchTerm) return m&&(n.content.toLowerCase().includes(window.notifSearchTerm)||s.name.toLowerCase().includes(window.notifSearchTerm)); return m; }); if(!fl.length) return c.innerHTML='<div class="text-center text-xs text-gray-400 py-4">No notifications</div>'; fl.forEach(n=>{ const s=users.find(u=>u.id===n.senderId)||{name:'Admin',avatar:''}, d=document.createElement('div'); d.className=`w-full flex items-start gap-3 p-4 border-b border-gray-100 bg-white hover:bg-gray-50 transition-colors`; let i='',ib=''; if(n.type==='like'){i='<i data-lucide="heart" class="w-3.5 h-3.5 text-white"></i>';ib="bg-red-500";} else if(n.type==='comment'){i='<i data-lucide="message-circle" class="w-3.5 h-3.5 text-white"></i>';ib="bg-blue-500";} else if(n.type==='reply'){i='<i data-lucide="corner-down-right" class="w-3.5 h-3.5 text-white"></i>';ib="bg-teal-500";} else if(n.type==='follow'){i='<i data-lucide="user-plus" class="w-3.5 h-3.5 text-white"></i>';ib="bg-indigo-500";} else if(n.type==='official'){i='<i data-lucide="megaphone" class="w-3.5 h-3.5 text-white"></i>';ib="bg-purple-600";} else if(n.type==='follow_request'){i='<i data-lucide="lock" class="w-3.5 h-3.5 text-white"></i>';ib="bg-orange-500";} else if(n.type==='collab_request'){i='<i data-lucide="users" class="w-3.5 h-3.5 text-white"></i>';ib="bg-pink-500";} else if(n.type==='mention'){i='<i data-lucide="at-sign" class="w-3.5 h-3.5 text-white"></i>';ib="bg-green-500";} else {i='<i data-lucide="bell" class="w-3.5 h-3.5 text-white"></i>';ib="bg-gray-500";} let ca=(['like','comment','reply','mention'].includes(n.type)&&n.postId)?`onclick="if(!window.notifSelectionMode) openPostView('${n.postId}')"`:`onclick="if(!window.notifSelectionMode) showProfile('${s.id}')"`, ab=''; if(n.type==='follow_request'){ab=`<div class="flex gap-2 mt-2"><button onclick="acceptFollow('${n.id}','${s.id}')" class="text-xs bg-blue-600 text-white px-3 py-1 rounded-md font-bold hover:bg-blue-700">Accept</button><button onclick="deleteNotification('${n.id}')" class="text-xs bg-gray-100 text-gray-600 px-3 py-1 rounded-md font-bold hover:bg-gray-200">Delete</button></div>`;ca='';} if(n.type==='collab_request'){ab=`<div class="flex gap-2 mt-2"><button onclick="acceptCollab('${n.id}','${n.postId}')" class="text-xs bg-blue-600 text-white px-3 py-1 rounded-md font-bold hover:bg-blue-700">Accept</button><button onclick="declineCollab('${n.id}','${n.postId}')" class="text-xs bg-gray-100 text-gray-600 px-3 py-1 rounded-md font-bold hover:bg-gray-200">Decline</button></div>`;ca='';} let ch=''; if(window.notifSelectionMode){ch=`<div class="pt-1"><input type="checkbox" ${window.selectedNotifs.has(n.id)?'checked':''} onchange="toggleNotifSelect('${n.id}')" class="w-4 h-4 accent-blue-600 cursor-pointer rounded"></div>`;ca='';} d.innerHTML=`${ch}<div class="relative cursor-pointer shrink-0" onclick="if(!window.notifSelectionMode) showProfile('${s.id}')"><img src="${s.avatar}" class="w-10 h-10 rounded-full bg-gray-200 object-cover border border-gray-100"><div class="absolute -bottom-1 -right-1 w-5 h-5 rounded-full ${ib} flex items-center justify-center border border-white shadow-sm">${i}</div></div><div class="flex-1 min-w-0 pt-0.5"><div class="text-[14px] leading-snug cursor-pointer" ${ca}><span class="font-bold text-gray-900 hover:underline">${s.name}</span> <span class="text-gray-600 ml-1">${n.content}</span></div><div class="text-[11px] text-gray-400 mt-1">${formatDate(n.timestamp)}</div>${ab}</div>${!window.notifSelectionMode?`<button onclick="deleteNotification('${n.id}')" class="p-1.5 text-gray-300 hover:text-red-500 hover:bg-red-50 rounded-full transition-all self-start -mt-1 -mr-2"><i data-lucide="x" class="w-3.5 h-3.5"></i></button>`:''}`; c.appendChild(d); }); refreshIcons(); };
window.deleteNotification=async(id)=>{ showAlert("Delete?",async()=>{ await deleteDoc(doc(db,"notifications",id)); }); };
window.acceptCollab=async(nid,pid)=>{ const r=doc(db,"posts",pid), s=await getDoc(r); if(s.exists()){ const p=s.data(), c=p.collaborators||[], i=c.findIndex(x=>x.id===currentUser.id); if(i>-1){ c[i].status='accepted'; await updateDoc(r,{collaborators:c}); showToast("Accepted!"); } } await deleteDoc(doc(db,"notifications",nid)); };
window.declineCollab=async(nid,pid)=>{ const r=doc(db,"posts",pid), s=await getDoc(r); if(s.exists()){ const p=s.data(), c=(p.collaborators||[]).filter(x=>x.id!==currentUser.id); await updateDoc(r,{collaborators:c}); showToast("Declined"); } await deleteDoc(doc(db,"notifications",nid)); };
window.acceptFollow=async(nid,sid)=>{ await updateDoc(doc(db,"users",currentUser.id),{followers:arrayUnion(sid)}); await updateDoc(doc(db,"users",sid),{following:arrayUnion(currentUser.id)}); await deleteDoc(doc(db,"notifications",nid)); await sendNotification(sid,'follow','accepted follow'); showToast("Accepted"); };
window.clearAllNotifications=async()=>{ showAlert("Clear all?",async()=>{ const b=writeBatch(db), q=query(collection(db,"notifications"),where("receiverId","==",currentUser.id)), s=await getDocs(q); s.forEach(d=>b.delete(d.ref)); await b.commit(); showToast("Cleared"); }); };
window.toggleNotifications=()=>switchView('notifications');
window.showProfile=(uid,tab='posts')=>{ if(!uid) uid=currentUser.id; closePostView(); closeThread(); const u=users.find(x=>x.id===uid); if(!u) return; window.currentViewingProfileId=uid; window.currentProfileTab=tab; const c=document.getElementById('view-profile'), me=uid===currentUser.id, fol=currentUser.following?.includes(uid); let ab="", net=""; if(me) ab=`<button onclick="openEditProfile()" class="bg-gray-100 text-gray-700 px-4 py-2 rounded-lg font-bold text-sm hover:bg-gray-200">Edit Profile</button>`; else { const priv=u.settings?.privateNetwork; let txt=fol?'Following':(priv?'Request':'Follow'); if(document.getElementById('profile-follow-btn')?.innerText==='Requested'&&!fol) txt='Requested'; ab=`<div class="flex gap-2"><button id="profile-follow-btn" onclick="toggleFollow('${uid}')" class="${fol?'bg-gray-100 text-gray-700':'bg-[#0b57d0] text-white'} px-4 py-2 rounded-lg font-bold text-sm transition-colors">${txt}</button></div>`; } const bu=u.banner||'https://images.unsplash.com/photo-1579546929518-9e396f3cc809?ixlib=rb-1.2.1&auto=format&fit=crop&w=1000&q=80', bp=u.bannerPos||50; if(me||!u.settings?.privateNetwork||fol) net=`<div class="flex gap-4 mt-3 text-sm text-gray-500"><span class="cursor-pointer hover:underline" onclick="openUserList('following','${uid}')"><strong class="text-gray-900">${u.following?u.following.length:0}</strong> Following</span><span class="cursor-pointer hover:underline" onclick="openUserList('followers','${uid}')"><strong class="text-gray-900">${u.followers?u.followers.length:0}</strong> Followers</span></div>`; else net=`<div class="flex gap-4 mt-3 text-sm text-gray-500"><span class="italic"><i data-lucide="lock" class="w-3 h-3 inline"></i> Private Account</span></div>`; const tabs=`<div class="tab-group mb-0"><button onclick="switchProfileTab('posts')" class="tab-btn ${tab==='posts'?'active':''}"><i data-lucide="grid" class="w-5 h-5"></i></button>${me?`<button onclick="switchProfileTab('saved')" class="tab-btn ${tab==='saved'?'active':''}"><i data-lucide="bookmark" class="w-5 h-5"></i></button>`:''}<button onclick="switchProfileTab('liked')" class="tab-btn ${tab==='liked'?'active':''}"><i data-lucide="heart" class="w-5 h-5"></i></button><button onclick="switchProfileTab('tagged')" class="tab-btn ${tab==='tagged'?'active':''}"><i data-lucide="user-check" class="w-5 h-5"></i></button><button onclick="switchProfileTab('links')" class="tab-btn ${tab==='links'?'active':''}"><i data-lucide="link" class="w-5 h-5"></i></button></div>`; c.innerHTML=`<div class="profile-banner-container"><img src="${bu}" class="profile-banner-img" style="object-position:center ${bp}%"></div><div class="px-4 md:px-6 relative"><div class="flex justify-between items-end -mt-10 mb-4"><img src="${u.avatar}" class="w-24 h-24 rounded-full border-4 border-white bg-white object-cover">${ab}</div><div class="mb-6"><h1 class="text-2xl font-bold text-gray-900 flex items-center gap-2">${u.name} ${u.isOfficial?'<i data-lucide="badge-check" class="text-blue-600 w-6 h-6"></i>':''}</h1><div class="text-sm font-medium text-gray-500">@${u.username||'user'}</div><p class="text-gray-600 mt-2">${u.bio}</p>${net}</div>${tabs}<div id="profile-content-area" class="pt-1 md:pt-4 pb-20 md:pb-0"></div></div>`; switchView('profile'); renderProfileContent(uid,tab); refreshIcons(); };
window.switchProfileTab=t=>{ document.querySelectorAll('#view-profile .tab-btn').forEach(b=>b.classList.remove('active')); const tb=Array.from(document.querySelectorAll('#view-profile .tab-btn')).find(b=>b.getAttribute('onclick').includes(t)); if(tb) tb.classList.add('active'); window.currentProfileTab=t; renderProfileContent(window.currentViewingProfileId,t); };
window.renderProfileContent=(uid,t)=>{ const c=document.getElementById('profile-content-area'); c.innerHTML=""; const u=users.find(x=>x.id===uid); if(t==='links'){ const l=u.links||[], is=uid===currentUser.id; let h='<div class="max-w-4xl mx-auto py-6 space-y-4 md:grid md:grid-cols-2 md:gap-4 md:space-y-0 px-2">'; if(is) h+=`<button onclick="document.getElementById('add-link-modal').classList.remove('hidden')" class="w-full py-3 border-2 border-dashed border-gray-300 rounded-xl text-gray-500 font-bold hover:bg-gray-50 hover:border-gray-400 transition-colors flex items-center justify-center gap-2 h-full"><i data-lucide="plus" class="w-5 h-5"></i> Add New Link</button>`; if(!l.length&&!is) h+=`<div class="col-span-2 text-center text-gray-400 py-10">No links added yet.</div>`; else l.forEach((k,i)=>{ h+=`<a href="${k.url}" target="_blank" class="flex items-center p-4 bg-gray-50 rounded-xl hover:bg-gray-100 transition-colors border border-gray-200 group relative"><div class="w-10 h-10 rounded-full bg-white flex items-center justify-center border border-gray-200 mr-4 shrink-0"><i data-lucide="link" class="w-5 h-5 text-blue-600"></i></div><div class="flex-1 min-w-0"><div class="font-bold text-gray-900 truncate">${k.title}</div><div class="text-xs text-gray-500 truncate">${k.url}</div></div><i data-lucide="external-link" class="w-4 h-4 text-gray-400 ml-2"></i>${is?`<button onclick="event.preventDefault(); deleteLink(${i})" class="absolute top-2 right-2 p-1.5 bg-white rounded-full shadow-sm text-red-500 opacity-0 group-hover:opacity-100 transition-opacity hover:bg-red-50"><i data-lucide="trash-2" class="w-3 h-3"></i></button>`:''}</a>`; }); h+='</div>'; c.innerHTML=h; refreshIcons(); return; } if(t==='liked'&&uid!==currentUser.id){ c.innerHTML='<div class="flex flex-col items-center justify-center py-20 text-gray-400 opacity-60"><i data-lucide="lock" class="w-16 h-16 mb-2"></i><p>This user\'s likes are private.</p></div>'; refreshIcons(); return; } let tp=[]; if(t==='posts') tp=posts.filter(p=>p.authorId===uid); else if(t==='saved') tp=posts.filter(p=>savedPosts.includes(p.id)); else if(t==='liked') tp=posts.filter(p=>p.likes&&p.likes.includes(uid)); else if(t==='tagged') tp=posts.filter(p=>(p.collaborators&&p.collaborators.some(x=>x.id===uid&&x.status==='accepted'))||(p.mentions&&p.mentions.includes(uid))); if(uid!==currentUser.id&&t==='posts'){ const fol=currentUser.following.includes(uid), priv=u?.settings?.privateNetwork; tp=tp.filter(p=>{ const pub=!p.settings||p.settings.privacy==='public'; return priv?!fol:pub||fol; }); } if(!tp.length) c.innerHTML='<div class="text-center py-20 text-gray-400">No posts yet</div>'; else { let gh='<div class="grid-post-container">'; tp.forEach(p=>{ let ct=''; const ms=Array.isArray(p.media)?p.media[0]:p.media; if(ms){ if(ms.includes('video')||ms.endsWith('.mp4')||ms.startsWith('data:video')) ct=`<video src="${ms}" class="w-full h-full object-cover pointer-events-none"></video><div class="absolute inset-0 flex items-center justify-center"><i data-lucide="play" class="w-8 h-8 text-white drop-shadow-md"></i></div>`; else ct=`<img src="${ms}" class="w-full h-full object-cover">`; if(Array.isArray(p.media)&&p.media.length>1) ct+=`<div class="absolute top-2 right-2"><i data-lucide="layers" class="w-4 h-4 text-white drop-shadow-md"></i></div>`; } else ct=`<div class="grid-post-text-preview">${p.content.substring(0,60)}${p.content.length>60?'...':''}</div>`; gh+=`<div class="grid-post-item group" onclick="openPostView('${p.id}')">${ct}<div class="grid-post-overlay"><div class="flex items-center gap-1"><i data-lucide="heart" class="w-5 h-5 fill-white"></i> ${p.likes?p.likes.length:0}</div><div class="flex items-center gap-1"><i data-lucide="message-circle" class="w-5 h-5 fill-white"></i> ${p.comments?p.comments.length:0}</div></div></div>`; }); gh+='</div>'; c.innerHTML=gh; } refreshIcons(); };
window.saveLink=async()=>{ const t=document.getElementById('new-link-title').value.trim(), u=document.getElementById('new-link-url').value.trim(); if(!t||!u) return showToast("Fill all fields",true); const l={title:t,url:u,type:'web'}; await updateDoc(doc(db,"users",currentUser.id),{links:arrayUnion(l)}); currentUser.links=currentUser.links||[]; currentUser.links.push(l); document.getElementById('add-link-modal').classList.add('hidden'); document.getElementById('new-link-title').value=""; document.getElementById('new-link-url').value=""; renderProfileContent(currentUser.id,'links'); showToast("Link added!"); };
window.deleteLink=async(i)=>{ showAlert("Remove link?",async()=>{ const l=currentUser.links[i]; await updateDoc(doc(db,"users",currentUser.id),{links:arrayRemove(l)}); currentUser.links.splice(i,1); renderProfileContent(currentUser.id,'links'); showToast("Removed"); }); };
window.openEditProfile=()=>{ 
    const bu=currentUser.banner||'https://images.unsplash.com/photo-1579546929518-9e396f3cc809?ixlib=rb-1.2.1&auto=format&fit=crop&w=1000&q=80'; 
    currentBannerPos=currentUser.bannerPos||50; 
    initialBannerPos=currentBannerPos; 
    document.getElementById('edit-banner-preview').src=bu; 
    document.getElementById('edit-banner-preview').style.objectPosition=`center ${currentBannerPos}%`; 
    document.getElementById('banner-pos-hint').innerText=`${currentBannerPos}%`; 
    document.getElementById('edit-email').value=currentUser.email||""; 
    
    const overlay = document.getElementById('edit-profile-overlay');
    const modal = document.getElementById('edit-profile-modal');
    overlay.classList.remove('hidden');
    requestAnimationFrame(()=>{
       overlay.classList.remove('opacity-0');
       modal.classList.remove('translate-y-full', 'md:scale-95');
       modal.classList.add('translate-y-0', 'md:scale-100');
    });
};
window.closeEditProfile=()=>{
    const overlay = document.getElementById('edit-profile-overlay');
    const modal = document.getElementById('edit-profile-modal');
    overlay.classList.add('opacity-0');
    modal.classList.add('translate-y-full', 'md:scale-95');
    modal.classList.remove('translate-y-0', 'md:scale-100');
    setTimeout(() => overlay.classList.add('hidden'), 200);
}
window.handleEditAvatarSelect=e=>{ const f=e.target.files[0]; if(f){ currentAvatarBlob=f; const r=new FileReader(); r.onload=x=>{document.getElementById('edit-avatar-preview').src=x.target.result;}; r.readAsDataURL(f); } };
window.handleEditBannerSelect=e=>{ const f=e.target.files[0]; if(f){ currentBannerBlob=f; const r=new FileReader(); r.onload=x=>{document.getElementById('edit-banner-preview').src=x.target.result;}; r.readAsDataURL(f); } };
window.saveProfileChanges=async()=>{ const b=document.getElementById('save-profile-btn'), ot=b.innerText; b.innerText="Saving..."; b.disabled=true; const n=document.getElementById('edit-name').value, bio=document.getElementById('edit-bio').value, bp=currentBannerPos; if(!n) return showToast("Name required"),b.innerText=ot,b.disabled=false; let av=currentUser.avatar, bu=currentUser.banner||'https://images.unsplash.com/photo-1579546929518-9e396f3cc809?ixlib=rb-1.2.1&auto=format&fit=crop&w=1000&q=80'; try{ if(currentAvatarBlob) av=await uploadToImgHippo(currentAvatarBlob); if(currentBannerBlob) bu=await uploadToImgHippo(currentBannerBlob); }catch(e){ return console.error(e),showToast("Upload failed"),b.innerText=ot,b.disabled=false; } const r=doc(db,"users",currentUser.id); await updateDoc(r,{name:n,bio:bio,avatar:av,banner:bu,bannerPos:bp}); currentUser.name=n; currentUser.bio=bio; currentUser.avatar=av; currentUser.banner=bu; currentUser.bannerPos=bp; currentAvatarBlob=null; currentBannerBlob=null; updateUserInterface(); closeEditProfile(); showProfile(currentUser.id,window.currentProfileTab); showToast("Updated"); b.innerText=ot; b.disabled=false; };
window.doLogout=async()=>{ await signOut(auth); window.location.href="index.html"; };
window.toggleFollow=async(uid)=>{ const m=doc(db,"users",currentUser.id), t=doc(db,"users",uid), tu=users.find(u=>u.id===uid), pr=tu?.settings?.privateNetwork; if(currentUser.following.includes(uid)){ currentUser.following=currentUser.following.filter(id=>id!==uid); showToast("Unfollowed"); await updateDoc(m,{following:arrayRemove(uid)}); await updateDoc(t,{followers:arrayRemove(currentUser.id)}); if(document.getElementById('profile-follow-btn')) document.getElementById('profile-follow-btn').innerText=pr?'Request':'Follow'; } else { if(pr){ showToast("Request sent"); sendNotification(uid,'follow_request','wants to follow you'); if(document.getElementById('profile-follow-btn')) document.getElementById('profile-follow-btn').innerText="Requested"; } else { currentUser.following.push(uid); showToast("Following"); await updateDoc(m,{following:arrayUnion(uid)}); await updateDoc(t,{followers:arrayUnion(currentUser.id)}); sendNotification(uid,'follow','started following you'); if(document.getElementById('profile-follow-btn')) document.getElementById('profile-follow-btn').innerText="Following"; } } renderRightSidebar(); if(!document.getElementById('view-network').classList.contains('hidden')) renderNetwork(); refreshIcons(); };
window.openPostView=pid=>{ const p=posts.find(x=>x.id===pid); if(!p) return; window.currentViewingPostId=pid; const o=document.getElementById('post-view-overlay'); o.classList.remove('mobile-reel-view'); document.body.classList.remove('reel-mode'); const a=users.find(u=>u.id===p.authorId)||{name:'Unknown',avatar:'',id:p.authorId}, ds=formatDate(p.timestamp), ch=formatContent(p.content), mc=document.getElementById('post-view-media-container'), ca=document.getElementById('post-view-caption-area'); document.getElementById('mobile-post-pfp').src=a.avatar; document.getElementById('mobile-post-username').innerText=a.name; document.getElementById('mobile-post-caption').innerHTML=ch; const ml=document.getElementById('mobile-like-count'); ml.innerText=p.likes?p.likes.length:0; const sl=p.settings?.showLikes!==false; ml.style.display=sl?'block':'none'; document.getElementById('reel-user-avatar').src=a.avatar; document.getElementById('reel-username').innerText=a.name; const rc=document.getElementById('reel-caption'); rc.removeAttribute('data-expanded'); rc.style.maxHeight=''; rc.style.overflowY=''; if(p.content.length>80){ rc.innerHTML=`<span>${p.content.substring(0,80)}... </span><span class="font-bold text-gray-300 cursor-pointer" onclick="event.stopPropagation(); toggleReelCaption('${pid}')">more</span>`; rc.dataset.full=p.content; } else rc.innerHTML=p.content; updatePostViewStats(pid); if(document.getElementById('reel-user-info-area')) document.getElementById('reel-user-info-area').onclick=e=>{e.stopPropagation();closePostView();showProfile(a.id);}; mc.classList.remove('hidden'); mc.innerHTML=''; const po=document.createElement('div'); po.id='video-play-overlay'; po.className='play-pause-overlay'; po.innerHTML='<i data-lucide="play" class="play-pause-icon"></i>'; mc.appendChild(po); if(p.media){ const ma=Array.isArray(p.media)?p.media:[p.media]; if(ma.length===1){ const s=ma[0], iv=s.includes('video')||s.endsWith('.mp4')||s.startsWith('data:video'); if(iv){ const v=document.createElement('video'); v.src=s; v.className="stage-content rounded-lg shadow-2xl"; v.controls=false; v.playsInline=true; v.muted=false; v.loop=true; const tp=e=>{e.stopPropagation(); if(v.paused){v.play();po.classList.remove('show');} else {v.pause();po.classList.add('show');}}; v.onclick=tp; po.onclick=tp; po.classList.add('show'); if(window.innerWidth<768) v.onloadedmetadata=function(){o.classList.add('mobile-reel-view');document.body.classList.add('reel-mode');this.className="w-full h-full object-cover";this.muted=false;}; mc.insertBefore(v,po); } else mc.innerHTML=`<img src="${s}" class="stage-content rounded-lg shadow-2xl">`; } else { let sl='', dt=''; ma.forEach((s,i)=>{ const iv=s.startsWith('data:video')||s.includes('.mp4'); sl+=`<div class="post-carousel-item">${iv?`<video src="${s}" controls></video>`:`<img src="${s}">`}</div>`; dt+=`<div class="carousel-dot ${i===0?'active':''}" id="overlay-dot-${p.id}-${i}"></div>`; });
            // UPDATED OVERLAY CAROUSEL
            mc.innerHTML=`<div class="carousel-wrapper"><div class="rounded-lg overflow-hidden post-carousel shadow-2xl touch-pan-y" id="overlay-carousel-${p.id}" ontouchstart="handleTouchStart(event)" ontouchend="handleTouchEnd(event,'${p.id}',true)"><div class="post-carousel-inner" id="overlay-inner-${p.id}">${sl}</div><button class="carousel-nav-btn prev" onclick="event.stopPropagation();moveCarousel('${p.id}',-1,true)"><i data-lucide="chevron-left" class="w-4 h-4"></i></button><button class="carousel-nav-btn next" onclick="event.stopPropagation();moveCarousel('${p.id}',1,true)"><i data-lucide="chevron-right" class="w-4 h-4"></i></button></div><div class="carousel-dots-outside">${dt}</div></div>`; if(!window.carouselStates) window.carouselStates[`overlay-${p.id}`]={index:0,total:ma.length}; } } else mc.innerHTML='<div class="flex flex-col items-center justify-center h-full text-white opacity-40"><i data-lucide="image-off" class="w-16 h-16 mb-2"></i><span class="text-sm font-medium">No Media</span></div>'; renderCommentsInModal(pid); const lb=document.getElementById('post-view-like-btn'), il=p.likes&&p.likes.includes(currentUser.id); lb.classList.remove('fill-red-500','text-red-500','text-gray-700'); if(il) lb.classList.add('fill-red-500','text-red-500'); else lb.classList.add('text-gray-700'); lb.onclick=()=>toggleLike(pid); const mlb=document.getElementById('mobile-action-like'); mlb.classList.remove('fill-red-500','text-red-500','text-[#1f1f1f]'); if(il) mlb.classList.add('fill-red-500','text-red-500'); else mlb.classList.add('text-[#1f1f1f]'); const sb=document.getElementById('post-view-save-btn'), is=savedPosts.includes(pid); sb.classList.remove('fill-yellow-500','text-yellow-500','text-gray-700'); if(is) sb.classList.add('fill-yellow-500','text-yellow-500'); else sb.classList.add('text-gray-700'); sb.onclick=()=>toggleSave(pid); const msb=document.getElementById('mobile-action-save'); msb.classList.remove('fill-yellow-500','text-yellow-500','text-[#1f1f1f]'); if(is) msb.classList.add('fill-yellow-500','text-yellow-500'); else msb.classList.add('text-[#1f1f1f]'); const ic=document.querySelector('.chat-input-wrapper'); if(p.settings&&p.settings.allowComments===false){ if(ic) ic.classList.add('hidden'); let m=document.getElementById('comments-off-msg'); if(!m){m=document.createElement('div');m.id='comments-off-msg';m.className='text-center text-sm text-gray-500 italic py-2';m.innerText='Creator turned off comments';document.querySelector('.discussion-footer').appendChild(m);}else m.style.display='block'; } else { if(ic) ic.classList.remove('hidden'); const m=document.getElementById('comments-off-msg'); if(m) m.style.display='none'; } document.getElementById('comment-input-avatar').src=currentUser.avatar; o.classList.remove('hidden'); o.classList.add('flex'); refreshIcons(); };
window.toggleReelCaption=pid=>{ const e=document.getElementById('reel-caption'); if(!e||!e.dataset.full) return; if(e.getAttribute('data-expanded')==='true'){ e.innerHTML=`<span>${e.dataset.full.substring(0,80)}... </span><span class="font-bold text-gray-300 cursor-pointer" onclick="event.stopPropagation(); toggleReelCaption('${pid}')">more</span>`; e.setAttribute('data-expanded','false'); e.style.overflowY='hidden'; e.style.maxHeight=''; } else { e.innerHTML=`<span>${e.dataset.full}</span> <span class="font-bold text-gray-300 cursor-pointer block mt-1" onclick="event.stopPropagation(); toggleReelCaption('${pid}')">less</span>`; e.setAttribute('data-expanded','true'); e.style.overflowY='auto'; e.style.maxHeight='200px'; } };
window.toggleMobileCommentDrawer=()=>document.querySelector('.discussion-panel')?.classList.toggle('open');
window.closePostView=()=>{ const o=document.getElementById('post-view-overlay'); o.classList.add('hidden'); o.classList.remove('flex'); document.body.classList.remove('reel-mode'); document.querySelector('.discussion-panel')?.classList.remove('open'); window.currentViewingPostId=null; window.replyingToCommentId=null; const v=document.querySelector('#post-view-media-container video'); if(v) v.pause(); };
function renderCommentsInModal(pid){
    const p=posts.find(x=>x.id===pid); if(!p) return;
    const c=document.getElementById('post-view-comments');
    let h='';
    const sl=p.settings?.showLikes!==false, lt=sl?`${p.likes?p.likes.length:0} likes`:'';
    document.getElementById('post-view-likes-count').innerText=lt;
    if(p.comments&&p.comments.length>0) p.comments.filter(x=>!x.parentId).forEach(k=>{h+=createCommentHTML(k,p.comments,pid,true);});
    else h='<div class="flex flex-col items-center justify-center py-10 text-gray-400"><i data-lucide="message-square" class="w-12 h-12 mb-2 opacity-50"></i><p>No comments yet.</p></div>';
    c.innerHTML=h;
    refreshIcons();
}
function createCommentHTML(c,ac,pid,sr=true){
    const a=users.find(u=>u.id===c.authorId)||{name:'Unknown',avatar:''};
    const lc=c.likes?c.likes.length:0;
    const me=c.authorId===currentUser.id;
    const rep=ac.filter(r=>r.parentId===c.id);
    return `<div class="comment-row"><img src="${a.avatar}" class="comment-avatar" onclick="showProfile('${c.authorId}')"><div class="comment-content-box"><div class="comment-header"><span onclick="showProfile('${c.authorId}')" class="cursor-pointer hover:underline">${a.name}</span><span class="comment-time">${formatDate(c.timestamp)}</span></div><div class="comment-text">${formatContent(c.content)}</div><div class="comment-actions-row"><button class="comment-action-btn" onclick="toggleCommentLike('${pid}','${c.id}')"><i data-lucide="heart" class="w-4 h-4 ${c.likes?.includes(currentUser.id)?'fill-red-500 text-red-500':''}"></i> <span>${lc>0?lc:''}</span></button><div class="comment-reply-btn" onclick="replyToComment('${c.id}','${a.name}')"><i data-lucide="message-square" class="w-4 h-4"></i></div>${me?`<button onclick="deleteComment('${pid}','${c.id}')" class="comment-action-btn text-red-600">Delete</button>`:''}</div>${(sr&&rep.length>0)?`<div class="mt-2"><button onclick="openThread('${pid}','${c.id}')" class="text-xs font-bold text-blue-600 hover:bg-blue-50 px-3 py-1.5 rounded-full flex items-center gap-1"><i data-lucide="chevron-down" class="w-3 h-3"></i> ${rep.length} replies</button></div>`:''}</div></div>`;
}
window.openThread=(pid,cid)=>{ window.threadPostId=pid; window.threadParentCommentId=cid; renderThreadContent(pid,cid); document.getElementById('thread-overlay').classList.remove('hidden'); document.getElementById('thread-input').focus(); document.getElementById('thread-input-avatar').src=currentUser.avatar; };
window.closeThread=()=>{ document.getElementById('thread-overlay').classList.add('hidden'); window.threadPostId=null; window.threadParentCommentId=null; window.replyingToCommentId=null; };
window.renderThreadContent=(pid,cid)=>{ const p=posts.find(x=>x.id===pid); if(!p) return; const pc=p.comments.find(x=>x.id===cid); if(!pc) return; const r=p.comments.filter(x=>x.parentId===cid), c=document.getElementById('thread-content'); let h=`<div class="pb-4 border-b border-gray-100">${createCommentHTML(pc,p.comments,pid,false)}</div><div class="pl-0 pt-0 space-y-0">`; if(r.length) r.forEach(x=>h+=createCommentHTML(x,p.comments,pid,false)); else h+='<div class="text-center text-gray-400 text-sm py-4">No replies yet.</div>'; h+='</div>'; c.innerHTML=h; refreshIcons(); };
window.submitThreadReply=async()=>{ const t=document.getElementById('thread-input').value.trim(); if(!t||!window.threadPostId||!window.threadParentCommentId) return; const r=doc(db,"posts",window.threadPostId), nc={id:"c-"+Date.now()+"-"+Math.floor(Math.random()*1000),authorId:currentUser.id,content:t,timestamp:Date.now(),likes:[],parentId:window.threadParentCommentId}; await updateDoc(r,{comments:arrayUnion(nc)}); const p=posts.find(x=>x.id===window.threadPostId), pc=p.comments.find(x=>x.id===window.threadParentCommentId); if(pc&&pc.authorId!==currentUser.id) sendNotification(pc.authorId,'reply','replied to your comment',window.threadPostId); document.getElementById('thread-input').value=""; };
window.deleteComment=async(pid,cid)=>{ showAlert("Delete comment?",async()=>{ const r=doc(db,"posts",pid), p=posts.find(x=>x.id===pid), nc=p.comments.filter(x=>x.id!==cid&&x.parentId!==cid); await updateDoc(r,{comments:nc}); showToast("Deleted"); }); };
window.toggleCommentLike=async(pid,cid)=>{ const p=posts.find(x=>x.id===pid); if(!p) return; const c=p.comments||[], i=c.findIndex(x=>x.id===cid); if(i===-1) return; const cm=c[i]; if(!cm.likes) cm.likes=[]; if(cm.likes.includes(currentUser.id)) cm.likes=cm.likes.filter(x=>x!==currentUser.id); else { cm.likes.push(currentUser.id); if(cm.authorId!==currentUser.id) sendNotification(cm.authorId,'like','liked your comment',pid); } c[i]=cm; await updateDoc(doc(db,"posts",pid),{comments:c}); };
window.replyToComment=(cid,u)=>{ const o=document.getElementById('thread-overlay'); if(!o.classList.contains('hidden')){const i=document.getElementById('thread-input');i.value=`@${u} `;i.focus();}else{const i=document.getElementById('comment-input-desktop');i.value=`@${u} `;i.focus();window.replyingToCommentId=cid;} };
window.submitCommentDesktop=async()=>{ const t=document.getElementById('comment-input-desktop').value.trim(); if(!t||!window.currentViewingPostId) return; const r=doc(db,"posts",window.currentViewingPostId), nc={id:"c-"+Date.now()+"-"+Math.floor(Math.random()*1000),authorId:currentUser.id,content:t,timestamp:Date.now(),likes:[],parentId:window.replyingToCommentId}; await updateDoc(r,{comments:arrayUnion(nc)}); const p=posts.find(x=>x.id===window.currentViewingPostId); if(window.replyingToCommentId){const pc=p.comments.find(x=>x.id===window.replyingToCommentId);if(pc&&pc.authorId!==currentUser.id) sendNotification(pc.authorId,'reply','replied to your comment',window.currentViewingPostId);} else if(p&&p.authorId!==currentUser.id) sendNotification(p.authorId,'comment','commented on your post',window.currentViewingPostId); document.getElementById('comment-input-desktop').value=""; window.replyingToCommentId=null; };
window.promptForImageLink=()=>{ const u=prompt("Enter Image URL:"); if(u&&(u.startsWith('http')||u.startsWith('data:'))){ window.currentMedia=[u]; window.currentMediaType='image'; document.getElementById('media-preview-container').classList.remove('hidden'); document.getElementById('preview-inner').innerHTML=`<img src="${u}" class="h-20 w-20 object-cover rounded-md">`; showToast("Added"); } };
window.sendAnnouncement=async()=>{ const t=document.getElementById('announcement-text').value.trim(); if(!t) return; showAlert("Broadcast?",async()=>{ for(const u of users) if(u.id!==currentUser.id) await addDoc(collection(db,"notifications"),{receiverId:u.id,senderId:currentUser.id,type:'official',content:t,timestamp:serverTimestamp(),read:false}); showToast("Sent"); document.getElementById('announcement-text').value=""; }); };
window.openCreateMenu=()=>{ document.getElementById('create-menu-overlay').classList.remove('opacity-0','pointer-events-none'); document.getElementById('create-menu-modal').classList.remove('scale-95'); };
window.closeCreateMenu=()=>{ document.getElementById('create-menu-overlay').classList.add('opacity-0','pointer-events-none'); document.getElementById('create-menu-modal').classList.add('scale-95'); };
window.openEventComposer=()=>{ closeCreateMenu(); removeEventCover(); document.getElementById('event-overlay').classList.remove('opacity-0','pointer-events-none'); document.getElementById('event-modal-box').classList.remove('scale-95'); };
window.closeEventComposer=()=>{ document.getElementById('event-overlay').classList.add('opacity-0','pointer-events-none'); document.getElementById('event-modal-box').classList.add('scale-95'); };
window.handleEventCoverSelect=e=>{ const f=e.target.files[0]; if(f){ currentEventCoverBlob=f; const r=new FileReader(); r.onload=x=>{window.currentEventCover=x.target.result; document.getElementById('event-cover-preview').src=window.currentEventCover; document.getElementById('event-cover-preview-container').classList.remove('hidden'); document.getElementById('add-cover-btn').classList.add('hidden');}; r.readAsDataURL(f); } };
window.removeEventCover=()=>{ window.currentEventCover=null; currentEventCoverBlob=null; document.getElementById('event-cover-preview').src=""; document.getElementById('event-cover-preview-container').classList.add('hidden'); document.getElementById('add-cover-btn').classList.remove('hidden'); document.getElementById('event-cover-input').value=""; };
window.publishEvent=()=>{ showToast("Coming soon!",false); closeEventComposer(); };
window.showPostOptions=(e,pid,aid)=>{ e.stopPropagation(); const o=document.getElementById('post-options-overlay'), m=document.getElementById('post-options-modal'), c=document.getElementById('post-options-content'), me=aid===currentUser.id, adm=currentUser.email==='edulinkbht@gmail.com', ce=me, cd=me||adm; let h=''; if(ce) h+=`<button onclick="editPost('${pid}'); hidePostMenu()" class="flex items-center gap-3 w-full p-4 hover:bg-gray-50 rounded-xl transition-colors font-bold text-gray-800 text-left"><i data-lucide="edit-2" class="w-5 h-5"></i> Edit Post</button>`; if(cd) h+=`<button onclick="deletePost('${pid}'); hidePostMenu()" class="flex items-center gap-3 w-full p-4 hover:bg-red-50 rounded-xl transition-colors font-bold text-red-600 text-left"><i data-lucide="trash-2" class="w-5 h-5"></i> Delete Post</button>`; if(!me){ const s=savedPosts.includes(pid); h+=`<button onclick="toggleSave('${pid}'); hidePostMenu()" class="flex items-center gap-3 w-full p-4 hover:bg-gray-50 rounded-xl transition-colors font-bold text-gray-800 text-left"><i data-lucide="bookmark" class="w-5 h-5 ${s?'fill-yellow-500 text-yellow-500':''}"></i> ${s?'Unsave':'Save'} Post</button>`; h+=`<button onclick="showToast('Reported'); hidePostMenu()" class="flex items-center gap-3 w-full p-4 hover:bg-red-50 rounded-xl transition-colors font-bold text-red-600 text-left"><i data-lucide="flag" class="w-5 h-5"></i> Report Post</button>`; } h+=`<button onclick="sharePost('${pid}'); hidePostMenu()" class="flex items-center gap-3 w-full p-4 hover:bg-gray-50 rounded-xl transition-colors font-bold text-gray-800 text-left"><i data-lucide="link" class="w-5 h-5"></i> Copy Link</button>`; c.innerHTML=h; refreshIcons(); o.classList.remove('hidden'); requestAnimationFrame(()=>{o.classList.remove('opacity-0'); m.classList.remove('translate-y-full','md:scale-95'); m.classList.add('translate-y-0','md:scale-100');}); };
window.hidePostMenu=()=>{ const o=document.getElementById('post-options-overlay'), m=document.getElementById('post-options-modal'); o.classList.add('opacity-0'); m.classList.add('translate-y-full','md:scale-95'); m.classList.remove('translate-y-0','md:scale-100'); setTimeout(()=>o.classList.add('hidden'),200); };
window.editPost=pid=>{ const p=posts.find(x=>x.id===pid); if(!p) return; document.getElementById('compose-text').value=p.content; window.editingPostId=pid; document.getElementById('compose-title-text').innerText="Edit Post"; document.getElementById('btn-publish').innerText="Update"; openCompose(); };
window.deletePost=async(pid)=>{ showAlert("Delete post?",async()=>{ await deleteDoc(doc(db,"posts",pid)); showToast("Deleted"); }); };
window.openCompose=()=>{ window.selectedCollaborators=[]; renderCollabChips(); closeCreateMenu(); document.getElementById('compose-overlay').classList.remove('opacity-0','pointer-events-none'); document.getElementById('compose-modal').classList.remove('scale-95'); };
window.closeCompose=()=>{ document.getElementById('compose-overlay').classList.add('opacity-0','pointer-events-none'); document.getElementById('compose-modal').classList.add('scale-95'); setTimeout(() => { window.editingPostId=null; document.getElementById('compose-title-text').innerText="Create Post"; document.getElementById('btn-publish').innerText="Post"; document.getElementById('compose-text').value=""; removeMedia(); },200); };
window.toggleComposeSettings=()=>{ const a=document.getElementById('compose-settings-area'), ar=document.getElementById('compose-settings-arrow'); a.classList.toggle('hidden'); ar.style.transform=a.classList.contains('hidden')?'rotate(0deg)':'rotate(180deg)'; };
window.openUploadOptions=()=>document.getElementById('upload-options-modal').classList.remove('hidden');
window.triggerUpload=m=>{ window.uploadMode=m; document.getElementById('upload-options-modal').classList.add('hidden'); const i=document.getElementById('media-input'); if(m==='multiple') i.setAttribute('multiple',''); else i.removeAttribute('multiple'); i.click(); };
window.handleFileSelect=e=>{ const f=e.target.files; if(f.length>0){ window.currentMediaBlob=[]; window.currentMedia=[]; const c=document.getElementById('media-preview-container'), inr=document.getElementById('preview-inner'); c.classList.remove('hidden'); inr.innerHTML=''; const ps=Array.from(f).map(file=>{ window.currentMediaBlob.push(file); return new Promise(r=>{ const d=new FileReader(); d.onload=ev=>{ window.currentMedia.push(ev.target.result); const iv=file.type.startsWith('video'), el=document.createElement(iv?'video':'img'); el.src=ev.target.result; el.className="h-20 w-20 object-cover rounded-md border border-gray-200 shrink-0"; inr.appendChild(el); r(); }; d.readAsDataURL(file); }); }); Promise.all(ps).then(()=>showToast(`${f.length} file(s) ready`)); } };
window.removeMedia=()=>{ window.currentMedia=[]; window.currentMediaBlob=[]; document.getElementById('media-preview-container').classList.add('hidden'); document.getElementById('media-input').value=""; };
async function uploadToImgHippo(f){ const d=new FormData(); d.append('api_key','d28bf3c492ad07b53dc4e3f9ce99b072'); d.append('file',f); try{ const r=await fetch('https://api.imghippo.com/v1/upload',{method:'POST',body:d}), j=await r.json(); if(j.success) return j.data.url; else throw new Error('Upload failed'); }catch(e){throw e;} }
window.publishPost=async()=>{ const tr=document.getElementById('compose-text').value, btn=document.getElementById('btn-publish'); if(!tr.trim()&&window.currentMedia.length===0) return showToast("Empty!",true); const priv=document.getElementById('post-setting-privacy').checked, sl=document.getElementById('post-setting-likes').checked, sc=document.getElementById('post-setting-comments').checked, alv=document.getElementById('post-setting-like-view').checked, ac=document.getElementById('post-setting-allow-comments').checked; const oh=btn.innerHTML; btn.innerHTML=`<i data-lucide="loader-2" class="w-4 h-4 animate-spin"></i>`; btn.disabled=true; try{ let mu=[]; if(window.currentMediaBlob&&window.currentMediaBlob.length>0){ for(const b of window.currentMediaBlob){ try{ mu.push(await uploadToImgHippo(b)); }catch(e){ const mr=ref(storage,`posts/${currentUser.id}/${Date.now()}_${b.name}`); await uploadBytes(mr,b); mu.push(await getDownloadURL(mr)); } } } else if(window.currentMedia.length>0) mu=window.currentMedia; const mp=mu.length===1?mu[0]:(mu.length>0?mu:null); 
    
    // Parse mentions
    const mentionMatches = tr.match(/@(\w+)/g);
    const mentionUids = [];
    if(mentionMatches){
        mentionMatches.forEach(m => {
            const uname = m.substring(1).toLowerCase();
            const found = users.find(u => (u.username||"").toLowerCase() === uname);
            if(found) mentionUids.push(found.id);
        });
    }

    const pd={authorId:currentUser.id,content:tr,media:mp,timestamp:serverTimestamp(),likes:[],comments:[],collaborators:window.selectedCollaborators||[],mentions:mentionUids,settings:{privacy:priv?'private':'public',showLikes:sl,showComments:sc,allowLikeView:alv,allowComments:ac}}; let pid=null; if(window.editingPostId){ await updateDoc(doc(db,"posts",window.editingPostId),{content:tr,settings:pd.settings}); pid=window.editingPostId; showToast("Updated!"); } else { const r=await addDoc(collection(db,"posts"),pd); pid=r.id; showToast("Posted!"); if(window.selectedCollaborators?.length) window.selectedCollaborators.forEach(c=>sendNotification(c.id,'collab_request','invited to collaborate',pid)); } 
    
    // Send mention notifications
    if(mentionUids.length > 0) {
        mentionUids.forEach(uid => {
            if(uid !== currentUser.id) sendNotification(uid, 'mention', 'mentioned you in a post', pid);
        });
    }

    closeCompose(); document.getElementById('compose-text').value=""; removeMedia(); }catch(e){ console.error(e); showToast("Error",true); }finally{ btn.innerHTML=oh; btn.disabled=false; refreshIcons(); } };
window.showToast=(m,e=false)=>{ const t=document.getElementById('toast'), tm=document.getElementById('toast-msg'), i=document.getElementById('toast-icon'); tm.innerText=m; if(e){t.style.backgroundColor='#d93025';i.setAttribute('data-lucide','alert-circle');i.classList.remove('text-[#c4eed0]');i.classList.add('text-white');} else {t.style.backgroundColor='#303134';i.setAttribute('data-lucide','check-circle-2');i.classList.add('text-[#c4eed0]');} refreshIcons(); t.classList.add('show'); setTimeout(()=>t.classList.remove('show'),3000); };
window.openLightbox=(s,t='image')=>{ const w=document.getElementById('lightbox-wrapper'), l=document.getElementById('lightbox'); if(t==='video'||s.includes('.mp4')||s.includes('data:video')) w.innerHTML=`<video src="${s}" controls autoplay class="max-w-full max-h-[90vh] rounded-lg shadow-2xl"></video>`; else w.innerHTML=`<img src="${s}" class="max-w-full max-h-[90vh] rounded-lg shadow-2xl object-contain">`; l.classList.add('active'); l.classList.remove('pointer-events-none','opacity-0'); };
window.closeLightbox=()=>{ const l=document.getElementById('lightbox'); l.classList.remove('active'); l.classList.add('pointer-events-none','opacity-0'); const v=l.querySelector('video'); if(v) v.pause(); };
refreshIcons();
</script>
</body>
</html>
